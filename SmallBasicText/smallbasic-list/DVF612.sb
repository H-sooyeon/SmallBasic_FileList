Sub init
  clrs=LDText.Split("blue #fe0000 magenta green cyan yellow white SaddleBrown DarkSlateGray teal tan" " ")
  clrs[0]="black
  cc[ 1]="..####.. #####  . #### . ####   .######. ###### .$#####.  ####  .#$  @#   ####   #$  @#      $#   ####   @####   ###### #######. #$      #   @#  #    #  #$  #@ .#####...#####...#$  @# .#$  @#.@#   $#.#$    #@.##### .  ##$     ####    ####    ####   ######   #### 	  ####    ####   ######     #                                                      # #     #          #      #      #      ##     ####              ############    ########    ########           
  cc[ 2]=".#$  @#. #$  @# .#$  @#. #$ @#  .#$    . #$     .  $#  . #$  $# .#$  @#  #$  @#  #$  @#      $#  #$     @#   $#      #$   $#   . #$      ##  @#  ##  ##  #$ #@  .#$  @#..#$  @#..#$  @# .#$  @#  @# $#   #$  #@ #     #. # #$    #   $#  #$  @#  #@  $#  #$      #$      #@  $#  #$  ##       #    ##     #                 #                              # #   #####       #      #        #    #  #   #    #   #   #     ############    ########    ########         
  cc[ 3]=".#$  @#. #####  .#$    . #$  @# .##### . #####  .  $#  . #$  $# .#$  @#  #$      ######      $#   ####  @#   $#     #$    $#   . #$      #$# @#  #$##@#  ###@   .#$  @#..#$  @#..#$  @# .#$  @#   @##     #$#@  # ### #.   #$        $#   ####   #@  $#  #####   #####      ##   #$ #@#      #    # #      #     ######     #               #              # #  #  #        #      #          #  #    #       #    # #      ############    ########    ########        
  cc[ 4]=".######. #$  @# .#$    . #$  @# .#$    . #$     .  $#  . #$  $# .#$  @#  #$ ###  #$  @#  #@  $#      $# @# # $#    #$     $#   . #$      #@$#@#  #$  @#  #$$#   .##### ..##### ..#$  @# .#$  @#   $##      #$   # #   #.   #$     ####   #$  @#   #####      $#  #$  @#      $#  #$# @#     #    #  #       #             #####   #####                          #####     #       #          #             ##   #######    ############    ########    ########          
  cc[ 5]=".#$  @#. #$  @# .#$  @#. #$ @#  .#$    . #$     .  $#  . #$  $# .#$  @#  #$  @#  #$  @#  #@  $#  #$  $# @#  #$#   #$      $#   . #$      #@ $##  #$  @#  #$ $#  .#$    ..#$ @# .. #$@#  .#$##@#  $# @#     #$   # ### #.   #$    #$      #$  @#      $#  #@  $#  #$  @#  #@  $#  ##  @#    #     ######    #     ######     #               #       #              #  #   #        #          #            #       # #  ####    ####    ################    ####          
  cc[ 6]=".#$  @#. #####  . #### . ####   .######. #$     .$#####.  ####  . ####    ####   #$  @#   ####    ####   @####   ######   $#   . ######  #@  $#  #$  @#  #$  $# .#$    ..#$  @#..  ##   . #  #  $#   @#    #$   #     #. #####$. ######.  ####   @####    ####    ####    ####    ####     #        #     #       .         #                       #            #####   #          #        #                    #   # ####    ####    ################    ####                 
  cc[ 7]=".................................................................................................................................................................................................................##### ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..      ..  #   ..      ..  #   .#      ..    # ..   #  ..      ..  #   ..      .####   .####   .################   .####.      ..      ..      .                                                                                                                   #                   #      #            #        #                      #                                          
  cc[ 8]=".................................................................................................................................................................................................................                                                                                                                                                                                                       ####    ####    ################    ####                                        
  
  cc[ 9]=".................................................................................................................................................................................................................                     
  cc[10]=" ..##.  . ###    . ##   . ###    .####  . ####   .  #   .  ##    .#  #     ###    #  #       #     ###     ##     ####   #####    #       #  #   #   #    #  #  . ###.  ..###..   #  #   .#   #  .#   #  .#   # 
  cc[11]=" .#  #  . #  #   .#  #  . #  #   .#     . #      .  #   . #  #   .#  #    #       #  #       #    #       #  #       #     #    . #       ## #   ## ##    # #   . #  #  ..#  #.   #  #   .#   #    # #     # #                  
  cc[12]=" .####  . ###    .#     . #  #   .###   . ###    .  #   . #  #   .#  #    # ##    ####       #     ##     #  #      #      #    . #       # ##   # # #    ##    . ###   ..### .   #  #   .#   #     #       #
  cc[13]=" .#  #  . #  #   .#  #  . #  #   .#     . #      .  #   . #  #   .#  #    #  #    #  #    #  #       #    # ##     #       #    . #       #  #   #   #    # #   . #     ..# # .   # #    .# # #    # #      #
  cc[14]=" .#  #  . ###    . ##   . ###    .####  . #      .  #   .  ##    . ##      ###    #  #     ##     ###      # #    ####     #    . ####    #  #   #   #    #  #  . #     ..#  #.    #     . # #    #   #     #
  oppc="blue
  GraphicsWindow.PenWidth=0
  GraphicsWindow.BackgroundColor="DarkSlateGray
  GraphicsWindow.BrushColor="darkblue
  GraphicsWindow.Width=1460
  GraphicsWindow.Height=940
  GraphicsWindow.Top=5
  GraphicsWindow.Title="ZX Editor
  ix="ABCDEFIOUGHJSQZTLNMKPRVWXY[1289563074>=+-:,`$/()^?*!@#&% "
  mcm=LDText.Split("BORDER PAPER INK CLS NEW SAVE LOAD RUN LIST LET PLOT DRAW INPUT PRINT Goto DATA READ RESTORE RANDOMIZE CLEAR For NEXT If Then INKEY$ AT " " ")
  MHH=LDText.Split("bb pp ii cl nw sv ld rn ls lt pl dr in pr go dd rd rs rz cr ff nx If th ik at " " ")
  For x=1 To Array.GetItemCount(mhh)
    mc[mhh[x]]=mcm[x]
    cmc[mhh[x]]=Text.GetCharacter(170+x)
  EndFor
  
  args=0
  shh[0]=LDText.Split("8 7 6 5 4 3 2 1" " ")
  shh[1]=LDText.Split("1 2 3 4 5 6 7 8" " ")
  shh[2]=LDText.Split("2 4 1 8 6 7 5 3" " ")
  shh[3]=LDText.Split("3 8 2 7 1 5 4 6" " ")
  shh[4]=LDText.Split("5 1 8 2 3 4 6 7" " ")
  
  bl="#
  chm=ldtext.Split("A S D F G H J K L Q W E R T Y U I O P Z X C V B N M 0 1 2 3 4 5 6 7 8 9 + = > - : , ` $ / ( ) ^ ? * ! @ # & %" " ")
  ppc="DarkSlateGray
  chm[56]=" "
  initt="true
  mchr()
EndSub

Sub mchr
  qdd=0
  For h=1 To 56
    If h>=51 Then
      qdd=1
    EndIf
    thh=chm[h]
    If initt Then
      LDCall.Function2("gench" thh qdd)
      LDCall.Function("gencb" thh)
      If h<27 Then
        LDCall.Function("gencm" thh)
      EndIf
      jj[thh]=LDImage.Copy(ii[thh])
      
      LDImage.ReplaceColour(ii[thh] oppc "black" 5)
      LDImage.ReplaceColour(ii[thh] "red" "white" 5)
      LDImage.ReplaceColour(kk[thh] oppc ppc 5)
      LDImage.ReplaceColour(kk[thh] "red" "lime" 5)
      
    EndIf
    LDImage.ReplaceColour(jj[thh] oppc ppc 5)
    LDImage.ReplaceColour(jj[thh] "red" "black" 5)
    
    LDImage.ReplaceColour(im[thh] oppc ppc 5)
    LDImage.ReplaceColour(im[thh] "red" "black" 5)
    
  EndFor
  oppc=ppc
  initt="false
EndSub

Sub begin
  init()
  GraphicsWindow.KeyDown=kkk
  ss=1
  ttw="1=1;2=3;3=4
  LDCall.Function5("print" 1 22 "[1982 SINCLAIR" "teal" 2)
  LDCall.Function5("print" 16 22 "RESEARCH LTD " "teal" 4)
  Program.Delay(1333)
  GraphicsWindow.Clear()
  ppc="teal
EndSub
bgg:
nww="false
begin()
ppc=clrs[9]
mmr[10]=cmc["pr"]+"`HELLO To ZX fans world`
'mmr[20]=cmc["lt"]+"B=2:"+cmc["lt"]+"C=3,14159"
'mmr[30]=cmc["pr"]+"A+B-C/D*a^b


lll:
GraphicsWindow.BrushColor=ppc
GraphicsWindow.FillRectangle(0 0 1700 1100)
ql=0
Timer.Tick=tttm
Timer.Interval=180

Timer.Pause()
For qq=1 To 300
  If Text.StartsWith(mmr[qq] ":") Then
    mmr[qq]=Text.GetSubTextToEnd(mmr[qq] 2)
  EndIf
  If Array.ContainsIndex(mmr qq) Then
    cml=mmr[qq]
    TextWindow.WriteLine(cml)
    dcln()
    LDCall.Function5("print" 1 ql qq+" "+cln "teal" 2)
    cml=Text.GetSubText(mmr[qq] 1 1)
    
    dcln()
    LDCall.Function5("print" 1+Text.GetLength(ql)+2 ql cln "teal" 3)
    ql=ql+1
  EndIf
EndFor
kyy="false
cml=""

While "true
  LDCall.Function5("print" 1 22 "K" "teal" 1)
  Program.Delay(455)
  LDCall.Function5("print" 1 22 "K" "teal" 2)
  Program.Delay(455)
  If kyy Then
    Goto ccf
  EndIf
EndWhile

ccf:
cml=""
LDCall.Function5("print" 1 22 " " ppc 2)
fx=fx-1
rw=22
mode=1
'-------------------------------------------main loop-------------------------------------------------
Timer.Resume()
Sub tttm
  If kyy Then
    mmd=Text.GetSubText("KLCEG" mode 1)
    dcln()
    LDCall.Function5("print" 1 22 "                                   " ppc 2)
    fx=1
    LDCall.Function5("print" fx rw cln ppc 2)
    LDCall.Function5("print" fx rw mmd ppc 1)
    'kyy="false
  EndIf 
EndSub


While "true
  
  
  
  If brk Then
    Goto xxx
  EndIf
  If nww Then
    GraphicsWindow.Clear()
    GraphicsWindow.BrushColor="black
    GraphicsWindow.FillRectangle(50 50 1280 720)
    Program.Delay(555)
    GraphicsWindow.Clear()
    Program.Delay(555)
    Goto bgg
  EndIf
  
  If lstt Then
    lstt="false
    Goto lll
  EndIf
  
  If evv Then
    evv="false
    evlcml()
    LDCall.Function5("print" 1 22 "0 OK 0:1                              " ppc 2)
    fx=1
    dcc="true
    cml=""
    mode=1
  EndIf
  
EndWhile'---------------------------------------------------------------------------------------endmainloop

xxx:
GraphicsWindow.Clear()
brk="false
LDCall.Function5("print" 1 22 "D BREAK 0:1" ppc 2)
Program.Delay(1377)
GraphicsWindow.Clear()
LDCall.Function5("print" 1 22 "LIST" ppc 2)
LDCall.Function5("print" 6 22 "L" ppc 1)
Program.Delay(1377)
GraphicsWindow.Clear()
Goto lll

Sub kkk'--------------------------------*********************--KEYS
  ll=text.ConvertToLowerCase( GraphicsWindow.LastKey)
  GraphicsWindow.Title=ll
  kyy="true
  If ll="right" Then
    ss=ss+1
  ElseIf ll="left" Then
    ss=ss-1
  ElseIf ll="escape" Then
    brk="true
    
  ElseIf TEXT.StartsWith( ll "ret" ) Then
    If Text.StartsWith(cml ":") Then
      cml=Text.GetSubTextToEnd(cml 2)
    EndIf
    TextWindow.WriteLine(cml)
    li=LDText.Split(cml ":")
    ln=FCExtensions.MathEval( "0+"+text.GetSubTextToEnd (li[1] 2))
    'TextWindow.WriteLine(">"+li)
    If ln=0 Then
      
      tl=FCDialogs.AskForTextLine("To Line:")
      If tl="" Then
        evv="true
      Else
        mmr[tl]=cml
        cml=""
        lstt="true
      EndIf
      
    Else
      mmr[ln]=""
      For rr=2 To Array.GetItemCount(li)
        mmr[ln]=text.append(mmr[ln] ":"+li[rr])
      EndFor
      'TextWindow.WriteLine(li+"|"+ln+">:"+mmr[ln])
      lstt="true
      cml=""
    EndIf
    
    
  ElseIf ll="back" Then
    chp="" 
    fx=fx-1
    cml=Text.GetSubText(cml 1 Text.GetLength(cml)-1)
    If Text.GetLength(cml)<=1 Then
      mode=1
    EndIf
    
  ElseIf ll="space" Then
    cml=cml+" "
    
    
  ElseIf ll="f1" Then
    mode=1
    chp=""
  ElseIf ll="f2" Then
    mode=2
    chp=""
    
  ElseIf ll="f3" Then
    chp="`
    cml=text.append(cml chp)
  ElseIf ll="f4" Then
    chp="$
    cml=text.append(cml chp)
  ElseIf ll="f5" Then
    chp="!
    cml=text.append(cml chp)
  ElseIf ll="f6" Then
    chp="^
    cml=text.append(cml chp)
  ElseIf ll="f7" Then
    chp=";
    cml=text.append(cml chp)
  ElseIf ll="f8" Then
    chp="*
    cml=text.append(cml chp)
  ElseIf ll="f9" Then
    chp="(
    cml=text.append(cml chp)
  ElseIf ll="f11" Then
    chp=")
    cml=text.append(cml chp)
  ElseIf ll="oem5" Then
    chp="?
    cml=text.append(cml chp)
  ElseIf ll="oemopenbrackets" Then
    chp="@
    cml=text.append(cml chp)
  ElseIf ll="oem6" Then
    chp="%
    cml=text.append(cml chp)
  ElseIf ll="oem1" Then
    chp="&
    cml=text.append(cml chp)
  ElseIf ll="oemquotes" Then
    chp="#
    cml=text.append(cml chp)
  ElseIf ll="oemplus" Then
    chp="=
    cml=text.append(cml chp)
    
  ElseIf Text.GetLength(ll)=2 Then
    chp=Text.GetSubTextToEnd(ll 2)
    cml=text.append(cml chp)
    
    
  Else
    
    chp=""
    If mode=1 Then
      If ll="b" Then
        '  chp="BORDER "
        cml=cml+":"+cmc["bb"]
        mode=2
      ElseIf ll="p" Then
        '  chp="PAPER "
        cml=cml+":"+cmc["pp"]
        mode=2
      ElseIf ll="i" Then
        '   chp="INK "
        cml=cml+":"+cmc["ii"]
        mode=2
      ElseIf ll="c" Then
        '   chp="CLS"
        cml=cml+":"+cmc["cl"]
        mode=2
        
      ElseIf ll="f" Then        '    chp="For
        cml=cml+":"+cmc["ff"]
        mode=2
        
      ElseIf ll="g" Then        '    chp="Goto
        cml=cml+":"+cmc["go"]
        mode=2
      ElseIf ll="a" Then        '    chp="NEW"
        cml=cml+":"+cmc["nw"]
        mode=2
      ElseIf ll="r" Then        '   chp="RUN "
        cml=cml+":"+cmc["rn"]
        mode=2
      ElseIf ll="k" Then        '    chp="Let
        cml=cml+":"+cmc["lt"]
        mode=2
      ElseIf ll="q" Then        '    chp="input
        cml=cml+":"+cmc["in"]
        mode=2
      ElseIf ll="k" Then        '    chp="let
        cml=cml+":"+cmc["lt"]
        mode=2
      ElseIf ll="w" Then        '    chp="print
        mode=2
        cml=cml+":"+cmc["pr"]
      ElseIf ll="e" Then        '    chp="at
        cml=cml+":"+cmc["at"]
        mode=2
      ElseIf ll="l" Then        '    chp="LIST "
        cml=cml+":"+cmc["ls"]
        mode=2
      ElseIf ll="s" Then        '    chp="SAVE "
        cml=cml+":"+cmc["sv"]
        mode=2
      ElseIf ll="j" Then        '    chp="Load
        cml=cml+":"+cmc["ld"]
        mode=2
      EndIf
    Else
      
      chp=text.GetSubText( ll 1 1)
      If ll="oem1" Then
        chp=":"
        mode=1
      EndIf
      
      
      
      If Text.GetLength(ll)=1 Then
        cml=cml+chp
      EndIf
    EndIf
    
  EndIf
  ' GraphicsWindow.Title=cml
EndSub'------------------------------------------------------******


Sub dcln
  txl=LDText.Split(cml ":")
  cln=""
  For wt=1 To Array.GetItemCount(txl)
    cs=text.GetCharacterCode( Text.GetSubText(txl[wt] 1 1))-170
    cln=cln+mc[mhh[cs]]+" "+Text.GetSubTextToEnd(txl[wt] 2)+":"
    
  EndFor
  cln=Text.GetSubText(cln 1 Text.GetLength(cln)-1)
EndSub

Sub evlcml
  cx=LDText.Split(cml ":")
  For lx=1 To Array.GetItemCount(cx)
    ee=cx[lx]
    If Text.StartsWith(ee cmc["pp"]) Then
      tt=Text.GetSubText(ee 2 1)
      ppc=clrs[ldmath.Base2Decimal( tt 16)]
      ' GraphicsWindow.Title=ppc
      mchr()
    ElseIf Text.StartsWith(ee cmc["nw"]) Then
      nww="true
    ElseIf Text.StartsWith(ee cmc["cl"]) Then
      GraphicsWindow.Clear()
      lstt="true
      
    ElseIf Text.StartsWith(ee cmc["in"]) Then
      vv=LDText.Split(ee " ")
      'TextWindow.WriteLine(vv)
      vrr[text.GetSubTextToEnd( vv[1] 2)]=FCDialogs.AskForTextLine(vv[2])
      
    ElseIf Text.StartsWith(ee cmc["sv"]) Then
      ff=LDDialogs.SaveFile("zx" "e:\")
' The following line could be harmful and has been automatically commented.
'       File.WriteContents(ff mmr)
      
    ElseIf Text.StartsWith(ee cmc["ld"]) Then
      ff=LDDialogs.OpenFile ("zx" "e:\")
' The following line could be harmful and has been automatically commented.
'       mmr=File.ReadContents(ff)
      lstt="true
      
    ElseIf Text.StartsWith(ee cmc["ls"]) Then
      lstt="true
    ElseIf Text.StartsWith(ee cmc["bb"]) Then
      tt=text.ConvertToLowerCase( Text.GetSubText(ee 2 1))
      '  GraphicsWindow.Title=ee
      tt=ldmath.Base2Decimal( tt 16)
      bc=clrs[tt]
      
      GraphicsWindow.BrushColor=bc
      GraphicsWindow.FillRectangle(0 0 1600 80)
      GraphicsWindow.FillRectangle(0 850 1600 500)
      GraphicsWindow.FillRectangle(0 0 80 1000)
      GraphicsWindow.FillRectangle(1370 0 800 1000)
    EndIf
  EndFor
  
EndSub


Sub print
  fx=args[1]
  yy=args[2]
  tt=args[3]
  ccc=args[4]
  c1=args[5]
  tu=tt' Text.ConvertToUpperCase(tt)
  For f=1 To Text.GetLength(tt)
    qw=text.GetSubText(tu f 1)
    If c1=2 Then
      jm=jj[qw] 
    ElseIf c1=3 Then
      jm=kk[qw] 
    ElseIf c1=4 Then
      jm=im[qw] 
    Else
      jm=ii[qw]
    EndIf
    
    GraphicsWindow.DrawImage(jm fx*32+50 50+yy*32)
    fx=fx+1
    If fx>40 Then
      fx=2
      yy=yy+1
    EndIf
  EndFor
EndSub

Sub gencm
  ch=args[1]
  GraphicsWindow.BrushColor="blue
  GraphicsWindow.PenWidth=0
  ss=shapes.AddRectangle (32 32)
  gg=FCDrawings.CreateGraphicsFromControl(ss)
  qw=Text.GetIndexOf(ix ch)-1
  For x=0 To 7  
    For y=0 To 7
      n=x+8*qw+1
      If Text.IsSubText (bl text.getSubText(cc[y+8] n 1)) Then
        lx=x*4
        ly=y*4
        FCDrawings.FillRectangle(gg "red" lx ly 4 4)
      EndIf
    EndFor
  EndFor
  
  im[ch]=FCDrawings.GenerateImage(gg)
  Shapes.Remove(ss)
EndSub

Sub gench
  ch=args[1]
  qd=args[2]
  GraphicsWindow.BrushColor="blue
  GraphicsWindow.PenWidth=0
  ss=shapes.AddRectangle (32 32)
  gg=FCDrawings.CreateGraphicsFromControl(ss)
  qw=Text.GetIndexOf(ix ch)-1
  
  For x=0 To 7  
    For y=0 To 7
      n=x+8*qw+1
      If Text.IsSubText (bl text.getSubText(cc[y+qd] n 1)) Then
        lx=x*4
        ly=y*4
        FCDrawings.FillRectangle(gg "red" lx ly 4 4)
      EndIf
    EndFor
  EndFor
  
  '  GraphicsWindow.Title=ch
  mg=FCDrawings.GenerateImage(gg)
  ii[ch]=mg
  
  thh=ch 
  'Shapes.AddImage(mg)
  'Program.Delay(155)
  Shapes.Remove(ss)
EndSub

Sub gencb
  ch=args[1]
  GraphicsWindow.BrushColor="blue
  GraphicsWindow.PenWidth=0
  ss=shapes.AddRectangle (32 32)
  gg=FCDrawings.CreateGraphicsFromControl(ss)
  qw=Text.GetIndexOf(ix ch)-1
  
  For x=0 To 7  
    For y=0 To 7
      n=x+8*qw+1
      If Text.IsSubText ("#$@" text.getSubText(cc[y] n 1)) Then
        lx=x*4
        ly=y*4
        FCDrawings.FillRectangle(gg "red" lx ly 4 4)
      EndIf
    EndFor
  EndFor
  
  kk[ch]=FCDrawings.GenerateImage(gg)
  thh=ch
  Shapes.Remove(ss)
EndSub




