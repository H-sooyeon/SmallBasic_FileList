'?£ç  2015/03/13

sInitData()

sInitBoard()

sDispBoard()

gn0=0 '?ƒ?ƒ¼?ƒ‰?•°

gn1=0 '??å¾Œã®?ƒ?ƒ¼?ƒ‰

gt0=1 'number(Turn)

gp0=GEBLACK

gButton=1 '?ƒœ?‚¿?ƒ³?‚’?œ‰?Š¹?«?™?‚‹??



Controls.ButtonClicked=eClick

'GraphicsWindow.mousemove=eMouse '?‚¿?ƒƒ?ƒ?ƒ‘?ƒ?ƒ«?§?“ä½œã™?‚‹??

GraphicsWindow.mousedown=eMouse '?ƒ?‚¦?‚¹?§?“ä½œã™?‚‹??

eMouse()



Sub sInitData '?ƒ‡?ƒ¼?‚¿?‚’?ˆ?œŸè¨?å®šã™?‚‹??

  GFILENODE="C:\Users\?˜\Documents\SmallBasic\?£ç .text"

  GLN=15 '?›¤?®ç·šã®?•°

  GWD=50 '?›¤?®?¡?®å¤§ã?•

  GMLEN=50 '?ƒ¡?ƒƒ?‚»?ƒ¼?‚¸?–‡å­—æ•°

  GEWALL=0 'å£?

  GEBLACK=1 'é»?

  GEWHITE=2 '?™½

  GESIGNA=3 'è¨˜å·

  GESIGNB=4 'è¨˜å·(é»?)

  GESIGNW=5 'è¨˜å·(?™½)

  GEOUT=6 '? ´?®å¤?

  GEFIELD=7 '? ´

  GE3=8 'ä¸?

  GE4=9 '?››

  GE33=10 'ä¸‰ä¸‰

  GE43=11 '?››ä¸?

  GE44=12 'é»?:?››?››(ä¸¡ç«¯? ´),?™½?››?››(ä¸¡ç«¯? ´?‚‚?«????)

  GE5=13 'äº?

  GE6=14 'ç¦æ‰‹(é»?:?•·??,?››?››,ä¸‰ä¸‰)

  GEBW=3 'GEBLACK+GEWHITE

  GNF=1 'Forward

  GNB=2 'Back

  GNR=3 'Right

  GNL=4 'Left

  GNZ=5 'z

  GNT=6 'Turn(Number)

  GNP=7 'Player

  GNE=8 'e

  GNS=9 'Sign

  GROLE[1]="é»?"

  GROLE[2]="?™½"

  GROLE[3]="ç©?"

  GROLE[4]="? ´"

  GROLE[5]="ä¸?"

  GROLE[6]="?››"

  GROLE[7]="ä¸‰ä¸‰"

  GROLE[8]="?››ä¸?"

  GROLE[9]="?››?››"

  GROLE[10]="äº?"

  GROLE[11]="ç¦æ‰‹"

  GDIR[1]=1 '?Ÿ³?®?–¹?‘

  GDIR[2]=20

  GDIR[3]=19

  GDIR[4]=18

  GDIR[5]=-1

  GDIR[6]=-20

  GDIR[7]=-19

  GDIR[8]=-18

  GCOL[1]="black" 'é»’çŸ³

  GCOL[2]="white" '?™½?Ÿ³

  GCOL[3]="skyblue" 'æ¬¡ã®?‰‹

  GCOL[4]="chocolate" '?›¤

  GDIG[1]="ä¸?"

  GDIG[2]="äº?"

  GDIG[3]="ä¸?"

  GDIG[4]="?››"

  GDIG[5]="äº?"

  GDIG[6]="?…­"

  GDIG[7]="ä¸?"

  GDIG[8]="?…«"

  GDIG[9]="ä¹?"

  GDIG[10]="?"

  

  'gbd[361] ?›¤

  'gnd[9][] ?ƒ?ƒ¼?ƒ‰

EndSub



Sub sInitBoard '?›¤?®?ƒ‡?ƒ¼?‚¿?‚’?ˆ?œŸè¨?å®šã™?‚‹?? ?‡º?Š›:gbd[]

  For z2=1 To (GLN+4)*(GLN+4)

    gbd[z2]=GEWALL

  EndFor

  For j2=1 To GLN

    For i2=1 To GLN

      gbd[(GLN+4)*(j2+1)+i2+2]=GEOUT

    EndFor

  EndFor

  gbd[181]=GEFIELD 'ä¸?å¤?

EndSub



Sub sFieldB44 'é»’ã®44 ?…¥?Š›:ge0 ?‡º?Š›:ge0

  If ge0=0 or ge0=GE3 Then

    ge0=GE44

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldB4 'é»’ã®4 ?…¥?Š›:ge0 ?‡º?Š›:ge0

  If ge0=0 Then

    ge0=GE4

  ElseIf ge0=GE3 then

    ge0=GE43

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldW4 '?™½?®4 ?…¥?Š›:ge0 ?‡º?Š›:ge0

  If ge0=0 Then

    ge0=GE4

  ElseIf ge0=GE3 or ge0=GE33 then

    ge0=GE43

  Else

    ge0=GE44

  EndIf

EndSub



Sub sFieldB3 'é»’ã®3 ?…¥?Š›:ge0 ?‡º?Š›:ge0

  If ge0=0 Then

    ge0=GE3

  ElseIf ge0=GE4 then

    ge0=GE43

  ElseIf ge0=GE44 then

    ge0=GE44

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldW3 '?™½?®3 ?…¥?Š›:ge0 ?‡º?Š›:ge0

  If ge0=0 Then

    ge0=GE3

  ElseIf ge0=GE3 or ge0=GE33 then

    ge0=GE33

  ElseIf ge0=GE4 or ge0=GE43 then

    ge0=GE43

  Else

    ge0=GE44

  EndIf

EndSub



Sub sFieldB8 'é»’ã®? ´ ?…¥?Š›:gz0 ?‡º?Š›:ge0

  ge0=0

  For d2=1 To 4

    m0=1

    z1=gz0+GDIR[d2]

    While gbd[z1]=GEBLACK

      m0=m0+1

      z1=z1+GDIR[d2]

    EndWhile

    z2=gz0-GDIR[d2]

    While gbd[z2]=GEBLACK

      m0=m0+1

      z2=z2-GDIR[d2]

    EndWhile

    If gbd[z1]>GEWHITE Then

      m1=0

      z3=z1+GDIR[d2]

      While gbd[z3]=GEBLACK

        m1=m1+1

        z3=z3+GDIR[d2]

      EndWhile

    Else

      m1=-255

    EndIf

    If gbd[z2]>GEWHITE Then

      m2=0

      z4=z2-GDIR[d2]

      While gbd[z4]=GEBLACK

        m2=m2+1

        z4=z4-GDIR[d2]

      EndWhile

    Else

      m2=-255

    EndIf

    If m0=1 Then

      If m1=2 And m2=0 Then

        sFieldB3()

      ElseIf m1=0 And m2=2 then

        sFieldB3()

      ElseIf m1=3 And m2=3 then

        ge0=GE6

      ElseIf m1=3 or m2=3 then

        sFieldB4()

      EndIf

    ElseIf m0=2 then

      If m1=1 And m2=0 Then

        sFieldB3()

      ElseIf m1=0 And m2=1 then

        sFieldB3()

      ElseIf m1=2 And m2=2 then

        ge0=GE6

      ElseIf m1=2 or m2=2 then

        sFieldB4()

        EndIf

    ElseIf m0=3 then

      If m1=0 And m2=0 Then

        sFieldB3()

      ElseIf m1=1 And m2=1 then

        ge0=GE6

      ElseIf m1=1 or m2=1 then

        sFieldB4()

      EndIf

    ElseIf m0=4 then

      If m1=0 And m2=0 Then

        sFieldB44()

      ElseIf m1=0 or m2=0 then

        sFieldB4()

      EndIf

    ElseIf m0=5 then

      ge0=GE5

      Goto End_sFieldB8

    Else

      ge0=GE6

    EndIf

  EndFor

  End_sFieldB8:

EndSub



Sub sFieldW8 '?™½?®? ´ ?…¥?Š›:gz0 ?‡º?Š›:ge0

  ge0=0

  For d2=1 To 4

    m0=1

    z1=gz0+GDIR[d2]

    while gbd[z1]=GEWHITE

      m0=m0+1

      z1=z1+GDIR[d2]

    EndWhile

    z2=gz0-GDIR[d2]

    while gbd[z2]=GEWHITE

      m0=m0+1

      z2=z2-GDIR[d2]

    EndWhile

    If gbd[z1]>GEWHITE Then

      m1=0

      z3=z1+GDIR[d2]

      while gbd[z3]=GEWHITE

        m1=m1+1

        z3=z3+GDIR[d2]

      EndWhile

    Else

      m1=-255

    EndIf

    If gbd[z2]>GEWHITE Then

      m2=0

      z4=z2-GDIR[d2]

      while gbd[z4]=GEWHITE

        m2=m2+1

        z4=z4-GDIR[d2]

      EndWhile

    Else

      m2=-255

    EndIf

    If m0=1 Then

      If (m1=2 And m2=0) Or (m1=0 And m2=2) Then

        sFieldW3()

      ElseIf m1>=3 and m2>=3 then

        ge0=GE44

      ElseIf m1>=3 or m2>=3 then

        sFieldW4()

      EndIf

    ElseIf m0=2 then

      If (m1=1 And m2=0) Or (m1=0 And m2=1) Then

        sFieldW3()

      ElseIf m1>=2 and m2>=2 then

        ge0=GE44

      ElseIf m1>=2 or m2>=2 then

        sFieldW4()

      EndIf

    ElseIf m0=3 then

      If m1=0 And m2=0 Then

        sFieldW3()

      ElseIf m1>=1 and m2>=1 then

        ge0=GE44

      ElseIf m1>=1 or m2>=1 then

        sFieldW4()

      EndIf

    ElseIf m0=4 then

      If m1=0 And m2=0 Then

        ge0=GE44

      ElseIf m1=0 or m2=0 then

        sFieldW4()

      EndIf

    Else

      ge0=GE5

      Goto End_sFieldW8

    EndIf

  EndFor

  End_sFieldW8:

EndSub



Sub sSetField '? ´?‚’è¨?å®šã™?‚‹?? ?…¥?Š›:gi0,gj0 ?‡º?Š›:gbd[]

  For j2=gj0-2 To gj0+2

    For i2=gi0-2 To gi0+2

      z2=(GLN+4)*(j2+1)+i2+2

      If gbd[z2]=GEOUT Then

        gbd[z2]=GEFIELD

      EndIf

    EndFor

  EndFor

EndSub



Sub sDebugNode '?ƒ?ƒ¼?ƒ‰?‚’è¡¨ç¤º?™?‚‹??

  

  gtext0=""

  For n9=1 To gn0

    gtext0=gtext0+"("

    'For k2=1 To 8

    For k2=1 To 4

      gtext0=gtext0+gnd[k2][n9]+","

    EndFor

    gtext0=gtext0+gnd[9][n9]+")"

    sMessage()

  EndFor

EndSub



Sub sAddNode '?ƒ?ƒ¼?ƒ‰?‚’è¿½åŠ ?™?‚‹?? ?…¥?Š›:gnd[][],gn0,gnb6,gnl6,gz0,gt0,gp0 ?‡º?Š›:gnd[][],gn0

  gn0=gn0+1

  gnd[GNF][gn0]=0 'Forward

  gnd[GNB][gn0]=gnb6 'Back

  gnd[GNR][gn0]=0 'Right

  gnd[GNL][gn0]=gnl6 'Left

  gnd[GNZ][gn0]=gz0 'z

  gnd[GNT][gn0]=gt0 'number(Turn)

  gnd[GNP][gn0]=gp0 'Player

  gnd[GNE][gn0]=0 'value

  if gbd[gz0]=GESIGNA then

    ns6=gsign8

  Else

    ns6=""

  EndIf

  gnd[GNS][gn0]=ns6 'sign

  If gnb6<>0 Then

    gnd[GNF][gnb6]=gn0

  EndIf

  If gnl6<>0 Then

    gnd[GNR][gnl6]=gn0

  EndIf

EndSub



Sub sTraceNode '?ƒ?ƒ¼?ƒ‰?‚’è¿½è·¡?™?‚‹?? ?…¥?Š›:gnd[][],gn0,gn1,gz0,gt0,gp0 ?‡º?Š›:gnd[][],gn0,gnb6

  If gn1=0 Then 'å±??¢?Œ?–°?—?„??

    If gt0>0 then

      If gn0=0 Then '?ˆ?‰‹(?ƒ?ƒ¼?ƒ‰?Œ?„¡?„??)

        gt0=1

        gp0=GEBLACK

        gnb6=0

        gnl6=0

        sAddNode()

        gnb6=1

        Goto End_sTraceNode

      ElseIf gnd[GNZ][1]=gz0 then

        gnb6=1

        Goto End_sTraceNode

      EndIf

    Else

      If gn0=0 Then '?ˆ?‰‹(?ƒ?ƒ¼?ƒ‰?Œ?„¡?„??) 

        gnb6=0

        gnl6=0

        sAddNode()

        gnb6=1

        Goto End_sTraceNode

      ElseIf gnd[GNZ][1]=gz0 then

        gnb6=1

        Goto End_sTraceNode

      EndIf

    EndIf

  endif

  nf6=gnd[GNF][gn1]

  If nf6=0 Then 'æ¬¡ã®?‰‹?®?™è£œ?Œ?„¡?„?? forward

    gnb6=gn1

    gnl6=0

    sAddNode()

    gnb6=gn0

    Goto End_sTraceNode

  endif

  

  If gnd[GNT][nf6]=0 Then 'æ¬¡ãŒè¨˜å·?®? ´?ˆ?æ?å¾Œã®è¨˜å·?®å¾Œã«è¿½åŠ ?™?‚‹??

    While nf6<>0

      nb6=nf6

      nf6=gnd[GNF][nf6]

    EndWhile

    gnb6=nb6

    gnl6=0

    sAddNode()

    gnb6=gn0

    Goto End_sTraceNode

  EndIf

  

  If gnd[GNZ][nf6]=gz0 Then

    gnb6=nf6

    Goto End_sTraceNode

  endif

  nr6=nf6

  nf6=gnd[GNR][nf6]

  While nf6<>0

    If gnd[GNZ][nf6]=gz0 then

      gnb6=nf6

      Goto End_sTraceNode

    EndIf

    nr6=nf6

    nf6=gnd[GNR][nf6]

  EndWhile

  gnb6=0 'æ¬¡ã®?‰‹?®?™è£œ?‚’è¿½åŠ ?™?‚‹?‚right

  gnl6=nr6

  sAddNode()

  gnb6=gn0

  

  End_sTraceNode:

EndSub



Sub sMessage '?›¤?®ä¸‹ã«?ƒ¡?ƒƒ?‚»?ƒ¼?‚¸?‚’è¡¨ç¤º?™?‚‹?? ?…¥?Š›:gtext0 ?‡º?Š›:?”»?¢

  l2=Text.GetLength(gtext0)

  if l2>GMLEN Then

    gtext0=Text.GetSubText(gtext0,l2-GMLEN+1,GMLEN)

  EndIf

  Shapes.SetText(oMessage1,gtext0)

  'Sound.PlayBellRing()

EndSub



Sub sDispStone '?Ÿ³(æ¬¡ã®?‰‹)?‚’è¡¨ç¤º?™?‚‹??(Z) ?…¥?Š›:gz8,gc8 ?‡º?Š›:?”»?¢

  If gxyz=0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz8-1,GLN+4)-1

    j2=math.Ceiling((gz8-1)/(GLN+4))-2

  endif

  GraphicsWindow.brushcolor=gcol0

  oStone[i2][j2]=Shapes.AddEllipse(GWD,GWD)

  Shapes.HideShape(oStone[i2][j2])

  Shapes.Move(oStone[i2][j2],GWD*(i2-1/2),GWD*(j2-1/2))

  Shapes.ShowShape(oStone[i2][j2])

EndSub



Sub sDispNum '?•ª?·?‚’è¡¨ç¤º?™?‚‹?? ?…¥?Š›:gi0,gj0,gp0,gt0 ?‡º?Š›:?”»?¢

  If gt0<10 Then

    iDif2=1/4

  ElseIf gt0<100 then

    iDif2=1/3

  Else

    iDif2=1/2

  EndIf

  GraphicsWindow.brushcolor=GCOL[GEBW-gp0]

  oNum[gi0][gj0]=shapes.AddText("")

  Shapes.SetText(oNum[gi0][gj0],gt0)

  Shapes.Move(oNum[gi0][gj0],GWD*(gi0-iDif2),GWD*(gj0-1/3))

EndSub



Sub sDispSignA 'è¨˜å·(A)?‚’è¡¨ç¤º?™?‚‹??(Z) ?…¥?Š›:gz8,gsign8 ?‡º?Š›:?”»?¢

  If gxyz=0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz8-1,GLN+4)-1

    j2=math.Ceiling((gz8-1)/(GLN+4))-2

  endif

  if Text.GetLength(gsign8)>2 Then

    sign2=Text.GetSubText(gsign8,1,2)

    gtext0=gsign8

    sMessage()

  Else

    sign2=gsign8

  endif

  GraphicsWindow.brushcolor=GCOL[1]

  oNum[i2][j2]=shapes.AddText("")

  Shapes.SetText(oNum[i2][j2],sign2)

  Shapes.Move(oNum[i2][j2],GWD*(i2-1/3),GWD*(j2-1/3))

EndSub



Sub sDispNext 'æ¬¡ã®?‰‹?‚’è¡¨ç¤º?™?‚‹?‚å…¥?Š›:gnd[],gn1 ?‡º?Š›:?”»?¢

  gButton=1 '?ƒœ?‚¿?ƒ³?‚’?œ‰?Š¹?«?™?‚‹??

  If gt0=0 Then

    Goto End_sDispNext

  EndIf

  If gn1=0 Then

    Goto End_sDispNext

  EndIf

  nfr2=gnd[GNF][gn1]

  If nfr2=0 Then

    Goto End_sDispNext

  endif

  

  While nfr2<>0

    gz8=gnd[GNZ][nfr2]

    p8=gnd[GNP][nfr2]

    if p8=GEBLACK Or p8=GEWHITE then

      gButton=0 '?ƒœ?‚¿?ƒ³?‚’?„¡?Š¹?«?™?‚‹??

      gxyz=1

      gcol0=GCOL[3] 'æ¬¡ã®?‰‹?®?‰²?‚’è¨?å®šã™?‚‹??

      sDispStone()

      

      nfr2=gnd[GNR][nfr2]

      While nfr2<>0

        gz8=gnd[GNZ][nfr2]

        gxyz=1

        gcol0=GCOL[3] 'æ¬¡ã®?‰‹?®?‰²?‚’è¨?å®šã™?‚‹??

        sDispStone()

        nfr2=gnd[GNR][nfr2]

      EndWhile

      Goto End_sDispNext

    ElseIf p8=GESIGNA then

      gt0=0

      gsign8=gnd[GNS][nfr2]

      gbd[gnd[GNZ][nfr2]]=p8

      gxyz=1

      sDispSignA()

    elseif p8=GESIGNB or p8=GESIGNW then

      gt0=0

      gbd[gnd[GNZ][nfr2]]=p8

      gxyz=1

      gcol0=GCOL[p8-GESIGNA]

      sDispStone()

    endif

    nfr2=gnd[GNF][nfr2]

  endwhile

  

  End_sDispNext:

EndSub



Sub sEraseNext 'æ¬¡ã®?‰‹?‚’æ¶ˆå»?™?‚‹?‚å…¥?Š›:gnd[],gn1 ?‡º?Š›:?”»?¢

  'If gt0=0 Then '?Ÿ³?Œç½??‹?‚Œ?¦?„?ª?„??

    'Goto End_sEraseNext

  'EndIf

  If gn1=0 Then '?Ÿ³?Œç½??‹?‚Œ?¦?„?ª?„??

    Goto End_sEraseNext

  EndIf

  nfr2=gnd[GNF][gn1]

  If nfr2=0 Then

    Goto End_sEraseNext

  endif

  

  While nfr2<>0

    z2=gnd[GNZ][nfr2]

    i2=math.Remainder(z2-1,GLN+4)-1

    j2=math.Ceiling((z2-1)/(GLN+4))-2

    Shapes.remove(oStone[i2][j2])

    Shapes.remove(oNum[i2][j2])

    p2=gnd[GNP][nfr2]

    If p2=GEBLACK Or p2=GEWHITE Then

      Goto Right_sEraseNext

    Else

      nfr2=gnd[GNF][nfr2]

    EndIf

  EndWhile

  

  Right_sEraseNext:

  nfr2=gnd[GNR][nfr2]

  While nfr2<>0

    z2=gnd[GNZ][nfr2]

    i2=math.Remainder(z2-1,GLN+4)-1

    j2=math.Ceiling((z2-1)/(GLN+4))-2

    Shapes.remove(oStone[i2][j2])

    Shapes.remove(oNum[i2][j2])

    nfr2=gnd[GNR][nfr2]

  EndWhile

  

  End_sEraseNext:

EndSub



Sub sDispPut '?Ÿ³?‚’ç½????

  gxyz=0

  gcol0=GCOL[gp0]

  sDispStone()

  sDispNum()

  If gp0=GEBLACK Then

    sFieldB8()

  Else

    sFieldW8()

  EndIf

  'gtext0=gtext0+GROLE[gp0]+":"+GROLE[ge0]

  'sMessage()

  'If ge0=GE5 Then

  '  gtext0=gtext0+GROLE[gp0]+"?®?‹?¡"

  '  sMessage()

  'ElseIf ge0=GE6 then

  '  gtext0=gtext0+"é»’ã®ç¦æ‰‹?§?™?‚ç™½?®?‹?¡"

  '  sMessage()

  'EndIf

EndSub



Sub sWriteNode '?ƒ?ƒ¼?ƒ‰?‚’?›¸?è¾¼ã???

  Controls.SetButtonCaption(bWrite,"?†“?›¸è¾¼ã¿")

  If gn0>0 then

    For n2=1 To gn0

      buf2=""

      For k2=1 to 8

        buf2=buf2+gnd[k2][n2]+","

      EndFor

      buf2=buf2+gnd[9][n2]

' The following line could be harmful and has been automatically commented.

'       File.WriteLine(GFILENODE,n2,buf2)

    EndFor

  EndIf

  Controls.SetButtonCaption(bWrite,"?›¸è¾¼ã¿")

EndSub



Sub sSplitLine 'è¡Œã‚’?ˆ†?‰²?™?‚‹??

  if Text.GetLength(gLine9)>0 Then

    i2=Text.GetIndexOf(gLine9,",")

    j2=1

    While i2>0

      gnd[j2][gn9]=Text.GetSubText(gLine9,1,i2-1)

      gtext0=gtext0+gnd[j2][gn9]+","

      sMessage()

      gLine9=Text.GetSubTextToEnd(gLine9,i2+1)

      j2=j2+1

      i2=Text.GetIndexOf(gLine9,",")

    Endwhile

    gnd[j2][gn9]=gLine9

    gtext0=gtext0+gnd[j2][gn9]+","

    sMessage()

  EndIf

EndSub



Sub sReadNode '?ƒ?ƒ¼?ƒ‰?‚’èª??¿è¾¼ã???

  Controls.SetButtonCaption(bRead,"?†“èª?è¾¼ã¿")

  gn9=1

  Loop_sRead:

' The following line could be harmful and has been automatically commented.

'     gLine9=File.ReadLine(GFILENODE,gn9)

    If gLine9="" then

      goto End_sRead

    EndIf

    sSplitLine()

    gn9=gn9+1

  Goto Loop_sRead

  End_sRead:

  gn0=gn9-1

  gn1=0

  gt0=1

  gp0=GEBLACK

  Controls.SetButtonCaption(bRead,"èª?è¾¼ã¿")

EndSub



Sub sAlternate '?ƒœ?‚¿?ƒ³??‚’?ˆ»?™??

  if gp0=GESIGNB then

    Controls.SetButtonCaption(bBlack,"é»?")

  elseif gp0=GESIGNW then

    Controls.SetButtonCaption(bWhite,"?™½")

  elseif gp0=GESIGNA then

    Controls.SetButtonCaption(bSign,"è¨˜å·")

  endif

EndSub



Sub sInitGame

  Controls.SetButtonCaption(bInit,"?†“?ˆ?œŸ?Œ–")

  sInitBoard()

  sDispBoard()

  gn1=0

  gt0=1

  gp0=GEBLACK

  Controls.SetButtonCaption(bInit,"?ˆ?œŸ?Œ–")

EndSub



Sub eMouseSign

  If gn0=0 Then

    Goto End_eMouseSign '?ˆ?‰‹?«è¨˜å·?‚’ç½??‘?ª?„??

  EndIf

  If gbd[gz0]<>GEFIELD and gbd[gz0]<>GEOUT Then

    sDelSign() 'è¨˜å·(A?¾?Ÿ?¯?Ÿ³)?‚’æ¶ˆå»?™?‚‹??

    Goto End_eMouseSign

  EndIf

  If gp0=GESIGNA Then

    gsign8=Controls.GetTextBoxText(bContent)

    If gsign8="" Then

      Goto End_eMouseSign

    EndIf

    gbd[gz0]=gp0

    gxyz=0

    sDispSignA() 'è¨˜å·(A)?‚’ç½????

  ElseIf gp0=GESIGNB or gp0=GESIGNW then

    gbd[gz0]=gp0

    gxyz=0

    gcol0=GCOL[gp0-GESIGNA]

    sDispStone() 'è¨˜å·(?Ÿ³)?‚’ç½????

  EndIf

  sTraceNode()

  gn1=gnb6

  sDebugNode()

  

  End_eMouseSign:

EndSub



Sub sClearNode '?ƒ?ƒ¼?ƒ‰?‚’æ¶ˆå»?™?‚‹??

  z2=gnd[GNZ][gn3]

  If z2=0 Then '?ƒ?‚§?ƒƒ?‚¯?™?‚‹??

    Goto End_sClearNode

  endif

  p2=gbd[z2]

  If p2<>GEBLACK And p2<>GEWHITE Then

    Goto End_sClearNode

  endif

  gbd[z2]=GEFIELD '?›¤?®?Ÿ³?®?ƒ‡?ƒ¼?‚¿?‚’æ¶ˆå»?™?‚‹??

  i2=math.Remainder(z2-1,GLN+4)-1 '?›¤?®?Ÿ³?‚’æ¶ˆå»?™?‚‹??

  j2=math.Ceiling((z2-1)/(GLN+4))-2

  Shapes.remove(oNum[i2][j2])

  Shapes.remove(oStone[i2][j2])

  For k2=1 To 8 '?ƒ?ƒ¼?ƒ‰?®?ƒ‡?ƒ¼?‚¿?‚’æ¶ˆå»?™?‚‹??

    gnd[k2][gn3]=0

  endfor

  gnd[9][gn3]=""

  If gn3=gn0 Then '?ƒ?ƒ¼?ƒ‰?•°(gn0)?‚’?‰Šæ¸›ã™?‚‹??

    gn0=gn0-1

    While gnd[GNZ][gn0]=0

    gn0=gn0-1

    if gn0<1 Then

      Goto End_sClearNode

    EndIf

  EndWhile

  EndIf

  

  End_sClearNode:

  'sInitGame()

  'sDebugNode()

EndSub



Sub sDelStone '?Ÿ³?‚’æ¶ˆå»?™?‚‹??

  n2=gn1??'??å¾Œã«è¡¨ç¤º?•?‚Œ?Ÿ?Ÿ³?®??ãƒ¼?ƒ‰(gn1)

  If n2=0 Then

    Goto End_sDelStone

  EndIf

  z2=gnd[GNZ][n2] '?‚¯?ƒª?ƒƒ?‚¯?—?Ÿ?Ÿ³?®?ƒ?ƒ¼?ƒ‰(n2)?‚’æ±‚ã‚?‚‹?‚Back

  while z2<>gz0

    n2=gnd[GNB][n2]

    If n2=0 Then

      Goto End_sDelStone

    EndIf

    z2=gnd[GNZ][n2]

  EndWhile

  n3=n2 'æ¬¡ã®?ƒ?ƒ¼?ƒ‰?Œ?„¡?„??å¾Œã®?ƒ?ƒ¼?ƒ‰(n3)?‚’æ±‚ã‚?‚‹?‚Forward

  

  F_sDelStone:

  nf2=gnd[GNF][n3]

  While nf2<>0

    n3=nf2

    nf2=gnd[GNF][nf2]

  EndWhile

  nb2=gnd[GNB][n3]

  nr2=gnd[GNR][n3]

  nl2=gnd[GNL][n3]

  If nb2=0 then

    sInitGame()

    Goto End_sDelStone

  EndIf

  If nl2=0 then

    gnd[GNF][nb2]=nr2

    If nr2=0 Then

      n4=nb2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

    else

      gnd[GNB][nr2]=nb2

      gnd[GNL][nr2]=0

      n4=nr2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

    EndIf

  else

    'gnd[GNR][nl2]=nr2

    If nr2=0 Then

      gnd[GNR][nl2]=nr2

      n4=nl2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

      

      gtext0="test"

      sMessage()

      Goto End_sDelStone

      gn3=n3

      sClearNode() 'n3?ƒ?ƒ¼?ƒ‰?‚’æ¶ˆå»?™?‚‹??

      n3=n4

      Goto End_sDelStone

    

    else

      gnd[GNR][nl2]=nr2

      gnd[GNL][nr2]=nl2

      n4=nr2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

    EndIf

    'n4=nl2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

    'n4=nr2 'æ¶ˆå»?™?‚‹äºˆå®š?®?ƒ?ƒ¼?ƒ‰

  EndIf

  gn3=n3

  sClearNode() 'n3?ƒ?ƒ¼?ƒ‰?‚’æ¶ˆå»?™?‚‹??

  If n3<>n2 Then

    n3=n4

    Goto F_sDelStone

  EndIf

    

  End_sDelStone:

endsub



Sub sDelSign 'è¨˜å·(A?¾?Ÿ?¯?Ÿ³)?‚’æ¶ˆå»?™?‚‹??

  If gn1>0 then

    nb2=gnd[GNB][gn1]

    If nb2=0 Then

      nb2=1

    endif

  Else

    nb2=1

  EndIf

  nf2=nb2

  While nf2<>0

    If gnd[GNZ][nf2]=gz0 Then

      goto Del_sDelSign

    endif

    nb2=nf2

    nf2=gnd[GNF][nf2]

  EndWhile

  Goto End_sDelSign

  

  Del_sDelSign:

  nf3=gnd[GNF][nf2]

  gnd[GNF][nb2]=nf3

  If nf3<>0 then

    gnd[GNB][nf3]=nb2

  endif

  gnd[GNZ][nf2]=0

  gnd[GNB][nf2]=0

  gnd[GNF][nf2]=0

  gnd[GNR][nf2]=0

  gnd[GNL][nf2]=0

  gnd[GNP][nf2]=0

  gnd[GNS][nf2]=""

  If gi0<>0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz0-1,GLN+4)-1

    j2=math.Ceiling((gz0-1)/(GLN+4))-2

  endif

  p2=gbd[gz0]

  If p2=GESIGNA Then

    Shapes.remove(oNum[i2][j2]) 'è¨˜å·(A)?‚’æ¶ˆå»?™?‚‹??

  elseIf p2=GESIGNB Or p2=GESIGNW Then

    Shapes.remove(oStone[i2][j2]) 'è¨˜å·(?Ÿ³)?‚’æ¶ˆå»?™?‚‹??

  endif

  gbd[gz0]=GEFIELD

  

  End_sDelSign:

endsub



Sub sDispBoard '?›¤?‚’è¡¨ç¤º?™?‚‹?? ?‡º?Š›:?”»?¢

  GraphicsWindow.Clear()

  GraphicsWindow.Title = "?£ç "

  GraphicsWindow.Height = GWD*(GLN+2)

  GraphicsWindow.Width = GWD*(GLN+1)

  GraphicsWindow.FontSize=GWD/2

  GraphicsWindow.backgroundcolor=GCOL[4]

  GraphicsWindow.brushcolor=GCOL[1]

  For j2=1 to GLN 'ç·šã‚’å¼•ã??

    GraphicsWindow.DrawLine(GWD,GWD*j2,GWD*GLN,GWD*j2)

  endfor

  For i2=1 to GLN

    GraphicsWindow.DrawLine(GWD*i2,GWD,GWD*i2,GWD*GLN)

  endfor

  For j2=4 To 12 Step 4 '?˜Ÿ?‚’????

    For i2=4 To 12 Step 4

      GraphicsWindow.FillEllipse(GWD*(i2-1/8),GWD*(j2-1/8),GWD/4,GWD/4)

    EndFor

  EndFor

  'For i2=1 To 9 'æ¨ªã®åº§æ¨™?‚’?›¸???

  '  GraphicsWindow.DrawBoundText(GWD*(i2-1/8),0,GWD,i2)

  'endfor

  'For i2=10 To GLN

  '  GraphicsWindow.DrawBoundText(GWD*(i2-1/4),0,GWD,i2)

  'endfor

  'For j2=1 To 9 'ç¸¦ã®åº§æ¨™?‚’?›¸???

  '  GraphicsWindow.DrawBoundText(GWD/3,GWD*(j2-1/4),GWD,j2)

  'endfor

  'For j2=10 To GLN

  '  GraphicsWindow.DrawBoundText(0,GWD*(j2-1/4),GWD,j2)

  'endfor

  For i2=GLN To 11 Step -1'æ¨ªã®åº§æ¨™?‚’?›¸???

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),0,GWD,GDIG[10])

  endfor

  For i2=GLN To 11 Step -1

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),GWD/2,GWD,GDIG[i2-10])

  endfor

  For i2=10 To 1 Step -1

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),GWD/2,GWD,GDIG[i2])

  endfor

  For j2=1 To 9 'ç¸¦ã®åº§æ¨™?‚’?›¸???

    GraphicsWindow.DrawBoundText(GWD*(GLN+1/3),GWD*(j2-1/4),GWD,j2)

  endfor

  For j2=10 To GLN

    GraphicsWindow.DrawBoundText(GWD*GLN,GWD*(j2-1/4),GWD,j2)

  endfor

  oMessage1=shapes.AddText("") '?ƒ¡?ƒƒ?‚»?ƒ¼?‚¸?‚’è¡¨ç¤º?™?‚‹??

  shapes.SetText(oMessage1,"")

  Shapes.Move(oMessage1,GWD,GWD*GLN)

  bEnd=Controls.AddButton("çµ‚äº†",GWD/2,GWD*(GLN+1)) '?ƒœ?‚¿?ƒ³?‚’è¡¨ç¤º?™?‚‹??

  bWrite=Controls.AddButton("?›¸è¾¼ã¿",GWD*2,GWD*(GLN+1))

  bRead=Controls.AddButton("èª?è¾¼ã¿",GWD*4,GWD*(GLN+1))

  bInit=Controls.AddButton("?ˆ?œŸ?Œ–",GWD*6,GWD*(GLN+1))

  bBlack=Controls.AddButton("é»?",GWD*8,GWD*(GLN+1))

  bWhite=Controls.AddButton("?™½",GWD*9,GWD*(GLN+1))

  bContent=Controls.AddTextBox(GWD*10,GWD*(GLN+1))

  Controls.SetSize(bContent,GWD,GWD*3/4)

  Controls.SetTextBoxText(bContent,"A")

  bSign=Controls.AddButton("è¨˜å·",GWD*23/2,GWD*(GLN+1))

  bDel=Controls.AddButton("?‰Š?™¤",GWD*13,GWD*(GLN+1))

EndSub



Sub eClick '?ƒœ?‚¿?ƒ³?‚’?‚¯?ƒª?ƒƒ?‚¯?—?Ÿ?™‚?å‡¦?†?™?‚‹??

  iLast=Controls.LastClickedButton

  if iLast=bEnd then

    Program.End()

  elseif iLast=bWrite then

    sWriteNode()

  elseif iLast=bRead then

    sInitGame()

    sReadNode()

  elseIf iLast=bInit Then

    sInitGame()

  elseif iLast=bBlack then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNB

      Controls.SetButtonCaption(bBlack,"?†“é»?")

    endif

  elseif iLast=bWhite then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNW

      Controls.SetButtonCaption(bWhite,"?†“?™½")

    endif

  elseif iLast=bSign then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNA

      Controls.SetButtonCaption(bSign,"?†“è¨˜å·")

    endif

  elseif iLast=bDel then

    If gButton=1 then

      

      Controls.SetButtonCaption(bSign,"?†“?‰Š?™¤")

    endif

  EndIf

EndSub



Sub eMouse '?ƒ?‚¦?‚¹

  gi0=math.ceiling((GraphicsWindow.MouseX+GWD/2)/GWD)-1

  gj0=math.ceiling((GraphicsWindow.MouseY+GWD/2)/GWD)-1

  If gi0<1 or gi0>GLN or gj0<1 or gj0>GLN Then

    Goto End_eMouse

  EndIf

  gz0=(GLN+4)*(gj0+1)+gi0+2

  If gt0>0 Then

    p2=gbd[gz0]

    If p2=GEBLACK Or p2=GEWHITE Then

      sDelStone()

      Goto End_eMouse

    endif

    'æ¬¡ã®?‰‹?‚’? ´?®?¿?«?ˆ¶?™?™?‚‹??

    'If p2<>GEFIELD Then

    'æ¬¡ã®?‰‹?‚’? ´?¨? ´?®å¤–ã«?ˆ¶?™?™?‚‹??

    If p2<>GEFIELD and p2<>GEOUT Then

      Goto End_eMouse

    EndIf

    gbd[gz0]=gp0 '?Ÿ³?‚’ç½????

    sSetField() '? ´?‚’è¨?å®šã™?‚‹??

    sEraseNext()

    sDispPut()

    sTraceNode()

    gn1=gnb6

    sDebugNode()

    sDispNext()

    If gt0>0 Then

      gt0=gt0+1

      gp0=GEBW-gp0

    Else

      gp0=GESIGNA

      Controls.SetButtonCaption(bSign,"?†“è¨˜å·")

    Endif

  Else

    eMouseSign()

  EndIf

  

  End_eMouse:

EndSub


