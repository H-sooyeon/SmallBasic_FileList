'?£Áè† 2015/03/13

sInitData()

sInitBoard()

sDispBoard()

gn0=0 '?Éé?Éº?Éâ?ï∞

gn1=0 '??Âæå„ÅÆ?Éé?Éº?Éâ

gt0=1 'number(Turn)

gp0=GEBLACK

gButton=1 '?Éú?Çø?É≥?Çí?úâ?äπ?Å´?Åô?Çã??



Controls.ButtonClicked=eClick

'GraphicsWindow.mousemove=eMouse '?Çø?ÉÉ?ÉÅ?Éë?Éç?É´?Åß?ìç‰Ωú„Åô?Çã??

GraphicsWindow.mousedown=eMouse '?Éû?Ç¶?Çπ?Åß?ìç‰Ωú„Åô?Çã??

eMouse()



Sub sInitData '?Éá?Éº?Çø?Çí?àù?úüË®?ÂÆö„Åô?Çã??

  GFILENODE="C:\Users\?òé\Documents\SmallBasic\?£Áè†.text"

  GLN=15 '?õ§?ÅÆÁ∑ö„ÅÆ?ï∞

  GWD=50 '?õ§?ÅÆ?û°?ÅÆÂ§ß„Åç?Åï

  GMLEN=50 '?É°?ÉÉ?Çª?Éº?Ç∏?ñáÂ≠óÊï∞

  GEWALL=0 'Â£?

  GEBLACK=1 'Èª?

  GEWHITE=2 '?ôΩ

  GESIGNA=3 'Ë®òÂè∑

  GESIGNB=4 'Ë®òÂè∑(Èª?)

  GESIGNW=5 'Ë®òÂè∑(?ôΩ)

  GEOUT=6 '?†¥?ÅÆÂ§?

  GEFIELD=7 '?†¥

  GE3=8 '‰∏?

  GE4=9 '?õõ

  GE33=10 '‰∏â‰∏â

  GE43=11 '?õõ‰∏?

  GE44=12 'Èª?:?õõ?õõ(‰∏°Á´Ø?†¥),?ôΩ?õõ?õõ(‰∏°Á´Ø?†¥?ÇÇ?ê´????)

  GE5=13 '‰∫?

  GE6=14 'Á¶ÅÊâã(Èª?:?ï∑??,?õõ?õõ,‰∏â‰∏â)

  GEBW=3 'GEBLACK+GEWHITE

  GNF=1 'Forward

  GNB=2 'Back

  GNR=3 'Right

  GNL=4 'Left

  GNZ=5 'z

  GNT=6 'Turn(Number)

  GNP=7 'Player

  GNE=8 'e

  GNS=9 'Sign

  GROLE[1]="Èª?"

  GROLE[2]="?ôΩ"

  GROLE[3]="Á©?"

  GROLE[4]="?†¥"

  GROLE[5]="‰∏?"

  GROLE[6]="?õõ"

  GROLE[7]="‰∏â‰∏â"

  GROLE[8]="?õõ‰∏?"

  GROLE[9]="?õõ?õõ"

  GROLE[10]="‰∫?"

  GROLE[11]="Á¶ÅÊâã"

  GDIR[1]=1 '?ü≥?ÅÆ?ñπ?êë

  GDIR[2]=20

  GDIR[3]=19

  GDIR[4]=18

  GDIR[5]=-1

  GDIR[6]=-20

  GDIR[7]=-19

  GDIR[8]=-18

  GCOL[1]="black" 'ÈªíÁü≥

  GCOL[2]="white" '?ôΩ?ü≥

  GCOL[3]="skyblue" 'Ê¨°„ÅÆ?âã

  GCOL[4]="chocolate" '?õ§

  GDIG[1]="‰∏?"

  GDIG[2]="‰∫?"

  GDIG[3]="‰∏?"

  GDIG[4]="?õõ"

  GDIG[5]="‰∫?"

  GDIG[6]="?Ö≠"

  GDIG[7]="‰∏?"

  GDIG[8]="?Ö´"

  GDIG[9]="‰π?"

  GDIG[10]="?çÅ"

  

  'gbd[361] ?õ§

  'gnd[9][] ?Éé?Éº?Éâ

EndSub



Sub sInitBoard '?õ§?ÅÆ?Éá?Éº?Çø?Çí?àù?úüË®?ÂÆö„Åô?Çã?? ?á∫?äõ:gbd[]

  For z2=1 To (GLN+4)*(GLN+4)

    gbd[z2]=GEWALL

  EndFor

  For j2=1 To GLN

    For i2=1 To GLN

      gbd[(GLN+4)*(j2+1)+i2+2]=GEOUT

    EndFor

  EndFor

  gbd[181]=GEFIELD '‰∏?Â§?

EndSub



Sub sFieldB44 'Èªí„ÅÆ44 ?Ö•?äõ:ge0 ?á∫?äõ:ge0

  If ge0=0 or ge0=GE3 Then

    ge0=GE44

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldB4 'Èªí„ÅÆ4 ?Ö•?äõ:ge0 ?á∫?äõ:ge0

  If ge0=0 Then

    ge0=GE4

  ElseIf ge0=GE3 then

    ge0=GE43

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldW4 '?ôΩ?ÅÆ4 ?Ö•?äõ:ge0 ?á∫?äõ:ge0

  If ge0=0 Then

    ge0=GE4

  ElseIf ge0=GE3 or ge0=GE33 then

    ge0=GE43

  Else

    ge0=GE44

  EndIf

EndSub



Sub sFieldB3 'Èªí„ÅÆ3 ?Ö•?äõ:ge0 ?á∫?äõ:ge0

  If ge0=0 Then

    ge0=GE3

  ElseIf ge0=GE4 then

    ge0=GE43

  ElseIf ge0=GE44 then

    ge0=GE44

  Else

    ge0=GE6

  EndIf

EndSub



Sub sFieldW3 '?ôΩ?ÅÆ3 ?Ö•?äõ:ge0 ?á∫?äõ:ge0

  If ge0=0 Then

    ge0=GE3

  ElseIf ge0=GE3 or ge0=GE33 then

    ge0=GE33

  ElseIf ge0=GE4 or ge0=GE43 then

    ge0=GE43

  Else

    ge0=GE44

  EndIf

EndSub



Sub sFieldB8 'Èªí„ÅÆ?†¥ ?Ö•?äõ:gz0 ?á∫?äõ:ge0

  ge0=0

  For d2=1 To 4

    m0=1

    z1=gz0+GDIR[d2]

    While gbd[z1]=GEBLACK

      m0=m0+1

      z1=z1+GDIR[d2]

    EndWhile

    z2=gz0-GDIR[d2]

    While gbd[z2]=GEBLACK

      m0=m0+1

      z2=z2-GDIR[d2]

    EndWhile

    If gbd[z1]>GEWHITE Then

      m1=0

      z3=z1+GDIR[d2]

      While gbd[z3]=GEBLACK

        m1=m1+1

        z3=z3+GDIR[d2]

      EndWhile

    Else

      m1=-255

    EndIf

    If gbd[z2]>GEWHITE Then

      m2=0

      z4=z2-GDIR[d2]

      While gbd[z4]=GEBLACK

        m2=m2+1

        z4=z4-GDIR[d2]

      EndWhile

    Else

      m2=-255

    EndIf

    If m0=1 Then

      If m1=2 And m2=0 Then

        sFieldB3()

      ElseIf m1=0 And m2=2 then

        sFieldB3()

      ElseIf m1=3 And m2=3 then

        ge0=GE6

      ElseIf m1=3 or m2=3 then

        sFieldB4()

      EndIf

    ElseIf m0=2 then

      If m1=1 And m2=0 Then

        sFieldB3()

      ElseIf m1=0 And m2=1 then

        sFieldB3()

      ElseIf m1=2 And m2=2 then

        ge0=GE6

      ElseIf m1=2 or m2=2 then

        sFieldB4()

        EndIf

    ElseIf m0=3 then

      If m1=0 And m2=0 Then

        sFieldB3()

      ElseIf m1=1 And m2=1 then

        ge0=GE6

      ElseIf m1=1 or m2=1 then

        sFieldB4()

      EndIf

    ElseIf m0=4 then

      If m1=0 And m2=0 Then

        sFieldB44()

      ElseIf m1=0 or m2=0 then

        sFieldB4()

      EndIf

    ElseIf m0=5 then

      ge0=GE5

      Goto End_sFieldB8

    Else

      ge0=GE6

    EndIf

  EndFor

  End_sFieldB8:

EndSub



Sub sFieldW8 '?ôΩ?ÅÆ?†¥ ?Ö•?äõ:gz0 ?á∫?äõ:ge0

  ge0=0

  For d2=1 To 4

    m0=1

    z1=gz0+GDIR[d2]

    while gbd[z1]=GEWHITE

      m0=m0+1

      z1=z1+GDIR[d2]

    EndWhile

    z2=gz0-GDIR[d2]

    while gbd[z2]=GEWHITE

      m0=m0+1

      z2=z2-GDIR[d2]

    EndWhile

    If gbd[z1]>GEWHITE Then

      m1=0

      z3=z1+GDIR[d2]

      while gbd[z3]=GEWHITE

        m1=m1+1

        z3=z3+GDIR[d2]

      EndWhile

    Else

      m1=-255

    EndIf

    If gbd[z2]>GEWHITE Then

      m2=0

      z4=z2-GDIR[d2]

      while gbd[z4]=GEWHITE

        m2=m2+1

        z4=z4-GDIR[d2]

      EndWhile

    Else

      m2=-255

    EndIf

    If m0=1 Then

      If (m1=2 And m2=0) Or (m1=0 And m2=2) Then

        sFieldW3()

      ElseIf m1>=3 and m2>=3 then

        ge0=GE44

      ElseIf m1>=3 or m2>=3 then

        sFieldW4()

      EndIf

    ElseIf m0=2 then

      If (m1=1 And m2=0) Or (m1=0 And m2=1) Then

        sFieldW3()

      ElseIf m1>=2 and m2>=2 then

        ge0=GE44

      ElseIf m1>=2 or m2>=2 then

        sFieldW4()

      EndIf

    ElseIf m0=3 then

      If m1=0 And m2=0 Then

        sFieldW3()

      ElseIf m1>=1 and m2>=1 then

        ge0=GE44

      ElseIf m1>=1 or m2>=1 then

        sFieldW4()

      EndIf

    ElseIf m0=4 then

      If m1=0 And m2=0 Then

        ge0=GE44

      ElseIf m1=0 or m2=0 then

        sFieldW4()

      EndIf

    Else

      ge0=GE5

      Goto End_sFieldW8

    EndIf

  EndFor

  End_sFieldW8:

EndSub



Sub sSetField '?†¥?ÇíË®?ÂÆö„Åô?Çã?? ?Ö•?äõ:gi0,gj0 ?á∫?äõ:gbd[]

  For j2=gj0-2 To gj0+2

    For i2=gi0-2 To gi0+2

      z2=(GLN+4)*(j2+1)+i2+2

      If gbd[z2]=GEOUT Then

        gbd[z2]=GEFIELD

      EndIf

    EndFor

  EndFor

EndSub



Sub sDebugNode '?Éé?Éº?Éâ?ÇíË°®Á§∫?Åô?Çã??

  

  gtext0=""

  For n9=1 To gn0

    gtext0=gtext0+"("

    'For k2=1 To 8

    For k2=1 To 4

      gtext0=gtext0+gnd[k2][n9]+","

    EndFor

    gtext0=gtext0+gnd[9][n9]+")"

    sMessage()

  EndFor

EndSub



Sub sAddNode '?Éé?Éº?Éâ?ÇíËøΩÂä†?Åô?Çã?? ?Ö•?äõ:gnd[][],gn0,gnb6,gnl6,gz0,gt0,gp0 ?á∫?äõ:gnd[][],gn0

  gn0=gn0+1

  gnd[GNF][gn0]=0 'Forward

  gnd[GNB][gn0]=gnb6 'Back

  gnd[GNR][gn0]=0 'Right

  gnd[GNL][gn0]=gnl6 'Left

  gnd[GNZ][gn0]=gz0 'z

  gnd[GNT][gn0]=gt0 'number(Turn)

  gnd[GNP][gn0]=gp0 'Player

  gnd[GNE][gn0]=0 'value

  if gbd[gz0]=GESIGNA then

    ns6=gsign8

  Else

    ns6=""

  EndIf

  gnd[GNS][gn0]=ns6 'sign

  If gnb6<>0 Then

    gnd[GNF][gnb6]=gn0

  EndIf

  If gnl6<>0 Then

    gnd[GNR][gnl6]=gn0

  EndIf

EndSub



Sub sTraceNode '?Éé?Éº?Éâ?ÇíËøΩË∑°?Åô?Çã?? ?Ö•?äõ:gnd[][],gn0,gn1,gz0,gt0,gp0 ?á∫?äõ:gnd[][],gn0,gnb6

  If gn1=0 Then 'Â±??ù¢?Åå?ñ∞?Åó?ÅÑ??

    If gt0>0 then

      If gn0=0 Then '?àù?âã(?Éé?Éº?Éâ?Åå?Ñ°?ÅÑ??)

        gt0=1

        gp0=GEBLACK

        gnb6=0

        gnl6=0

        sAddNode()

        gnb6=1

        Goto End_sTraceNode

      ElseIf gnd[GNZ][1]=gz0 then

        gnb6=1

        Goto End_sTraceNode

      EndIf

    Else

      If gn0=0 Then '?àù?âã(?Éé?Éº?Éâ?Åå?Ñ°?ÅÑ??) 

        gnb6=0

        gnl6=0

        sAddNode()

        gnb6=1

        Goto End_sTraceNode

      ElseIf gnd[GNZ][1]=gz0 then

        gnb6=1

        Goto End_sTraceNode

      EndIf

    EndIf

  endif

  nf6=gnd[GNF][gn1]

  If nf6=0 Then 'Ê¨°„ÅÆ?âã?ÅÆ?ôË£ú?Åå?Ñ°?ÅÑ?? forward

    gnb6=gn1

    gnl6=0

    sAddNode()

    gnb6=gn0

    Goto End_sTraceNode

  endif

  

  If gnd[GNT][nf6]=0 Then 'Ê¨°„ÅåË®òÂè∑?ÅÆ?†¥?êà?ÅÊ?Âæå„ÅÆË®òÂè∑?ÅÆÂæå„Å´ËøΩÂä†?Åô?Çã??

    While nf6<>0

      nb6=nf6

      nf6=gnd[GNF][nf6]

    EndWhile

    gnb6=nb6

    gnl6=0

    sAddNode()

    gnb6=gn0

    Goto End_sTraceNode

  EndIf

  

  If gnd[GNZ][nf6]=gz0 Then

    gnb6=nf6

    Goto End_sTraceNode

  endif

  nr6=nf6

  nf6=gnd[GNR][nf6]

  While nf6<>0

    If gnd[GNZ][nf6]=gz0 then

      gnb6=nf6

      Goto End_sTraceNode

    EndIf

    nr6=nf6

    nf6=gnd[GNR][nf6]

  EndWhile

  gnb6=0 'Ê¨°„ÅÆ?âã?ÅÆ?ôË£ú?ÇíËøΩÂä†?Åô?Çã?Çright

  gnl6=nr6

  sAddNode()

  gnb6=gn0

  

  End_sTraceNode:

EndSub



Sub sMessage '?õ§?ÅÆ‰∏ã„Å´?É°?ÉÉ?Çª?Éº?Ç∏?ÇíË°®Á§∫?Åô?Çã?? ?Ö•?äõ:gtext0 ?á∫?äõ:?îª?ù¢

  l2=Text.GetLength(gtext0)

  if l2>GMLEN Then

    gtext0=Text.GetSubText(gtext0,l2-GMLEN+1,GMLEN)

  EndIf

  Shapes.SetText(oMessage1,gtext0)

  'Sound.PlayBellRing()

EndSub



Sub sDispStone '?ü≥(Ê¨°„ÅÆ?âã)?ÇíË°®Á§∫?Åô?Çã??(Z) ?Ö•?äõ:gz8,gc8 ?á∫?äõ:?îª?ù¢

  If gxyz=0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz8-1,GLN+4)-1

    j2=math.Ceiling((gz8-1)/(GLN+4))-2

  endif

  GraphicsWindow.brushcolor=gcol0

  oStone[i2][j2]=Shapes.AddEllipse(GWD,GWD)

  Shapes.HideShape(oStone[i2][j2])

  Shapes.Move(oStone[i2][j2],GWD*(i2-1/2),GWD*(j2-1/2))

  Shapes.ShowShape(oStone[i2][j2])

EndSub



Sub sDispNum '?ï™?è∑?ÇíË°®Á§∫?Åô?Çã?? ?Ö•?äõ:gi0,gj0,gp0,gt0 ?á∫?äõ:?îª?ù¢

  If gt0<10 Then

    iDif2=1/4

  ElseIf gt0<100 then

    iDif2=1/3

  Else

    iDif2=1/2

  EndIf

  GraphicsWindow.brushcolor=GCOL[GEBW-gp0]

  oNum[gi0][gj0]=shapes.AddText("")

  Shapes.SetText(oNum[gi0][gj0],gt0)

  Shapes.Move(oNum[gi0][gj0],GWD*(gi0-iDif2),GWD*(gj0-1/3))

EndSub



Sub sDispSignA 'Ë®òÂè∑(A)?ÇíË°®Á§∫?Åô?Çã??(Z) ?Ö•?äõ:gz8,gsign8 ?á∫?äõ:?îª?ù¢

  If gxyz=0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz8-1,GLN+4)-1

    j2=math.Ceiling((gz8-1)/(GLN+4))-2

  endif

  if Text.GetLength(gsign8)>2 Then

    sign2=Text.GetSubText(gsign8,1,2)

    gtext0=gsign8

    sMessage()

  Else

    sign2=gsign8

  endif

  GraphicsWindow.brushcolor=GCOL[1]

  oNum[i2][j2]=shapes.AddText("")

  Shapes.SetText(oNum[i2][j2],sign2)

  Shapes.Move(oNum[i2][j2],GWD*(i2-1/3),GWD*(j2-1/3))

EndSub



Sub sDispNext 'Ê¨°„ÅÆ?âã?ÇíË°®Á§∫?Åô?Çã?ÇÂÖ•?äõ:gnd[],gn1 ?á∫?äõ:?îª?ù¢

  gButton=1 '?Éú?Çø?É≥?Çí?úâ?äπ?Å´?Åô?Çã??

  If gt0=0 Then

    Goto End_sDispNext

  EndIf

  If gn1=0 Then

    Goto End_sDispNext

  EndIf

  nfr2=gnd[GNF][gn1]

  If nfr2=0 Then

    Goto End_sDispNext

  endif

  

  While nfr2<>0

    gz8=gnd[GNZ][nfr2]

    p8=gnd[GNP][nfr2]

    if p8=GEBLACK Or p8=GEWHITE then

      gButton=0 '?Éú?Çø?É≥?Çí?Ñ°?äπ?Å´?Åô?Çã??

      gxyz=1

      gcol0=GCOL[3] 'Ê¨°„ÅÆ?âã?ÅÆ?â≤?ÇíË®?ÂÆö„Åô?Çã??

      sDispStone()

      

      nfr2=gnd[GNR][nfr2]

      While nfr2<>0

        gz8=gnd[GNZ][nfr2]

        gxyz=1

        gcol0=GCOL[3] 'Ê¨°„ÅÆ?âã?ÅÆ?â≤?ÇíË®?ÂÆö„Åô?Çã??

        sDispStone()

        nfr2=gnd[GNR][nfr2]

      EndWhile

      Goto End_sDispNext

    ElseIf p8=GESIGNA then

      gt0=0

      gsign8=gnd[GNS][nfr2]

      gbd[gnd[GNZ][nfr2]]=p8

      gxyz=1

      sDispSignA()

    elseif p8=GESIGNB or p8=GESIGNW then

      gt0=0

      gbd[gnd[GNZ][nfr2]]=p8

      gxyz=1

      gcol0=GCOL[p8-GESIGNA]

      sDispStone()

    endif

    nfr2=gnd[GNF][nfr2]

  endwhile

  

  End_sDispNext:

EndSub



Sub sEraseNext 'Ê¨°„ÅÆ?âã?ÇíÊ∂àÂéª?Åô?Çã?ÇÂÖ•?äõ:gnd[],gn1 ?á∫?äõ:?îª?ù¢

  'If gt0=0 Then '?ü≥?ÅåÁΩ??Åã?Çå?Å¶?ÅÑ?Å™?ÅÑ??

    'Goto End_sEraseNext

  'EndIf

  If gn1=0 Then '?ü≥?ÅåÁΩ??Åã?Çå?Å¶?ÅÑ?Å™?ÅÑ??

    Goto End_sEraseNext

  EndIf

  nfr2=gnd[GNF][gn1]

  If nfr2=0 Then

    Goto End_sEraseNext

  endif

  

  While nfr2<>0

    z2=gnd[GNZ][nfr2]

    i2=math.Remainder(z2-1,GLN+4)-1

    j2=math.Ceiling((z2-1)/(GLN+4))-2

    Shapes.remove(oStone[i2][j2])

    Shapes.remove(oNum[i2][j2])

    p2=gnd[GNP][nfr2]

    If p2=GEBLACK Or p2=GEWHITE Then

      Goto Right_sEraseNext

    Else

      nfr2=gnd[GNF][nfr2]

    EndIf

  EndWhile

  

  Right_sEraseNext:

  nfr2=gnd[GNR][nfr2]

  While nfr2<>0

    z2=gnd[GNZ][nfr2]

    i2=math.Remainder(z2-1,GLN+4)-1

    j2=math.Ceiling((z2-1)/(GLN+4))-2

    Shapes.remove(oStone[i2][j2])

    Shapes.remove(oNum[i2][j2])

    nfr2=gnd[GNR][nfr2]

  EndWhile

  

  End_sEraseNext:

EndSub



Sub sDispPut '?ü≥?ÇíÁΩ??Åè??

  gxyz=0

  gcol0=GCOL[gp0]

  sDispStone()

  sDispNum()

  If gp0=GEBLACK Then

    sFieldB8()

  Else

    sFieldW8()

  EndIf

  'gtext0=gtext0+GROLE[gp0]+":"+GROLE[ge0]

  'sMessage()

  'If ge0=GE5 Then

  '  gtext0=gtext0+GROLE[gp0]+"?ÅÆ?ãù?Å°"

  '  sMessage()

  'ElseIf ge0=GE6 then

  '  gtext0=gtext0+"Èªí„ÅÆÁ¶ÅÊâã?Åß?Åô?ÇÁôΩ?ÅÆ?ãù?Å°"

  '  sMessage()

  'EndIf

EndSub



Sub sWriteNode '?Éé?Éº?Éâ?Çí?õ∏?ÅçËæº„???

  Controls.SetButtonCaption(bWrite,"?Üì?õ∏Ëæº„Åø")

  If gn0>0 then

    For n2=1 To gn0

      buf2=""

      For k2=1 to 8

        buf2=buf2+gnd[k2][n2]+","

      EndFor

      buf2=buf2+gnd[9][n2]

' The following line could be harmful and has been automatically commented.

'       File.WriteLine(GFILENODE,n2,buf2)

    EndFor

  EndIf

  Controls.SetButtonCaption(bWrite,"?õ∏Ëæº„Åø")

EndSub



Sub sSplitLine 'Ë°å„Çí?àÜ?â≤?Åô?Çã??

  if Text.GetLength(gLine9)>0 Then

    i2=Text.GetIndexOf(gLine9,",")

    j2=1

    While i2>0

      gnd[j2][gn9]=Text.GetSubText(gLine9,1,i2-1)

      gtext0=gtext0+gnd[j2][gn9]+","

      sMessage()

      gLine9=Text.GetSubTextToEnd(gLine9,i2+1)

      j2=j2+1

      i2=Text.GetIndexOf(gLine9,",")

    Endwhile

    gnd[j2][gn9]=gLine9

    gtext0=gtext0+gnd[j2][gn9]+","

    sMessage()

  EndIf

EndSub



Sub sReadNode '?Éé?Éº?Éâ?ÇíË™??ÅøËæº„???

  Controls.SetButtonCaption(bRead,"?ÜìË™?Ëæº„Åø")

  gn9=1

  Loop_sRead:

' The following line could be harmful and has been automatically commented.

'     gLine9=File.ReadLine(GFILENODE,gn9)

    If gLine9="" then

      goto End_sRead

    EndIf

    sSplitLine()

    gn9=gn9+1

  Goto Loop_sRead

  End_sRead:

  gn0=gn9-1

  gn1=0

  gt0=1

  gp0=GEBLACK

  Controls.SetButtonCaption(bRead,"Ë™?Ëæº„Åø")

EndSub



Sub sAlternate '?Éú?Çø?É≥?êç?Çí?àª?Åô??

  if gp0=GESIGNB then

    Controls.SetButtonCaption(bBlack,"Èª?")

  elseif gp0=GESIGNW then

    Controls.SetButtonCaption(bWhite,"?ôΩ")

  elseif gp0=GESIGNA then

    Controls.SetButtonCaption(bSign,"Ë®òÂè∑")

  endif

EndSub



Sub sInitGame

  Controls.SetButtonCaption(bInit,"?Üì?àù?úü?åñ")

  sInitBoard()

  sDispBoard()

  gn1=0

  gt0=1

  gp0=GEBLACK

  Controls.SetButtonCaption(bInit,"?àù?úü?åñ")

EndSub



Sub eMouseSign

  If gn0=0 Then

    Goto End_eMouseSign '?àù?âã?Å´Ë®òÂè∑?ÇíÁΩ??Åë?Å™?ÅÑ??

  EndIf

  If gbd[gz0]<>GEFIELD and gbd[gz0]<>GEOUT Then

    sDelSign() 'Ë®òÂè∑(A?Åæ?Åü?ÅØ?ü≥)?ÇíÊ∂àÂéª?Åô?Çã??

    Goto End_eMouseSign

  EndIf

  If gp0=GESIGNA Then

    gsign8=Controls.GetTextBoxText(bContent)

    If gsign8="" Then

      Goto End_eMouseSign

    EndIf

    gbd[gz0]=gp0

    gxyz=0

    sDispSignA() 'Ë®òÂè∑(A)?ÇíÁΩ??Åè??

  ElseIf gp0=GESIGNB or gp0=GESIGNW then

    gbd[gz0]=gp0

    gxyz=0

    gcol0=GCOL[gp0-GESIGNA]

    sDispStone() 'Ë®òÂè∑(?ü≥)?ÇíÁΩ??Åè??

  EndIf

  sTraceNode()

  gn1=gnb6

  sDebugNode()

  

  End_eMouseSign:

EndSub



Sub sClearNode '?Éé?Éº?Éâ?ÇíÊ∂àÂéª?Åô?Çã??

  z2=gnd[GNZ][gn3]

  If z2=0 Then '?ÉÅ?Çß?ÉÉ?ÇØ?Åô?Çã??

    Goto End_sClearNode

  endif

  p2=gbd[z2]

  If p2<>GEBLACK And p2<>GEWHITE Then

    Goto End_sClearNode

  endif

  gbd[z2]=GEFIELD '?õ§?ÅÆ?ü≥?ÅÆ?Éá?Éº?Çø?ÇíÊ∂àÂéª?Åô?Çã??

  i2=math.Remainder(z2-1,GLN+4)-1 '?õ§?ÅÆ?ü≥?ÇíÊ∂àÂéª?Åô?Çã??

  j2=math.Ceiling((z2-1)/(GLN+4))-2

  Shapes.remove(oNum[i2][j2])

  Shapes.remove(oStone[i2][j2])

  For k2=1 To 8 '?Éé?Éº?Éâ?ÅÆ?Éá?Éº?Çø?ÇíÊ∂àÂéª?Åô?Çã??

    gnd[k2][gn3]=0

  endfor

  gnd[9][gn3]=""

  If gn3=gn0 Then '?Éé?Éº?Éâ?ï∞(gn0)?Çí?âäÊ∏õ„Åô?Çã??

    gn0=gn0-1

    While gnd[GNZ][gn0]=0

    gn0=gn0-1

    if gn0<1 Then

      Goto End_sClearNode

    EndIf

  EndWhile

  EndIf

  

  End_sClearNode:

  'sInitGame()

  'sDebugNode()

EndSub



Sub sDelStone '?ü≥?ÇíÊ∂àÂéª?Åô?Çã??

  n2=gn1??'??Âæå„Å´Ë°®Á§∫?Åï?Çå?Åü?ü≥?ÅÆ??é„Éº?Éâ(gn1)

  If n2=0 Then

    Goto End_sDelStone

  EndIf

  z2=gnd[GNZ][n2] '?ÇØ?É™?ÉÉ?ÇØ?Åó?Åü?ü≥?ÅÆ?Éé?Éº?Éâ(n2)?ÇíÊ±Ç„ÇÅ?Çã?ÇBack

  while z2<>gz0

    n2=gnd[GNB][n2]

    If n2=0 Then

      Goto End_sDelStone

    EndIf

    z2=gnd[GNZ][n2]

  EndWhile

  n3=n2 'Ê¨°„ÅÆ?Éé?Éº?Éâ?Åå?Ñ°?ÅÑ??Âæå„ÅÆ?Éé?Éº?Éâ(n3)?ÇíÊ±Ç„ÇÅ?Çã?ÇForward

  

  F_sDelStone:

  nf2=gnd[GNF][n3]

  While nf2<>0

    n3=nf2

    nf2=gnd[GNF][nf2]

  EndWhile

  nb2=gnd[GNB][n3]

  nr2=gnd[GNR][n3]

  nl2=gnd[GNL][n3]

  If nb2=0 then

    sInitGame()

    Goto End_sDelStone

  EndIf

  If nl2=0 then

    gnd[GNF][nb2]=nr2

    If nr2=0 Then

      n4=nb2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

    else

      gnd[GNB][nr2]=nb2

      gnd[GNL][nr2]=0

      n4=nr2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

    EndIf

  else

    'gnd[GNR][nl2]=nr2

    If nr2=0 Then

      gnd[GNR][nl2]=nr2

      n4=nl2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

      

      gtext0="test"

      sMessage()

      Goto End_sDelStone

      gn3=n3

      sClearNode() 'n3?Éé?Éº?Éâ?ÇíÊ∂àÂéª?Åô?Çã??

      n3=n4

      Goto End_sDelStone

    

    else

      gnd[GNR][nl2]=nr2

      gnd[GNL][nr2]=nl2

      n4=nr2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

    EndIf

    'n4=nl2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

    'n4=nr2 'Ê∂àÂéª?Åô?Çã‰∫àÂÆö?ÅÆ?Éé?Éº?Éâ

  EndIf

  gn3=n3

  sClearNode() 'n3?Éé?Éº?Éâ?ÇíÊ∂àÂéª?Åô?Çã??

  If n3<>n2 Then

    n3=n4

    Goto F_sDelStone

  EndIf

    

  End_sDelStone:

endsub



Sub sDelSign 'Ë®òÂè∑(A?Åæ?Åü?ÅØ?ü≥)?ÇíÊ∂àÂéª?Åô?Çã??

  If gn1>0 then

    nb2=gnd[GNB][gn1]

    If nb2=0 Then

      nb2=1

    endif

  Else

    nb2=1

  EndIf

  nf2=nb2

  While nf2<>0

    If gnd[GNZ][nf2]=gz0 Then

      goto Del_sDelSign

    endif

    nb2=nf2

    nf2=gnd[GNF][nf2]

  EndWhile

  Goto End_sDelSign

  

  Del_sDelSign:

  nf3=gnd[GNF][nf2]

  gnd[GNF][nb2]=nf3

  If nf3<>0 then

    gnd[GNB][nf3]=nb2

  endif

  gnd[GNZ][nf2]=0

  gnd[GNB][nf2]=0

  gnd[GNF][nf2]=0

  gnd[GNR][nf2]=0

  gnd[GNL][nf2]=0

  gnd[GNP][nf2]=0

  gnd[GNS][nf2]=""

  If gi0<>0 Then

    i2=gi0

    j2=gj0

  else

    i2=math.Remainder(gz0-1,GLN+4)-1

    j2=math.Ceiling((gz0-1)/(GLN+4))-2

  endif

  p2=gbd[gz0]

  If p2=GESIGNA Then

    Shapes.remove(oNum[i2][j2]) 'Ë®òÂè∑(A)?ÇíÊ∂àÂéª?Åô?Çã??

  elseIf p2=GESIGNB Or p2=GESIGNW Then

    Shapes.remove(oStone[i2][j2]) 'Ë®òÂè∑(?ü≥)?ÇíÊ∂àÂéª?Åô?Çã??

  endif

  gbd[gz0]=GEFIELD

  

  End_sDelSign:

endsub



Sub sDispBoard '?õ§?ÇíË°®Á§∫?Åô?Çã?? ?á∫?äõ:?îª?ù¢

  GraphicsWindow.Clear()

  GraphicsWindow.Title = "?£Áè†"

  GraphicsWindow.Height = GWD*(GLN+2)

  GraphicsWindow.Width = GWD*(GLN+1)

  GraphicsWindow.FontSize=GWD/2

  GraphicsWindow.backgroundcolor=GCOL[4]

  GraphicsWindow.brushcolor=GCOL[1]

  For j2=1 to GLN 'Á∑ö„ÇíÂºï„Åè??

    GraphicsWindow.DrawLine(GWD,GWD*j2,GWD*GLN,GWD*j2)

  endfor

  For i2=1 to GLN

    GraphicsWindow.DrawLine(GWD*i2,GWD,GWD*i2,GWD*GLN)

  endfor

  For j2=4 To 12 Step 4 '?òü?Çí?èè?Åè??

    For i2=4 To 12 Step 4

      GraphicsWindow.FillEllipse(GWD*(i2-1/8),GWD*(j2-1/8),GWD/4,GWD/4)

    EndFor

  EndFor

  'For i2=1 To 9 'Ê®™„ÅÆÂ∫ßÊ®ô?Çí?õ∏?Åè??

  '  GraphicsWindow.DrawBoundText(GWD*(i2-1/8),0,GWD,i2)

  'endfor

  'For i2=10 To GLN

  '  GraphicsWindow.DrawBoundText(GWD*(i2-1/4),0,GWD,i2)

  'endfor

  'For j2=1 To 9 'Á∏¶„ÅÆÂ∫ßÊ®ô?Çí?õ∏?Åè??

  '  GraphicsWindow.DrawBoundText(GWD/3,GWD*(j2-1/4),GWD,j2)

  'endfor

  'For j2=10 To GLN

  '  GraphicsWindow.DrawBoundText(0,GWD*(j2-1/4),GWD,j2)

  'endfor

  For i2=GLN To 11 Step -1'Ê®™„ÅÆÂ∫ßÊ®ô?Çí?õ∏?Åè??

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),0,GWD,GDIG[10])

  endfor

  For i2=GLN To 11 Step -1

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),GWD/2,GWD,GDIG[i2-10])

  endfor

  For i2=10 To 1 Step -1

    GraphicsWindow.DrawBoundText(GWD*(GLN+1-i2-1/8),GWD/2,GWD,GDIG[i2])

  endfor

  For j2=1 To 9 'Á∏¶„ÅÆÂ∫ßÊ®ô?Çí?õ∏?Åè??

    GraphicsWindow.DrawBoundText(GWD*(GLN+1/3),GWD*(j2-1/4),GWD,j2)

  endfor

  For j2=10 To GLN

    GraphicsWindow.DrawBoundText(GWD*GLN,GWD*(j2-1/4),GWD,j2)

  endfor

  oMessage1=shapes.AddText("") '?É°?ÉÉ?Çª?Éº?Ç∏?ÇíË°®Á§∫?Åô?Çã??

  shapes.SetText(oMessage1,"")

  Shapes.Move(oMessage1,GWD,GWD*GLN)

  bEnd=Controls.AddButton("ÁµÇ‰∫Ü",GWD/2,GWD*(GLN+1)) '?Éú?Çø?É≥?ÇíË°®Á§∫?Åô?Çã??

  bWrite=Controls.AddButton("?õ∏Ëæº„Åø",GWD*2,GWD*(GLN+1))

  bRead=Controls.AddButton("Ë™?Ëæº„Åø",GWD*4,GWD*(GLN+1))

  bInit=Controls.AddButton("?àù?úü?åñ",GWD*6,GWD*(GLN+1))

  bBlack=Controls.AddButton("Èª?",GWD*8,GWD*(GLN+1))

  bWhite=Controls.AddButton("?ôΩ",GWD*9,GWD*(GLN+1))

  bContent=Controls.AddTextBox(GWD*10,GWD*(GLN+1))

  Controls.SetSize(bContent,GWD,GWD*3/4)

  Controls.SetTextBoxText(bContent,"A")

  bSign=Controls.AddButton("Ë®òÂè∑",GWD*23/2,GWD*(GLN+1))

  bDel=Controls.AddButton("?âä?ô§",GWD*13,GWD*(GLN+1))

EndSub



Sub eClick '?Éú?Çø?É≥?Çí?ÇØ?É™?ÉÉ?ÇØ?Åó?Åü?ôÇ?ÅÂá¶?êÜ?Åô?Çã??

  iLast=Controls.LastClickedButton

  if iLast=bEnd then

    Program.End()

  elseif iLast=bWrite then

    sWriteNode()

  elseif iLast=bRead then

    sInitGame()

    sReadNode()

  elseIf iLast=bInit Then

    sInitGame()

  elseif iLast=bBlack then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNB

      Controls.SetButtonCaption(bBlack,"?ÜìÈª?")

    endif

  elseif iLast=bWhite then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNW

      Controls.SetButtonCaption(bWhite,"?Üì?ôΩ")

    endif

  elseif iLast=bSign then

    If gButton=1 then

      gt0=0

      sAlternate()

      gp0=GESIGNA

      Controls.SetButtonCaption(bSign,"?ÜìË®òÂè∑")

    endif

  elseif iLast=bDel then

    If gButton=1 then

      

      Controls.SetButtonCaption(bSign,"?Üì?âä?ô§")

    endif

  EndIf

EndSub



Sub eMouse '?Éû?Ç¶?Çπ

  gi0=math.ceiling((GraphicsWindow.MouseX+GWD/2)/GWD)-1

  gj0=math.ceiling((GraphicsWindow.MouseY+GWD/2)/GWD)-1

  If gi0<1 or gi0>GLN or gj0<1 or gj0>GLN Then

    Goto End_eMouse

  EndIf

  gz0=(GLN+4)*(gj0+1)+gi0+2

  If gt0>0 Then

    p2=gbd[gz0]

    If p2=GEBLACK Or p2=GEWHITE Then

      sDelStone()

      Goto End_eMouse

    endif

    'Ê¨°„ÅÆ?âã?Çí?†¥?ÅÆ?Åø?Å´?à∂?ôê?Åô?Çã??

    'If p2<>GEFIELD Then

    'Ê¨°„ÅÆ?âã?Çí?†¥?Å®?†¥?ÅÆÂ§ñ„Å´?à∂?ôê?Åô?Çã??

    If p2<>GEFIELD and p2<>GEOUT Then

      Goto End_eMouse

    EndIf

    gbd[gz0]=gp0 '?ü≥?ÇíÁΩ??Åè??

    sSetField() '?†¥?ÇíË®?ÂÆö„Åô?Çã??

    sEraseNext()

    sDispPut()

    sTraceNode()

    gn1=gnb6

    sDebugNode()

    sDispNext()

    If gt0>0 Then

      gt0=gt0+1

      gp0=GEBW-gp0

    Else

      gp0=GESIGNA

      Controls.SetButtonCaption(bSign,"?ÜìË®òÂè∑")

    Endif

  Else

    eMouseSign()

  EndIf

  

  End_eMouse:

EndSub


