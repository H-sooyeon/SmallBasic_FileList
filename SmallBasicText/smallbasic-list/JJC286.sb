encod=0

grey=18

razmi[0]=0

razmt[0]=0

vrun=0

nt=0

zenc[0]=335

zenc[1]=745

zenc[2]=1165

zenc[3]=1880

cpl=1.6

cdl=3

c=0

H=0

For i=0 to 3

l[i]=0

endfor

z=0

Sensor.SetMode(2, 0)

Sensor.SetMode(3, 0)

Sensor.SetMode(4,4)

Indicatory() '?ò–Ω–¥–∏–∫–∞—Ç–æ—???

EV3.SetLEDColor("OFF","NORMAL") '?í—ã–∫–ª—é—á–µ–Ω–∏–? –ø–æ–¥?Å–≤–µ—Ç–∫–?

Speaker.Tone(100,500,400) 

Motor.StartPower("C",100) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ "C" –Ω–∞ –ø–æ–≤–æ?–æ?? –æ?? –∏–Ω–¥–∏–∫–∞?Ç–æ—?–æ–≤

Motor.ResetCount("C") '?û–±–Ω—É–ª–µ–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–∞

While Motor.GetCount("C")<450 '?û–∂–∏–¥–∞–Ω–∏–? –Ω?É–∂–Ω–æ–≥–? ?ç–Ω–∫–æ–¥–??–∞

EndWhile

Motor.StartPower("B",-100) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ "B" –¥–ª?? –µ–∑–¥?? –ø??è–º–?

While Sensor.ReadPercent(3)>grey '?ï–∑–¥–? –¥–æ ?á–µ—?–Ω–æ–π –ª–∏–Ω–∏–∏

EndWhile

Motor.Stop("B–°","True") '?û—Å—Ç–∞–Ω–æ–≤–∫–? –º–æ?Ç–æ—?–æ–≤ ?? –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–µ?–µ–¥ –ø–æ–≤–æ?–æ?Ç–æ–? –∫ ?Å–∫–ª–∞–¥—?

Program.Delay(100)

Motor.StartPower("C",100) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–≤ "C" –¥–ª?? –ø–æ–≤–æ?–æ?Ç–? –∫ ?Å–∫–ª–∞–¥—?

Motor.ResetCount("C")

While Motor.GetCount("C")<20 '–ß–∞?Å—Ç—? –ø–æ–≤–æ?–æ?Ç–? –Ω–∞ ?ç–Ω–∫–æ–¥–µ—?

EndWhile

While Sensor.ReadPercent(2)>grey ' ?ü–æ–≤–æ—?–æ?? –¥–æ ?á–µ—?–Ω–æ–π –ª–∏–Ω–∏–∏

EndWhile

Motor.Stop("BC", "True") '?û—Å—Ç–∞–Ω–æ–≤–∫–? –º–æ?Ç–æ—?–æ–≤ ?? –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–µ?–µ–¥ –µ–∑–¥–æ–π –∫ ?Å–∫–ª–∞–¥—?

Program.Delay(100)

Speaker.Tone(100,500,100)

encod=150

Motor.StartPower("D",100) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ "D" –¥–ª?? –æ–ø?É—Å–∫–∞–Ω–∏—? –∫–ª–µ?à–Ω–?

V1=65

V2=65

Enc()

Perecrestock()

cpl=2.3

cdl=3

Panely() '?ü–∞–Ω–µ–ª–?

V1=80

V2=80

encpov=115

Povorot()

Povorot()

encpov=0

Motor.StartPower("B",-100)

Motor.StartPower("C",-100)

Program.Delay(50)

Speaker.Tone(100,500,100)

Motor.Stop("BC","True") '?û—Å—Ç–∞–Ω–æ–≤–∫–? –º–æ?Ç–æ—?–æ–≤ ?? –æ–∂–∏–¥–∞–Ω–∏–µ–º –ø–æ?Å–ª–? ?–∞–∑–≤–æ?–æ?Ç–?

Program.Delay(100)

z=3

Perevozka()

minus=0

V1=95

V2=95

Perecrestock()

MeritDerevya()

LCD.Clear()

For tr=0 to 3

  LCD.Write(razmt[tr],0,tr*20)

EndFor

encodb=75 '?ó–∞–¥–∞—á–? ?ç–Ω–∫–æ–¥–µ—?–∞ –∫ 1 –ø–∞?–µ –¥–µ?–µ–≤?å–µ–?

Derevya()

LCD.Clear()

For tr=0 to 3

  LCD.Write(razmt[tr],0,tr*20)

EndFor

Finish() '–§–∏–Ω–∏??



Sub Derevya

  LCD.Clear()

  For tr=0 to 3

    LCD.Write(razmt[tr],0,tr*20)

  EndFor

  nt=0

  Zone()

  If vrun<>1 Then

    Speaker.Tone(100,1000,100)

    x=4

    EncBlue()

    Motor.Stop("B","True") 

    Motor.Move("C",95,90,"False") '?ü–æ–≤–æ—?–æ?? –∫ 1 –¥–µ?–µ–≤??

    Motor.MoveSync("BC",-95,95,170,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 1 –¥–µ?–µ–≤–∞  

    Motor.StartPower("B",100)

    Motor.StartPower("C",-100)

    Program.Delay(100)

    Motor.Stop("BC","True")

    Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 1 –¥–µ?–µ–≤–∞

    Motor.Move("D",-15,60,"True")

    Motor.MoveSync("BC",95,-95,190,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 1 –¥–µ?–µ–≤–∞

    Motor.Stop("B","True")

    Sensor.SetMode(3,4)

    B=Sensor.ReadRaw(3,3)

    Motor.Start("C",-65)

    While B[2]>34.5

      B=Sensor.ReadRaw(3,3)

    EndWhile

    Motor.Move("C",-65,45,"True")

    Program.Delay(200)

    Sensor.SetMode(3,0)

    Speaker.Tone(100,500,100)

    Motor.Start("D",-15)

    Yesda()

    PovorotDerevya()

    V1=50

    V2=50

    Povorot()

    Motor.Stop("BC","True")

    Program.Delay(100)

    Perevozka()

    V1=95

    V2=95

    Perecrestock()

  EndIf

  vrun=0

  nt=1

  Zone()

  If vrun<>1 Then

    Speaker.Tone(100,800,100)

    EncBlue()

    Motor.Stop("C","True")

    Motor.Move("B",-95,110,"False") '?ü–æ–≤–æ—?–æ?? –∫–æ 2 –¥–µ?–µ–≤??

    Motor.MoveSync("BC",-95,95,200,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 2 –¥–µ?–µ–≤–∞

    Motor.StartPower("B",100)

    Motor.StartPower("C",-100)

    Program.Delay(100)

    Motor.Stop("BC","True")

    Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 2 –¥–µ?–µ–≤–∞

    Motor.Move("D",-15,60,"True")

    Motor.MoveSync("BC",95,-95,125,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 2 –¥–µ?–µ–≤–∞

    Motor.Stop("C","True")

    Motor.Start("B",65) '?î–æ–≤–æ—?–æ?? –¥–æ –ª–∏–Ω–∏–∏

    Sensor.SetMode(2,4)

    B=Sensor.ReadRaw(2,3)

    While B[2]>34.5

      B=Sensor.ReadRaw(2,3)

    EndWhile

    Motor.Move("B",65,30,"True")

    Program.Delay(200)

    Sensor.SetMode(2,0)

    Motor.Start("D",-15)

    Yesda()

    PovorotDerevya()

    V1=50

    V2=50

    Povorot()

    Motor.Stop("BC","True")

    Program.Delay(100)

    LCD.Clear()

    LCD.Write(0,0,c)

    LCD.Write(0,20,z)

    LCD.Write(0,40,H)

    Perevozka()

    V1=95

    V2=95

    Perecrestock()

  EndIf

  vrun=0

  encodb=322 '?ó–∞–¥–∞—á–? ?ç–Ω–∫–æ–¥–µ—?–∞ –∫–æ 2 –ø–∞?–µ –¥–µ?–µ–≤?å–µ–?

  nt=2

  Zone()

  If vrun<>1 Then

    Speaker.Tone(100,800,100)

    x=4

    EncBlue()

    Motor.Stop("B","True") 

    Motor.Move("C",95,60,"False") '?ü–æ–≤–æ—?–æ?? –∫ 3 –¥–µ?–µ–≤??

    Motor.MoveSync("BC",-95,95,170,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 3 –¥–µ?–µ–≤–∞  

    Motor.StartPower("B",100)

    Motor.StartPower("C",-100)

    Program.Delay(100)

    Motor.Stop("BC","True")

    Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 3 –¥–µ?–µ–≤–∞

    Motor.Move("D",-15,60,"True")

    Motor.MoveSync("BC",95,-95,190,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 3 –¥–µ?–µ–≤–∞

    Motor.Stop("B","True")

    Sensor.SetMode(3,4)

    B=Sensor.ReadRaw(3,3)

    Motor.Start("C",-65)

    While B[2]>34.5

      B=Sensor.ReadRaw(3,3)

    EndWhile

    Motor.Move("C",-65,45,"True")

    Program.Delay(200)

    Sensor.SetMode(3,0)

    Speaker.Tone(100,500,100)

    Motor.Start("D",-15)

    Yesda()

    PovorotDerevya()

    V1=50

    V2=50

    Povorot()

    Motor.Stop("BC","True")

    Program.Delay(100)

    LCD.Clear()

    LCD.Write(0,0,c)

    LCD.Write(0,20,z)

    LCD.Write(0,40,H)

    Perevozka()

    V1=95

    V2=95

    Perecrestock()

  EndIf

  vrun=0

  nt=3

  Zone()

  If vrun<>1 Then

    Speaker.Tone(100,800,100)

    EncBlue()

    Motor.Stop("C","True")

    Motor.Move("B",-95,95,"False") '?ü–æ–≤–æ—?–æ?? –∫–æ 4 –¥–µ?–µ–≤??

    Motor.MoveSync("BC",-95,95,200,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 4 –¥–µ?–µ–≤–∞

    Motor.StartPower("B",100)

    Motor.StartPower("C",-100)

    Program.Delay(100)

    Motor.Stop("BC","True")

    Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 4 –¥–µ?–µ–≤–∞

    Motor.Move("D",-15,60,"True")

    Motor.MoveSync("BC",95,-95,125,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 4 –¥–µ?–µ–≤–∞

    Motor.Stop("C","True")

    Motor.Start("B",65) '?î–æ–≤–æ—?–æ?? –¥–æ –ª–∏–Ω–∏–∏

    Sensor.SetMode(2,4)

    B=Sensor.ReadRaw(2,3)

    While B[2]>34.5

      B=Sensor.ReadRaw(2,3)

    EndWhile

    Motor.Move("B",65,15,"True")

    Program.Delay(200)

    Sensor.SetMode(2,0)

    Motor.Start("D",-15)

    Yesda()

    PovorotDerevya()

    V1=50

    V2=50

    Povorot()

    Motor.Stop("BC","True")

    Program.Delay(100)

    LCD.Clear()

    LCD.Write(0,0,c)

    LCD.Write(0,20,z)

    LCD.Write(0,40,H)

    Perevozka()

    V1=95

    V2=95

    Perecrestock()

  EndIf

EndSub



Sub Panely

  minus=5

  plus=150

  Motor.Stop("DB","True")

  Motor.Move("C",65,85,"False") '?ü–æ–≤–æ—?–æ?? –∫ –ø–µ?–≤–æ–π –ø–∞–Ω–µ–ª–∏

  cp=0.4

  cd=0.5

  encp=-90

  V1=65

  V2=65

  Pid() '?ü—?–æ–µ–∑–¥ –¥–æ –ø–µ?–≤–æ–π –ø–∞–Ω–µ–ª–∏

  Motor.Stop("BC","True")

  Motor.Move("D",-20,115,"True") '?í–∑—è—Ç–∏–? –ø–µ?–≤–æ–π –ø–∞–Ω–µ–ª–∏

  encd=-215

  Dugb() '?ü—?–æ–µ–∑–¥ –ø–æ –¥?É–≥–? –æ?? –ø–µ?–≤–æ–π –ø–∞–Ω–µ–ª–∏

  LCD.Write(0,40,Motor.GetCount("C"))

  Motor.Stop("BC","True")

  Program.Delay(100)

  Motor.Start("D",15) '?û–ø—É—Å–∫–∞–Ω–∏–? –ø–µ?–≤–æ–π –ø–∞–Ω–µ–ª–∏

  Program.Delay(400)

  V1=25

  V2=25

  encp=-175

  Pid() '?ü—?–æ–µ–∑–¥ –¥–æ –≤?Ç–æ—?–æ–π –ø–∞–Ω–µ–ª–∏

  Motor.Stop("BC","True")

  Motor.Move("D",-15,120,"True") '?í–∑—è—Ç–∏–? –æ–±–µ–∏?? –ø–∞–Ω–µ–ª–µ–π

  Motor.Start("D",-20)

EndSub



Sub Perevozka

  V1=95

  V2=95

  LCD.Clear()

  LCD.Write(0,0,zenc[z])

  Speaker.Tone(100,500,100)

  encod=zenc[z]+l[z]*200

  Enc()

  Motor.StartPower("B",100)

  Motor.StartPower("C",-100)

  Program.Delay(100)

  Motor.Stop(Text.GetCharacter(Math.Abs(Math.Remainder(z, 2)+66)),"True")

  Motor.Move(Text.GetCharacter(Math.Abs(Math.Remainder(z, 2)-67)), 95-(190*Math.Remainder(z, 2)), 380-10*Math.Remainder(z,2), "True") '?ü–æ–≤–æ—?–æ?? –∫ –∑–æ–Ω–µ

  Program.Delay(100)

  Motor.Start("D",10+Math.Abs(minus-5)) '?í—ã–≥—??É–∑–∫–?

  Program.Delay(450)

  Motor.MoveSync("BC", 95, -95, 210, "True") '?û—Ç—ä–µ–∑–? –Ω–∞–∑–∞–¥ –æ?? –∑–æ–Ω??

  Motor.Start(Text.GetCharacter(Math.Abs(Math.Remainder(z, 2)-67)), 95-(190*Math.Remainder(z, 2))) '?ü–æ–≤–æ—?–æ?? –æ?? –∑–æ–Ω??

  Motor.ResetCount(Text.GetCharacter(Math.Abs(Math.Remainder(z, 2)-67)))

  While Math.Abs(Motor.GetCount(Text.GetCharacter(Math.Abs(Math.Remainder(z, 2)-67))))<100

  EndWhile

  While Sensor.ReadPercent(Math.Remainder(z, 2)+2)>grey

  EndWhile

  Motor.Stop("BC","True")

  Program.Delay(50)

  encod=encod-plus-100

  Enc()

  Speaker.Tone(100,500,1500)

  l[z]=1

  plus=0

EndSub



Sub Indicatory

  x=1

  Sensor.SetMode(1,4)

  H=0

  CE=185

  S=0

  V=0

  min=0

  max=0

  For i=0 To 5

    m[i]=0

  EndFor

  n=0

  Motor.StartPower("A",20) ' ?ü–æ–ª–Ω–æ–? –∑–∞–∫??ã—Ç–∏–? –∫–ª–µ?à–Ω–?

  Motor.StartPower("B",-65) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ "B"

  Motor.StartPower("C",30) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ "C"

  While Sensor.ReadPercent(2)<grey '?û–∂–∏–¥–∞–Ω–∏–? –±–µ–ª–æ–≥–æ

  EndWhile

  Speaker.Tone(50,500,100)

  Motor.ResetCount ("BC") '?û–±–Ω—É–ª–µ–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–æ–≤ –Ω–∞ –º–æ?Ç–æ—?–∞?? "BC"

  Motor.SchedulePower("A",-40,0,60,0,"True") '?û—Ç–∫—??ã—Ç–∏–? –∫–ª–µ?à–Ω–? –Ω–∞ –Ω?É–∂—ã–? –≥?–∞–¥?É—?

  While Motor.GetCount("B")>-1115 And n<6 '?û—Å–Ω–æ–≤–Ω–æ–? ?Ü–∏–∫–? –≤ –¥–∞–Ω–Ω–æ–π ?Ñ—É–Ω–∫—Ü–∏–?

    While Motor.GetCount("C")<CE-55 '?û–∂–∏–¥–∞–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–∞ –¥–ª?? ?Å—á–∏—Ç—ã–≤–∞–Ω–∏—? RGB –¥–∞?Ç—á–∏–∫–æ–?

    EndWhile

    Colour() '?û–ø—?–µ–¥–µ–ª–µ–Ω–∏–µ ?Ü–≤–µ—Ç–?, HSV

    LCD.Write(0,30,Motor.GetCount("C"))

    While Motor.GetCount("C")<CE '?û–∂–∏–¥–∞–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–∞ –¥–ª?? –∑–∞?Ç—é–∫–∏–≤–∞–Ω–∏—? –∫?É–±–∏–∫–?

    EndWhile

    If S<0.64 Then '?í–µ—Ç–≤–ª–µ–Ω–∏–? –±–µ–ª?ã–?/–Ω–µ –±–µ–ª?ã–?

      c=0

    EndIf

    LCD.Write(0,0,c)

    Speaker.Tone(50,500,100)

    m[n]=c '?ó–∞–ø–∏—Å—? ?Ü–≤–µ—Ç–? –≤ –º–∞?Å—Å–∏–?

    Motor.ResetCount ("C")

    If m[n]=0 then '?ó–∞—Ç—é–∫–∏–≤–∞–Ω–∏–?/–Ω–µ–∑–∞?Ç—é–∫–∏–≤–∞–Ω–∏–? –∫?É–±–∏–∫–?

    Else

      Motor.Start("A",75) '?í–∫–ª—é—á–µ–Ω–∏–? –º–æ?Ç–æ—?–∞ –¥–ª?? –∑–∞?Ç—é–∫–∏–≤–∞–Ω–∏—?

      Program.Delay(200)

      Motor.SchedulePower("A", -100,0,60,0,"True") '?í–æ–∑–≤—?–∞?â–µ–Ω–∏–? –∫–ª–µ?à–Ω–? –Ω–∞ –Ω?É–∂–Ω—ã–? –≥?–∞–¥?É—?

    EndIf 

    n=n+1 '–£–≤–µ–ª–∏?á–µ–Ω–∏–? ?Å—á–µ—Ç—á–∏–∫–?

    CE=184

  EndWhile

  While Motor.GetCount("C")<205 '?û–∂–∏–¥–∞–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–∞ –ø–æ?Å–ª–? ?Ü–∏–∫–ª–?

  EndWhile

  LCD.Clear()

  For i=0 To 5 '?í—ã–≤–æ–? –º–∞?Å—Å–∏–≤–? ?Ü–≤–µ—Ç–æ–?

    LCD.Write(0,20*i,m[i])

    LCD.Write(20,20*i,razmi[i])

  EndFor

  Motor.Stop("B","True")

  Motor.Schedule("A",100,0,45,0,"True") '?ó–∞–∫—??ã—Ç–∏–? ?à—Ç–æ—?–∫–∏(–∫–ª–µ?à–Ω–?)

EndSub



Sub RGB2HSV

  LCD.Clear()

  RGB=Sensor.ReadRaw(x, 3)

  max=Math.Max(RGB[2],Math.Max(RGB[0],RGB[1]))

  min=Math.Min(RGB[2],Math.Min(RGB[0],RGB[1]))

  If min=max Then

    H=0

  ElseIf max=RGB[0] Then

    If RGB[1]>=RGB[2] Then

      H=60*((RGB[1]-RGB[2])/(max-min))

    ElseIf RGB[2]>RGB[1] Then

      H=60*((RGB[1]-RGB[2])/(max-min))+360

    EndIf 

  ElseIf max=RGB[1] Then

    H=60*((RGB[2]-RGB[0])/(max-min))+120

  ElseIf max=RGB[2] Then

    H=60*((RGB[0]-RGB[1])/(max-min))+240

  EndIf

  If max=0 Then

    S=0

  Else 

    S=1-(min/max)

  EndIf

  V=max

EndSub



Sub Colour

  RGB2HSV()

  If H>320 Or H<20 Then

    c=5

  ElseIf H>=20 and (H<60 or H=60) then

    c=4

  ElseIf H>60 and (H<320 or H=320) then

    c=3

  EndIf

  If c=3 Then

    If RGB[0]<13 Then

      razmi[n]=0

      LCD.Write(0,0,"small")

    Else

      razmi[n]=1

      LCD.Write(0,0,"big")

    EndIf

  ElseIf c=4 Then

    If RGB[2]<13 Then

      razmi[n]=0

      LCD.Write(0,0,"small")

    Else

      razmi[n]=1

      LCD.Write(0,0,"big")

    EndIf

  Else

    If RGB[1]<17 Then

      razmi[n]=0

      LCD.Write(0,0,"small")

    Else

      razmi[n]=1

      LCD.Write(0,0,"big")

    EndIf

  EndIf

EndSub



Sub ColourT

  RGB2HSV()

  If H>320 Or H<10 Then

    ct[nt]=5

  ElseIf H>=10 and (H<60 or H=60) then

    ct[nt]=4

  ElseIf H>60 and (H<320 or H=320) then

    ct[nt]=3

  EndIf

  If ct[nt]=3 Then

    If RGB[0]<12 Then

      razmt[nt]=0

      LCD.Write(0,0,"small")

    Else

      razmt[nt]=1

      LCD.Write(0,0,"big")

    EndIf

  ElseIf ct[nt]=4 Then

    If RGB[2]<20 Then

      razmt[nt]=0

      LCD.Write(0,0,"small")

    Else

      razmt[nt]=1

      LCD.Write(0,0,"big")

    EndIf

  Else

    If RGB[1]<16 Then

      razmt[nt]=0

      LCD.Write(0,0,"small")

    Else

      razmt[nt]=1

      LCD.Write(0,0,"big")

    EndIf

  EndIf

EndSub



Sub Perecrestock

  errold=0 '?û–±–Ω—É–ª–µ–Ω–∏–? errold

  Motor.ResetCount("B") '?û–±–Ω—É–ª–µ–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–∞ –Ω–∞ –º–æ?Ç–æ—?–µ "B"

  While Sensor.ReadPercent(2)>grey Or Sensor.ReadPercent(3)>grey Or Motor.GetCount("B")>-50 '?û—Å–Ω–æ–≤–Ω–æ–? ?Ü–∏–∫–? –≤ ?ç—Ç–æ–? ?Ñ—É–Ω–∫—Ü–∏–?

    err=Sensor.ReadPercent(2)-Sensor.ReadPercent(3) '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? –æ?à–∏–±–∫–?

    u=err*cpl+cdl*(err-errold) '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? ?É–ø—?–∞–≤–ª?è—é—â–µ–? –≤–æ–∑–¥–µ–π?Å—Ç–≤–∏–µ–?

    Motor.StartPower ("B", -V1-u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "B"

    Motor.StartPower ("C", V2-u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "C"

    errold=err '?ó–∞–ø–∏—Å—? err –≤ errold

    Program.Delay(10) '?ù–µ–±–æ–ª—å—à–æ–? –æ–∂–∏–¥–∞–Ω–∏–µ –≤ ?Ü–∏–∫–ª–?

  EndWhile

EndSub



Sub Povorot

  errold=0 '?û–±–Ω—É–ª–µ–Ω–∏–? errold

  Motor.ResetCount ("BC") '?û–±–Ω—É–ª–µ–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–æ–≤ –Ω–∞ –º–æ?Ç–æ—?–∞?? "BC"

  While Sensor.ReadPercent(2)>grey Or Motor.GetCount("B")<encpov '?û—Å–Ω–æ–≤–Ω–æ–? ?Ü–∏–∫–? –≤ ?ç—Ç–æ–? –ø?–æ–≥?–∞–º–º–µ

    err=Motor.GetCount("B")*V2/(V1-(minus*3))-Motor.GetCount("C") '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? –æ?à–∏–±–∫–?

    u=err*1.5+2.3*(err-errold) '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? ?É–ø—?–∞–≤–ª?è—â–µ–? –≤–æ–∑–¥–µ–π?Å—Ç–≤–∏–µ–?

    Motor.StartPower("B", V1-(minus*3)-u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "B"

    Motor.StartPower("C", V2+u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "C"

    errold=err '?ó–∞–ø–∏—Å—? err –≤ errold

    Program.Delay(10) '?ù–µ–±–æ–ª—å—à–æ–? –æ–∂–∏–¥–∞–Ω–∏–µ –≤ ?Ü–∏–∫–ª–?

  EndWhile

EndSub



Sub Enc

  errold=0

  Motor.ResetCount ("BC")

  While Motor.GetCount("B")>-encod

   err=Sensor.ReadPercent(2)-Sensor.ReadPercent(3)

   u=err*cpl+cdl*(err-errold)

   Motor.StartPower ("B", -V1-u)

   Motor.StartPower ("C", V2-u)

   errold=err

   Program.Delay(10)

 EndWhile

EndSub



Sub Finish

  Perecrestock()

  encodb=240

  EncBlue()

  LCD.Write(0,0,Motor.GetCount("B"))

  Motor.StartPower("D",-100)

  V1=95

  V2=45

  encp=-800

  cp=4

  cd=10

  Pid()

  LCD.Write(0,0,Motor.GetCount("B"))

  V1=60

  V2=60

  encp=-150

  Pid()

  Speaker.Tone(100,500,400)

  Motor.Stop("BC","True")

  LCD.Clear()

  LCD.Write(0,0,EV3.Time)

  Program.Delay(1000000)

EndSub



Sub Podyem

  Motor.Move("D",-15,20,"True")

EndSub



Sub Zone 

  i=0

  While (ct[nt]<>m[i] or razmt[nt]<>razmi[i]) And i<6

    i=i+1

  EndWhile

  z=Math.Abs(Math.Floor(i/2)-1)+Math.Floor(Math.Floor(i/2)/2)

  m[i]=15

  If i=6 Then

    vrun=1

  Else

    If Math.Remainder(i,2)=0 Then

      prib=1

    Else

      prib=-1

    EndIf

    i2=0

    While (ct[i2]<>m[i+prib] or razmt[i2]<>razmi[i+prib]) And i2<4

      i2=i2+1

    EndWhile

    If i2=4 Then

      vrun=1

    EndIf

  EndIf

EndSub



Sub Duga

  errold=0

  err=0

  u=0

  Motor.ResetCount ("BC")

  time=EV3.Time

  While EV3.Time-time<1800

   err=(Motor.GetCount("B")*(30/(-30)))-Motor.GetCount("C")

   u=err*0.2+0.3*(err-errold)

   Motor.StartPower("B", -30+u)

   Motor.StartPower("C", 30+u)

   errold=err

  EndWhile

EndSub



Sub Yesda

  errold=0

  Motor.ResetCount ("BC")

  While Sensor.ReadPercent(2)<grey and Sensor.ReadPercent(3)<grey

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 80-u)

   Motor.StartPower ("C", -80-u)

   errold=err

   Program.Delay(10)

  EndWhile

 Motor.ResetCount("BC")

  While Motor.GetCount("B")<50

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 80-u)

   Motor.StartPower ("C", -80-u)

   errold=err

   Program.Delay(10)

  EndWhile

  While Sensor.ReadPercent(2)>grey Or Sensor.ReadPercent(3)>grey

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 80-u)

   Motor.StartPower ("C", -80-u)

   errold=err

   Program.Delay(10)

  EndWhile

EndSub



Sub Dugb

  errold=0

  err=0

  u=0

  Motor.ResetCount ("BC")

  While Motor.GetCount("C")>encd

   err=(Motor.GetCount("C")*(10/(-55)))-Motor.GetCount("B")

   u=err*1+5*(err-errold)

   Motor.StartPower("B", 17+u)

   Motor.StartPower("C", -95+u)

   errold=err

   LCD.Clear()

   LCD.Write(0,0,u)

   LCD.Write(0,20,err)

  EndWhile

EndSub



Sub Pid

  errold=0

  err=0

  u=0

  Motor.ResetCount ("BC")

  time=EV3.Time

  While Motor.GetCount("B")>encp

   err=Motor.GetCount("B")*-(V2/V1)-Motor.GetCount("C")

   u=err*cp+cd*(err-errold)

   Motor.StartPower("B", -V1+u)

   Motor.StartPower("C", V2+u)

   errold=err

  EndWhile

EndSub



Sub EncBlue

  errold=0

  Motor.ResetCount ("BC")

  Sensor.SetMode(2,4)

  Sensor.SetMode(3,4)

  While Motor.GetCount("B")>-encodb

    d2d=Sensor.ReadRaw(2, 3)

    d3d=Sensor.ReadRaw(3, 3)

    err=d2d[2]-d3d[2]

    u=err*0.9+4*(err-errold)

    Motor.StartPower ("B", -95-u)

    Motor.StartPower ("C", 95-u)

    errold=err

  EndWhile

  Sensor.SetMode(2,0)

  Sensor.SetMode(3,0)

EndSub



Sub RGB2HSV2

  LCD.Clear()

  RGB2=Sensor.ReadRaw(x, 3)

  max=Math.Max(RGB2[2],Math.Max(RGB2[0],RGB2[1]))

  min=Math.Min(RGB2[2],Math.Min(RGB2[0],RGB2[1]))

  If min=max Then

    H2=0

  ElseIf max=RGB2[0] Then

    If RGB2[1]>=RGB2[2] Then

      H2=60*((RGB2[1]-RGB2[2])/(max-min))

    ElseIf RGB2[2]>RGB2[1] Then

      H2=60*((RGB2[1]-RGB2[2])/(max-min))+360

    EndIf 

  ElseIf max=RGB2[1] Then

    H2=60*((RGB2[2]-RGB2[0])/(max-min))+120

  ElseIf max=RGB2[2] Then

    H2=60*((RGB2[0]-RGB2[1])/(max-min))+240

  EndIf

  If max=0 Then

    S2=0

  Else 

    S2=1-(min/max)

  EndIf

  V2=max

EndSub



Sub Colour2

  RGB2HSV2()

  If H2>320 Or H2<20 Then

    c2=5

  ElseIf H2>=20 and (H2<60 or H2=60) then

    c2=4

  ElseIf H2>60 and (H2<320 or H2=320) then

    c2=3

  EndIf

EndSub



Sub Kodirovka

  Motor.Start("B",-40)

  Motor.Start("C",40)

  Sensor.SetMode(2,4)

  Sensor.SetMode(3,4)

  RGBD=Sensor.ReadRaw(2,3)

  RGB1=Sensor.ReadRaw(3,3)

  While RGBD[1]>30 Or RGB1[1]>50

    RGBD=Sensor.ReadRaw(2,3)

    RGB1=Sensor.ReadRaw(3,3)

  EndWhile

  Motor.MoveSync("BC",-40,40,25,"True")

  x=2

  Colour()

  x=3

  Colour2()

  If (c=3 And c2=3) And (S>0.53 or S2<0.53) and Motor.GetCount("C")>190 Then

    kod=15

    ot=2

  ElseIf (c=3 And c2=3) And (S>0.53 or S2<0.53) and Motor.GetCount("C")>168 Then

    kod=14

    ot=2

  ElseIf (c=3 And c2=3) And (S>0.53 or S2<0.53) Then

    kod=13

    ot=2

  ElseIf (S<0.55 and S2<0.55) And Motor.GetCount("C")>190 And (RGB[0]+RGB[1]+RGB[2]>150 and RGB2[0]+RGB2[1]+RGB2[2]>150) Then

    kod=12

    ot=0

  ElseIf (S<0.55 and S2<0.55) And Motor.GetCount("C")>168 And (RGB[0]+RGB[1]+RGB[2]>150 and RGB2[0]+RGB2[1]+RGB2[2]>150) Then

    kod=11

    ot=0

  ElseIf (S<0.55 and S2<0.55) And (RGB[0]+RGB[1]+RGB[2]>150 and RGB2[0]+RGB2[1]+RGB2[2]>150) Then

    kod=10

    ot=0

  ElseIf (S<0.55 or S2<0.55) And Motor.GetCount("C")>190 And RGB[0]+RGB[1]+RGB[2]<150 Then

    kod=6

    ot=-2

  ElseIf (S<0.55 or S2<0.55) And Motor.GetCount("C")>168 And RGB[0]+RGB[1]+RGB[2]<150 Then

    kod=5

    ot=-2

  ElseIf (S<0.53 or S2<0.53) And RGB[0]+RGB[1]+RGB[2]<150 Then

    kod=4

    ot=-2

  ElseIf (S<0.55 or S2<0.55) And Motor.GetCount("C")>190 And RGB2[0]+RGB2[1]+RGB2[2]<150 Then

    kod=9

    ot=-3

  ElseIf (S<0.53 or S2<0.53) And Motor.GetCount("C")>168 And RGB2[0]+RGB2[1]+RGB2[2]<150 Then

    kod=8

    ot=-3

  ElseIf (S<0.53 or S2<0.53) And RGB2[0]+RGB2[1]+RGB2[2]<150 Then

    kod=7

    ot=-3

  ElseIf Motor.GetCount("C")>190 Then

    kod=3

    ot=5

  ElseIf Motor.GetCount("C")>168 Then

    kod=2

    ot=5

  Else

    kod=1  

    ot=5

  EndIf

  LCD.Clear()

  LCD.Write(0,0,kod)

  If ot=2 Then

    Motor.Start("B",40)

    Motor.Start("C",-40)

    Program.Delay(600)

    Motor.Stop("C","True")

    Motor.Move("B",-40,225,"True")

    Motor.Start("C",-40)

    Program.Delay(500)

  ElseIf ot=0 then

    Motor.Move("B",40,285,"True")

    Motor.Start("C",-40)

    Program.Delay(500)

  ElseIf ot=-3 then

    Motor.Move("B",40,240,"True")

    Motor.Start("C",-40)

    Program.Delay(500)

  ElseIf ot=-2 then

    Motor.Move("B",40,190,"True")

    Motor.Start("C",-40)

    Program.Delay(500)

  ElseIf ot=5 then

    Motor.MoveSync("BC",40,-40,60,"False")

  EndIf

  Motor.Stop("BC","True")

EndSub



Sub Puzir '?ë–µ–? ?Å–æ—??Ç–∏—?–æ–≤–∫–∏ –±–µ–ª?ã—? –ø?É–∑—ã—??? –µ?Å—Ç—? –≤ –æ?Ç–¥–µ–ª—å–Ω–æ–? –ø?–æ–≥?–∞–º–º–µ!

  for i=1 to 5

    for j=0 to 5-i

      If m[j]>m[j+1] then

        k=m[j]

        m[j]=m[j+1]

        m[j+1]=k

      EndIf

    EndFor

  EndFor

EndSub



Sub PovorotDerevya

  errold=0 '?û–±–Ω—É–ª–µ–Ω–∏–? errold

  Motor.ResetCount ("BC") '?û–±–Ω—É–ª–µ–Ω–∏–? ?ç–Ω–∫–æ–¥–µ—?–æ–≤ –Ω–∞ –º–æ?Ç–æ—?–∞?? "BC"

  While Motor.GetCount("B")<280 '?û—Å–Ω–æ–≤–Ω–æ–? ?Ü–∏–∫–? –≤ ?ç—Ç–æ–? –ø?–æ–≥?–∞–º–º–µ

    err=Motor.GetCount("B")-Motor.GetCount("C") '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? –æ?à–∏–±–∫–?

    u=err*1.5+2.3*(err-errold) '?í—ã—Å—á–∏—Ç—ã–≤–∞–Ω–∏–? ?É–ø—?–∞–≤–ª?è—â–µ–? –≤–æ–∑–¥–µ–π?Å—Ç–≤–∏–µ–?

    Motor.StartPower("B", 80-u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "B"

    Motor.StartPower("C", 80+u) '?ü–æ–¥–∞—á–? ?Å–∫–æ—?–æ?Å—Ç–? –Ω–∞ –º–æ?Ç–æ—? "C"

    errold=err '?ó–∞–ø–∏—Å—? err –≤ errold

    Program.Delay(10) '?ù–µ–±–æ–ª—å—à–æ–? –æ–∂–∏–¥–∞–Ω–∏–µ –≤ ?Ü–∏–∫–ª–?

  EndWhile

EndSub



Sub MeritDerevya

  nt=0

  x=4

  encodb=75

  EncBlue()

  Motor.Stop("B","True") 

  Motor.Move("C",65,60,"False") '?ü–æ–≤–æ—?–æ?? –∫ 1 –¥–µ?–µ–≤??

  Motor.MoveSync("BC",-65,65,180,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 1 –¥–µ?–µ–≤–∞  

  Motor.Stop("BC","True")

  Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 1 –¥–µ?–µ–≤–∞

  Motor.Move("D",-15,40,"True")

  Program.Delay(800)

  Motor.Start("D",-15)

  Program.Delay(600)

  ColourT()

  nt=1

  Motor.Move("C",65,100,"True")

  Program.Delay(300)

  Motor.Start("D",10)

  Program.Delay(800)

  Motor.MoveSync("BC",65,-65,90,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 1 –¥–µ?–µ–≤–∞

  Motor.Stop("B","True")

  Sensor.SetMode(3,4)

  B=Sensor.ReadRaw(3,3)

  Motor.Start("C",-65)

  While B[2]>34.5

    B=Sensor.ReadRaw(3,3)

  EndWhile

  Motor.Move("C",-65,45,"True")

  Program.Delay(200)

  Sensor.SetMode(3,0)

  Speaker.Tone(100,500,100)

  Yesda2()

  V1=65

  V2=65

  EncBlue()

  Motor.Stop("C","True")

  Motor.Move("B",-65,85,"False") '?ü–æ–≤–æ—?–æ?? –∫–æ 2 –¥–µ?–µ–≤??

  Motor.MoveSync("BC",-65,65,255,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 2 –¥–µ?–µ–≤–∞

  Motor.Stop("BC","True")

  Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 2 –¥–µ?–µ–≤–∞

  Motor.Move("D",-15,40,"True")

  Program.Delay(500)

  Motor.Start("D",-15)

  Program.Delay(600)

  ColourT()

  nt=2

  Motor.Move("B",-65,100,"True")

  Program.Delay(300)

  Motor.Start("D",10)

  Program.Delay(800)

  Motor.MoveSync("BC",65,-65,105,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 2 –¥–µ?–µ–≤–∞

  Motor.Stop("C","True")

  Motor.Start("B",65) '?î–æ–≤–æ—?–æ?? –¥–æ –ª–∏–Ω–∏–∏

  Sensor.SetMode(2,4)

  B=Sensor.ReadRaw(2,3)

  While B[2]>34.5

    B=Sensor.ReadRaw(2,3)

  EndWhile

  Motor.Move("B",65,75,"True")

  Program.Delay(200)

  Sensor.SetMode(2,0)

  Yesda2()

  V1=95

  V2=95

  encodb=322

  EncBlue()

  Motor.Stop("B","True") 

  Motor.Move("C",65,75,"False") '?ü–æ–≤–æ—?–æ?? –∫ 1 –¥–µ?–µ–≤??

  Motor.MoveSync("BC",-65,65,210,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 1 –¥–µ?–µ–≤–∞  

  Motor.Stop("BC","True")

  Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 1 –¥–µ?–µ–≤–∞

  Motor.Move("D",-15,40,"True")

  Program.Delay(500)

  Motor.Start("D",-15)

  Program.Delay(600)

  ColourT()

  nt=3

  Motor.Start("D",10)

  Program.Delay(800)

  Motor.MoveSync("BC",65,-65,145,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 1 –¥–µ?–µ–≤–∞

  Motor.Stop("B","True")

  Sensor.SetMode(3,4)

  B=Sensor.ReadRaw(3,3)

  Motor.Start("C",-65)

  While B[2]>34.5

    B=Sensor.ReadRaw(3,3)

  EndWhile

  Speaker.Tone(100,500,100)

  Motor.Move("C",-65,15,"True")

  Program.Delay(200)

  Sensor.SetMode(3,0)

  Speaker.Tone(100,500,100)

  Yesda2()

  V1=95

  V2=95

  EncBlue()

  Motor.Stop("C","True")

  Motor.Move("B",-65,55,"False") '?ü–æ–≤–æ—?–æ?? –∫–æ 2 –¥–µ?–µ–≤??

  Motor.MoveSync("BC",-65,65,265,"False") '?ü—?–æ–µ–∑–¥ –¥–æ 2 –¥–µ?–µ–≤–∞

  Motor.Stop("BC","True")

  Motor.Move("D",-10,55,"True") '?í–∑—è—Ç–∏–? 2 –¥–µ?–µ–≤–∞

  Motor.Move("D",-15,40,"True")

  Program.Delay(500)

  Motor.Start("D",-15)

  Program.Delay(600)

  ColourT()

  Motor.Start("D",10)

  Program.Delay(800)

  Motor.MoveSync("BC",65,-65,145,"False") '?ü—?–æ–µ–∑–¥ –Ω–∞–∑–∞–¥ –æ?? 2 –¥–µ?–µ–≤–∞

  Motor.Stop("C","True")

  Motor.Start("B",65) '?î–æ–≤–æ—?–æ?? –¥–æ –ª–∏–Ω–∏–∏

  Sensor.SetMode(2,4)

  B=Sensor.ReadRaw(2,3)

  While B[2]>34.5

    B=Sensor.ReadRaw(2,3)

  EndWhile

  Motor.Move("B",65,15,"True")

  Program.Delay(200)

  Sensor.SetMode(2,0)

  Yesda2()

EndSub



Sub Yesda2

  errold=0

  Motor.ResetCount ("BC")

  While Sensor.ReadPercent(2)<grey and Sensor.ReadPercent(3)<grey

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 55-u)

   Motor.StartPower ("C", -55-u)

   errold=err

   Program.Delay(10)

  EndWhile

 Motor.ResetCount("BC")

  While Motor.GetCount("B")<50

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 55-u)

   Motor.StartPower ("C", -55-u)

   errold=err

   Program.Delay(10)

  EndWhile

  While Sensor.ReadPercent(2)>grey Or Sensor.ReadPercent(3)>grey

   err=Motor.GetCount("B")-Motor.GetCount("C")*(-1)

   u=err*0.4+0.5*(err-errold)

   Motor.StartPower ("B", 55-u)

   Motor.StartPower ("C", -55-u)

   errold=err

   Program.Delay(10)

  EndWhile

EndSub


