' Igo094.smallbasic - ?›²ç¢? Igo v0.94 - Copyright (c) 2010 NonkiTakahashi

'

' å±¥æ?´ï¼š

' v0.1 2010/07/21 ?ˆ?‰ˆï¼šç¢?›¤?®è¡¨ç¤º (243è¡? NBK992)

' v0.2 2010/07/23 ?‰‹?•°?®è¡¨ç¤º (265è¡? JVR185)

' v0.3 2010/07/24 äººã«?‚ˆ?‚‹æ¬¡ã®?‰‹?®?‡¦?† (378è¡? HHF931)

' v0.4 2010/07/31 æ£‹è­œ?®?†?”Ÿ (706è¡? HHF931-0)

' v0.5 2010/08/03 æ£‹è­œ?ƒ•?‚¡?‚¤?ƒ«?®?…¥?‡º?Š› (1088è¡? HHF931-1)

' v0.6 2010/08/08 ?‹?•—?®è¡¨ç¤º ?è‡ª?‹•?š„?«?Ÿ³?‚’?–?‚‹ (1312è¡? HHF931-2)

' v0.7 2010/08/19 ?œ°?®èªè­˜?ç??‰‹ç¦æ?¢ã®?ˆ¤å®šã?Territory (1801è¡? HHF931-3)

' v0.8 2010/09/05 bEyes?ãƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­æ³? (1945è¡? TLW572)

' v0.94 2010/10/08 æ£‹è­œ???å­—å¥è§£æè¦‹ç›´?—?è‡ª?‹•?‹è»? ?é«˜?ŸåŒ– (1600è¡?)

'

' ?‚?ƒæ–‡?Œ®ï¼?

' [1]æ¸…æ„¼ä¸?, å±±ä¸‹å®?, ä½ã?…æœ¨å®£ä»‹: ?ã‚³?ƒ³?ƒ”?ƒ¥?ƒ¼?‚¿?›²ç¢ã®?…¥????, ?…±ç«‹å‡º?‰ˆ, 2005.

' [2]?Ÿ³?‰æ˜‡, æ¢…æ²¢?”±é¦™é‡Œ, é»’ç?§æ?£æ†², ?…µ? ­ä¿Šå¤«: ?æ±å¤§æ•™é¤Šå›²ç¢è¬›åº§ã??, ?…‰?–‡ç¤¾æ–°?›¸, 2007.

' [3]Anders Kierulf: File Format FF[1], http://www.red-bean.com/sgf/, 1990.

' [4]Arno Hollosi: SGF File Format FF[4], http://www.red-bean.com/sgf/, 2006.

' [5]Karl Baker: The Way to Go, American Go Association, 1986.

' [6]ç¾æ·»ä¸?æ¨?: ?ƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­?œ¨æ¤œç´¢, ?ƒ…? ±?‡¦?†, Vol.49 No.6, pp.686-693 (2008).

' [7]å±±ä¸‹å®?:?å¼·è±ªå›²ç¢ã‚½?ƒ•?ƒˆ?Œå½©?ã«?¤?„?¦??,http://www32.ocn.ne.jp/~yss/index_j.html, 2009. 

' 

' ?ƒ¡?‚¤?ƒ³?ƒ—?ƒ­?‚°?ƒ©?ƒ ï¼?

sVersion = "v0.94"  ' ?ƒ—?ƒ­?‚°?ƒ©?ƒ ?ƒ?ƒ¼?‚¸?ƒ§?ƒ³

bDebug = "False"    ' ?ƒ‡?ƒ?ƒƒ?‚°ä¸?

bSound = "False"    ' ?Ÿ³?‚’ç½??„?Ÿ?¨??®?Ÿ³?‚’?‡º?™

bNewRo = "False"    ' è·??•°?Œå¤‰æ›´?«?ª?£?Ÿ

bTime = "True"      ' ?™‚?–“è¡¨ç¤º

bAuto = "False"     ' ?‡ª?‹•?‹è»?

bDumpWL = "True"    ' ?‹?•—?®???ƒ³?ƒ—

InitProgram()   ' ?ƒ—?ƒ­?‚°?ƒ©?ƒ ?®?ˆ?œŸ?Œ–

InitRoDepend()  ' è·??•°?«ä¾å­˜?™?‚‹å¤‰æ•°?®?ˆ?œŸ?Œ–

InitControls()  ' ?‚³?ƒ³?ƒˆ?ƒ­?ƒ¼?ƒ«?ƒ¨?®?ˆ?œŸ?Œ–

' ?ƒ—?ƒ­?‚°?ƒ©?ƒ çµ‚äº†?Œ?Œ‡å®šã•?‚Œ?‚‹?¾?§ï½›ï½?†…ç¹°ã‚Šè¿”ã—

While bInProgram

'ï½?

  ' ?–°è¦ãƒ¢?ƒ¼?ƒ‰

  InitBoard()     ' ?›¤?®?ˆ?œŸ?Œ–

  ResetControls() ' ?‚³?ƒ³?ƒˆ?ƒ­?ƒ¼?ƒ«?ƒ¨?®?ˆ?œŸ?Œ–

  ClearBoard()    ' ?›¤?¢?®?‚¯?ƒª?‚¢

  ShowBoard()     ' ?›¤?®è¡¨ç¤º

lRetry:

  InputGameInfo() ' å¯¾æˆ¦?…åï¼ˆã¾?Ÿ?¯æ£‹è­œ?ï¼‰ã®?…¥?Š›

  If bTime Then

    StartClock()

  EndIf

  If bOpen Then   ' å¯¾å??ƒ¢?ƒ¼?ƒ‰ï¼ˆã¾?Ÿ?¯æ£‹è­œ?…¥?Š›ï¼?

    ReadRecord()  ' æ£‹è­œ?®èª??¿è¾¼ã¿

    If bError Then

      Goto lRetry

    EndIf

    If bNewRo Then

      Shapes.HideShape(oPrisoner[BLACK])

      Shapes.HideShape(oPrisoner[WHITE])

      GraphicsWindow.BrushColor = "Silver"

      GraphicsWindow.FillRectangle(0, 0, GraphicsWindow.Width, GraphicsWindow.Height)

      InitRoDepend()  ' è·??•°?«ä¾å­˜?™?‚‹å¤‰æ•°?®?ˆ?œŸ?Œ–

      InitBoard()     ' ?›¤?®?ˆ?œŸ?Œ–

      ResetControls() ' ?‚³?ƒ³?ƒˆ?ƒ­?ƒ¼?ƒ«?ƒ¨?®?ƒª?‚»?ƒƒ?ƒˆ

      ClearBoard()    ' ?›¤?¢?®?‚¯?ƒª?‚¢

      ShowBoard()     ' ?›¤?®è¡¨ç¤º

      bNewRo = "False"

    EndIf

    ReplayGame()  ' æ£‹è­œ?®?†?”Ÿ

  Else  ' å¯¾å??ƒ¢?ƒ¼?ƒ‰

    Shapes.SetText(oPrisoner[BLACK], 0) ' ?‚¢?‚²?ƒ?ƒ?®?‚¯?ƒª?‚¢

    Shapes.SetText(oPrisoner[WHITE], 0) ' ?‚¢?‚²?ƒ?ƒ?®?‚¯?ƒª?‚¢

    InitRecord()    ' æ£‹è­œ?®?ˆ?œŸ?Œ–

    CreateRdmArray()  ' ä¹±ç©º?‚¹?ˆ—?®?ˆ?œŸ?Œ–

    SaveGameDate()  ' å¯¾å??—¥?®ä¿å­˜

    iMove = 0       ' ?‰‹?•°?®?‚¯?ƒª?‚¢

    ' å¯¾å? - çµ‚å??«?ª?‚‹?¾?§ï½›ï½?†…ç¹°ã‚Šè¿”ã—

    While bInGame 

    'ï½?

      EachTurn()    ' é»’ç•ª

      If bInGame Then

        EachTurn()  ' ?™½?•ª

      EndIf    

    ' ï½?

    EndWhile

  EndIf

  If bTime Then

    TextWindow.Write("iMove=" + iMove + " " + sScore + " ")

    StopClock()

    PrintTime()

  EndIf

  bInGame = "True"      ' çµ‚äº†?ƒ¢?ƒ¼?ƒ‰ï¼ˆå†?”Ÿ?¾?Ÿ?¯æ£‹è­œ?‡º?Š›ï¼?

  While bInGame

    InputGameEndInfo()  ' å¯¾æˆ¦?…åï¼ˆã¾?Ÿ?¯æ£‹è­œ?ï¼‰ã®?…¥?Š›

    If bReplay Then

      ReplayGame()  ' æ£‹è­œ?®?†?”Ÿ

    ElseIf bSave Then

      WriteRecord() ' æ£‹è­œ?®ä¿å­˜

    EndIf

  EndWhile

' ï½?

EndWhile

'

Sub EachTurn  ' ??‚Œ??‚Œ?®?‰‹?•ª

  iMove = iMove + 1

  iColor = Math.Remainder((iMove - 1), 2) + 1

  iX = iBLX   ' é»’ç•ª?ƒ©?ƒ³?ƒ—è¡¨ç¤º

  iY = iBLY

  If iColor = BLACK Then 

    bOn = "True"

  Else  

    bOn = "False"

  EndIf  

  DrawLamp()

  iX = iWLX   ' ?™½?•ª?ƒ©?ƒ³?ƒ—è¡¨ç¤º

  iY = iWLY

  If iColor = WHITE Then 

    bOn = "True"

  Else  

    bOn = "False"

  EndIf  

  DrawLamp()

  If bReplay Then   ' æ¬¡ã®?‰‹?‚’?‰“?¤

    Replay()    

  Else

    If sPlayer[iColor] = "Random" Or sPlayer[iColor] = "CPU" Or sPlayer[iColor] = "Easy" Then

      bEyes = "True"

    Else

      bEyes = "False"

    EndIf

    If sPlayer[iColor] = "Random" Then

      bEasy = "False"

      Random()

    ElseIf sPlayer[iColor] = "Easy" Then

      bEasy = "True"

      Random()

    ElseIf sPlayer[iColor] = "CPU" Then

      Montecarlo() ' ?ƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­æ³•ã§æ¬¡ã®?‰‹?‚’æ±ºã‚?‚‹

    Else

      Human()

    EndIf

  EndIf    

  If bResign Then   ' ?Š•äº†ãª?‚‰çµ‚å?

    bInGame = "False"

    If (Math.Remainder(iMove, 2) = 1) Then

      sScore = "W+R"  ' é»’ã®?Š•?º†

      GraphicsWindow.Title = "Igo " + sVersion + " - ?™½?®ä¸??Š¼?—?‹?¡"

    Else 

      sScore = "B+R"  ' ?™½?®?Š•äº?

      GraphicsWindow.Title = "Igo " + sVersion + " - é»’ã®ä¸??Š¼?—?‹?¡"

    EndIf

  Else

    If bPass Then     ' ?ƒ‘?‚¹?ª?‚‰?ƒ‘?‚¹?›?•°?‚’?‚«?‚¦?ƒ³?ƒˆ?‚¢?ƒƒ?ƒ—

      iPass = iPass + 1

    Else

      iPass = 0

    EndIf

    If bReplay = "False" Then     ' æ£‹è­œ?®è¨˜éŒ²

      Record()

    EndIf

    ' ?Ÿ³?®è¡¨ç¤º?¨?–?‚Š?®?‡¦?†

    bShow = "True" ' çµæœ?‚’è¡¨ç¤º?™?‚‹

    If bPass = "False" Then

      DrawStone()

      If bSound Then

        Sound.PlayClickAndWait()

      EndIf

      RemoveCapturedStones()  ' ?››?–¹?®?Ÿ³?Œ?›²?¾?‚Œ?Ÿ?‚‰?–?‚Š?™¤?

      If iRemoved > 0 Then  

        Shapes.SetText(oPrisoner[iColor], iPrisoner[iColor])

      EndIf

    EndIf

    Judge()     ' çµ‚å??®?ˆ¤å®?

  EndIf

EndSub    

'

Sub RemoveCapturedStones  ' ?››?–¹?®?Ÿ³?Œ?›²?¾?‚Œ?Ÿ?‚‰?–?‚Š?™¤?

  iRemoved = 0

  bEnclosed = "True"  ' ?››?–¹?‚’?›²?‚?‚Œ?¦?„?‚‹

  iCTurn = iColor

  If iColor = BLACK Then

    iColor = WHITE

  ElseIf iColor = WHITE Then

    iColor = BLACK

  ElseIf iColor = SPACE Then

    Goto lSkipRemove

  EndIf

  iXTurn = iX

  iYTurn = iY

  For iET = 1 To 4

    iX = iXTurn + idX4[iET]

    iY = iYTurn + idY4[iET]

    If iBoard[iX][iY] = iCTurn Or iBoard[iX][iY] = SPACE Then

      bEnclosed = "False"

    EndIf

    If iX >= 1 And iX <= iRo And iY >= 1 And iY <= iRo Then

      InitLiberty()

      CountLiberty()

      If iLiberty = 0 Then

        RemoveUnit()

        iRemoved = iRemoved + iUnit

        iRX = iX

        iRY = iY

        iPrisoner[iCTurn] = iPrisoner[iCTurn] + iUnit

      EndIf

    EndIf

  EndFor  

  iColor = iCTurn

  iX = iXTurn

  iY = iYTurn

  If bEnclosed And iRemoved = 1 Then

    iKo = iMove

    iKX = iRX

    iKY = iRY

  EndIf

lSkipRemove:

EndSub

'

' ?ƒ—?ƒ­?‚°?ƒ©?ƒ ?–¢?£ï¼š

Sub InitProgram ' ?ƒ—?ƒ­?‚°?ƒ©?ƒ ?®?ˆ?œŸ?Œ–

  SPACE = 0 ' ç©ºç‚¹

  BLACK = 1 ' é»?

  WHITE = 2 ' ?™½

  OB = 3    ' ?›¤å¤?

  BANDW = 4 ' é»’ã¨?™½ï¼ˆCheckSpaceUnit()ç­‰ã§ä½¿ç”¨ï¼?

  UPPERA = Text.GetCharacterCode("A")   ' A?®?–‡å­—ã‚³?ƒ¼?ƒ‰

  UPPERZ = Text.GetCharacterCode("Z")   ' Z?®?–‡å­—ã‚³?ƒ¼?ƒ‰

  LOWERA = Text.GetCharacterCode("a")   ' a?®?–‡å­—ã‚³?ƒ¼?ƒ‰

  LOWERZ = Text.GetCharacterCode("z")   ' z?®?–‡å­—ã‚³?ƒ¼?ƒ‰

  CR = 13 ' ?‚­?ƒ£?ƒª?ƒƒ?‚¸?ƒª?‚¿?ƒ¼?ƒ³ï¼ˆå¾©?”¹ï¼‰ã®?–‡å­—ã‚³?ƒ¼?ƒ‰

  LF = 10 ' ?ƒ©?‚¤?ƒ³?ƒ•?‚£?ƒ¼?ƒ‰ï¼ˆè¡Œ?ã‚Šï¼‰ã®?–‡å­—ã‚³?ƒ¼?ƒ‰

  TAB = 9 ' ?‚¿?ƒ–?®?–‡å­—ã‚³?ƒ¼?ƒ‰

  cCR = Text.GetCharacter(CR)

  cLF = Text.GetCharacter(LF)

  cTab = Text.GetCharacter(TAB)

  sNL = cCR + cLF

  iRo = 5

  sPlayer[BLACK] = "Random" ' é»’ãƒ—?ƒ¬?‚¤?ƒ¤?ƒ¼?ˆ?œŸ??

  sPlayer[WHITE] = "CPU"    ' ?™½?ƒ—?ƒ¬?‚¤?ƒ¤?ƒ¼?ˆ?œŸ??

  sSGF = "temp.sgf"         ' SGF?ƒ•?‚¡?‚¤?ƒ«??ˆ?œŸ??

  rCX = 14

  rCY = 22

  rKomi = 0.0

  GraphicsWindow.FontSize = rCY

  sBoardColor = "Wheat"

  iPass = 0

  sStone[SPACE] = "SPACE"

  sStone[BLACK] = "BLACK"

  sStone[WHITE] = "WHITE"

  sStone[OB] = "OB"

  sGame = "å¯¾å?"

  sOpen = "?–‹?"

  sIsNotExist = "?¯å­˜åœ¨?—?¾?›?‚“??"

  sIsNotGoFormat = "?¯?›²ç¢ã®æ£‹è­œ?§?¯?‚?‚Š?¾?›?‚“??"

  sSave = "="   ' Windings ä¿å­˜?ƒ?ƒ¼?‚¯  

  sSave2 = "ä¿å­˜"

  sAlreadyExists = "?¯?™?§?«å­˜åœ¨?—?¾?™??"

  sNew = "?–°è¦?"

  sReplay = "4" ' Windings ?†?”Ÿ?ƒ?ƒ¼?‚¯

  sPause = ";"  ' Windings ?ƒ?ƒ¼?‚º?ƒ?ƒ¼?‚¯

  sPass = "?ƒ‘?‚¹"

  sResign = "?Š•äº?"

  GraphicsWindow.Title = "Igo " + sVersion

  bInProgram = "True"

  InitEffect()  ' å½±éŸ¿ç¯„å›²åº§æ¨™?®?ˆ?œŸ?Œ–

  Init4()       ' ?››?–¹?®åº§æ¨™?®?ˆ?œŸ?Œ–

  iPlayOut = 1  ' ?ƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­æ³•ã®?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?›?•°

EndSub

'

Sub InitRoDepend  ' è·??•°?«ä¾å­˜?™?‚‹å¤‰æ•°?®?ˆ?œŸ?Œ–

  For i = 0 To iRo

    sAlpha[i] = Text.GetSubText(" abcdefghijklmnopqrs", i + 1, 1)

  EndFor

  sAlpha[iRo + 1] = "t" ' ?ƒ‘?‚¹  

EndSub

'

Sub InitControls  ' ?‚³?ƒ³?ƒˆ?ƒ­?ƒ¼?ƒ«?ƒ¨?®?ˆ?œŸ?Œ–

  GraphicsWindow.BackgroundColor = "Silver"

  GraphicsWindow.BrushColor = "Black"

  GraphicsWindow.FillEllipse(iBX1 + rCX, iBY0 + idLY, iSR * 2, iSR * 2)

  iBHX = iBX1 + rCX + iSR * 2.5

  iBHY = iBY0 + rCY * 2.5

  oPrisoner[BLACK] = Shapes.AddText(0)

  Shapes.Move(oPrisoner[BLACK], iBHX, iBHY)

  iBLX = iBHX + rCX * 5

  iBLY = iBHY

  bOn = "True"

  iX = iBLX

  iY = iBLY

  DrawLamp()

  oBlack = Controls.AddTextBox(iBX1 + rCX, iBY0)

  Controls.SetTextBoxText(oBlack, sPlayer[BLACK])

  oWhite = Controls.AddTextBox(iBX1 + rCX, iBY0 + idLY * iRo / 2)

  Controls.SetTextBoxText(oWhite, sPlayer[WHITE])

  oPass = Controls.AddButton(sPass, iBX1 + rCX, iBY0 + idLY * iRo)

  oResign = Controls.AddButton(sResign, iBX1 + rCX * 6, iBY0 + idLY * iRo)

  Controls.HideControl(oPass)

  Controls.HideControl(oResign)

  oSGF = Controls.AddTextBox(iBX1 + rCX, iBY0 + idLY * iRo)

  Controls.SetTextBoxText(oSGF, sSGF)

  oGame = Controls.AddButton(sGame, iBX1 + rCX, iBY0 + idLY * iRo + rCY * 2)

  oOpen = Controls.AddButton(sOpen, iBX1 + rCX * 6, iBY0 + idLY * iRo + rCY * 2)

  oNew = Controls.AddButton(sNew, iBX1 + rCX, iBY0 + idLY * iRo + rCY * 2)

  Controls.HideControl(oNew)

  GraphicsWindow.FontName = "Webdings"

  oReplay = Controls.AddButton(sReplay, iBX1 + rCX * 6, iBY0 + idLY * iRo + rCY * 2)

  GraphicsWindow.BrushColor = "Red"

  oSave = Controls.AddButton(sSave, iBX1 + rCX * 9, iBY0 + idLY * iRo + rCY * 2)

  GraphicsWindow.BrushColor = "Black"

  GraphicsWindow.FontName = "Tahoma"

  Controls.HideControl(oReplay)

  Controls.HideControl(oSave)

  iWHX = iBX1 + rCX + iSR * 2.5

  iWHY = iBY0 + idLY * (iRo / 2) + rCY * 2.5

  oPrisoner[WHITE] = Shapes.AddText(0)

  Shapes.Move(oPrisoner[WHITE], iWHX, iWHY)

  iWLX = iWHX + rCX * 5

  iWLY = iWHY

  bOn = "False"

  iX = iWLX

  iY = iWLY

  DrawLamp()

  GraphicsWindow.BrushColor = "White"

  GraphicsWindow.FillEllipse(iBX1 + rCX, iBY0 + idLY * (iRo / 2 + 1), iSR * 2, iSR * 2)

  Controls.TextTyped = OnTextTyped

EndSub

'

Sub ResetControls ' ?‚³?ƒ³?ƒˆ?ƒ­?ƒ¼?ƒ«?ƒ¨?®?ƒª?‚»?ƒƒ?ƒˆ

  GraphicsWindow.BackgroundColor = "Silver"

  GraphicsWindow.BrushColor = "Black"

  GraphicsWindow.FillEllipse(iBX1 + rCX, iBY0 + idLY, iSR * 2, iSR * 2)

  iBHX = iBX1 + rCX + iSR * 2.5

  iBHY = iBY0 + rCY * 2.5

  Shapes.Move(oPrisoner[BLACK], iBHX, iBHY)

  Shapes.ShowShape(oPrisoner[BLACK])

  iBLX = iBHX + rCX * 5

  iBLY = iBHY

  bOn = "True"

  iX = iBLX

  iY = iBLY

  DrawLamp()

  Controls.Move(oBlack, iBX1 + rCX, iBY0)

  Controls.Move(oWhite, iBX1 + rCX, iBY0 + idLY * iRo / 2)

  Controls.ShowControl(oBlack)

  Controls.ShowControl(oWhite)

  Controls.Move(oPass, iBX1 + rCX, iBY0 + idLY * iRo)

  Controls.Move(oResign, iBX1 + rCX * 6, iBY0 + idLY * iRo)

  Controls.HideControl(oPass)

  Controls.HideControl(oResign)

  Controls.Move(oSGF, iBX1 + rCX, iBY0 + idLY * iRo)

  Controls.ShowControl(oSGF)

  Controls.Move(oGame, iBX1 + rCX, iBY0 + idLY * iRo + rCY * 2)

  Controls.Move(oOpen, iBX1 + rCX * 6, iBY0 + idLY * iRo + rCY * 2)

  Controls.Move(oNew, iBX1 + rCX, iBY0 + idLY * iRo + rCY * 2)

  Controls.ShowControl(oGame)

  Controls.ShowControl(oOpen)

  Controls.HideControl(oNew)

  Controls.Move(oReplay, iBX1 + rCX * 6, iBY0 + idLY * iRo + rCY * 2)

  Controls.Move(oSave, iBX1 + rCX * 9, iBY0 + idLY * iRo + rCY * 2)

  Controls.HideControl(oReplay)

  Controls.HideControl(oSave)

  iWHX = iBX1 + rCX + iSR * 2.5

  iWHY = iBY0 + idLY * (iRo / 2) + rCY * 2.5

  Shapes.Move(oPrisoner[WHITE], iWHX, iWHY)

  Shapes.ShowShape(oPrisoner[WHITE])

  iWLX = iWHX + rCX * 5

  iWLY = iWHY

  bOn = "False"

  iX = iWLX

  iY = iWLY

  DrawLamp()

  GraphicsWindow.BrushColor = "White"

  GraphicsWindow.FillEllipse(iBX1 + rCX, iBY0 + idLY * (iRo / 2 + 1), iSR * 2, iSR * 2)

  Controls.TextTyped = OnTextTyped

  Controls.HideControl(oSGF)

  Controls.HideControl(oGame)

  Controls.HideControl(oOpen)

  Controls.ShowControl(oPass)

  Controls.ShowControl(oResign)

EndSub

'

Sub DrawLamp  ' ?ƒ©?ƒ³?ƒ—?®è¡¨ç¤º

  sSavedColor = GraphicsWindow.BrushColor

  GraphicsWindow.BrushColor = "White"

  GraphicsWindow.FillRectangle(iX + 1, iY + 1, 21, 7)

  GraphicsWindow.BrushColor = "DimGray"

  GraphicsWindow.FillRectangle(iX - 2, iY - 2, 21, 7)

  If bOn Then

    GraphicsWindow.BrushColor = "Lime"

  Else

    GraphicsWindow.BrushColor = "Black"

  EndIf

  GraphicsWindow.FillRectangle(iX, iY, 20, 6)

  GraphicsWindow.BrushColor = sSavedColor

EndSub

'

' ?è?ƒãƒ«?ƒ¼?ƒ?ƒ³?–¢?£ï¼š

Sub CreateRdmArray  ' ä¹±ç©º?‚¹?ˆ—?®ä½œæˆ

  ClearRdmArray()

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] = SPACE Then

        iRdmSeq = (iY - 1) * iRo + iX

        AddNumToRdmArray()

      EndIf

    EndFor    

  EndFor

EndSub

'

Sub AddNumToRdmArray  ' ä¹±ç©º?‚¹?ˆ—?¸?®ç©ºç‚¹?®è¿½åŠ 

  iRdmNum = Math.GetRandomNumber(iRdmSeq)

  iRdmIdx = 0

  For iCnt = 1 To iRdmNum - 1

    iRdmIdx = iRdm[iRdmIdx]

  EndFor

  iRdm[iRdmSeq] = iRdm[iRdmIdx]

  iRdm[iRdmIdx] = iRdmSeq

EndSub

'

Sub ClearRdmArray ' ä¹±ç©º?‚¹?ˆ—?®?‚¯?ƒª?‚¢

  iRdm[0] = 0

EndSub

'

Sub CheckPossiblePut  ' ???‰‹?¯?ƒ½?‹?©?†?‹?®?ƒ?‚§?ƒƒ?‚¯

  bPossiblePut = "False"

  If iBoard[iX][iY] <> SPACE Then

    Goto lNotPossible ' ?™?§?«?Ÿ³?Œ?‚?‚‹

  EndIf

  If iMove > 1 And iKo = iMove - 1 And iKX = iX And iKY = iY Then

    Goto lNotPossible ' ?‚³?‚¦???ƒ†?Œå¿…è¦

  EndIf

  CheckSuiside()    ' ?‡ªæ®ºæ‰‹?®?ƒ?‚§?ƒƒ?‚¯

  If bSuiside Then

    Goto lNotPossible

  EndIf

  If bEyes Then     ' ?œ¼?‚’å®ˆã‚‹

    CheckMyEye()    ' ?œ¼?‹?©?†?‹èª¿ã¹?‚‹

    If bMyEye Then  ' ?œ¼?ª?‚‰?‰“?Ÿ?ª?„ï¼ˆãŸ? ?—?‚³?‚¦?‚’?Ÿ‹?‚?‚‹?‰‹?‚’?™¤?ï¼?

      If iMove = 1 Or iKo <> iMove - 2 Or iKX <> iX Or iKY <> iY Then

        Goto lNotPossible

      EndIf

    EndIf

  EndIf

  bPossiblePut = "True"

lNotPossible:

EndSub

'

Sub CheckSuiside  ' ?‡ªæ®ºæ‰‹?®?ƒ?‚§?ƒƒ?‚¯

  bSuiside = "False"

  iBoard[iX][iY] = iColor ' ä»??«ç½??

  iXSave = iX

  iYSave = iY

  InitLiberty()

  CountLiberty() ' æ´»è·¯?‚’?•°?ˆ?‚‹

  If iLiberty = 0 Then  ' ?‡ªæ®ºæ‰‹?‹?‚‚?—?‚Œ?ª?„

    iCSave = iColor

    iColor = 3 - iColor ' ?›¸?‰‹?®?Ÿ³

    For i = 1 To 4  ' ?¥?‚¹?®?Ÿ³?Œ?–?‚Œ?‚‹?‹

      iX = iXSave + idX4[i]

      iY = iYSave + idY4[i]

      If iX >= 1 And iX <= iRo And iY >= 1 And iY <= iRo And iBoard[iX][iY] = iColor Then

        InitLiberty()

        CountLiberty()  ' æ´»è·¯?‚’?•°?ˆ?‚‹

        If iLiberty = 0 Then

          Goto lNotSuiside

        EndIf

      EndIf

    EndFor    

    bSuiside = "True"    

lNotSuiside:

    iColor = iCSave

  EndIf 

  iX = iXSave

  iY = iYSave

  iBoard[iX][iY] = SPACE  ' ?…ƒ?«?ˆ»?™

EndSub

'

Sub Random  ' æ¬¡ã®?‰‹?‚’?‰“?¤ - Random (?‚³?ƒ³?ƒ”?ƒ¥?ƒ¼?‚¿?ƒ¼)

  bPass = "False"

  bResign = "False"

  iLast = 0

  If iMove > iRo * iRo * 3 Then

    Goto lPassRandom

  EndIf

  While iRdm[iLast] > 0

    iXY = iRdm[iLast]

    iX = Math.Remainder(iXY - 1, iRo) + 1

    iY = Math.Floor((iXY - 1) / iRo) + 1

    iColor = Math.Remainder((iMove - 1), 2) + 1

    CheckPossiblePut()

    If bPossiblePut Then

      iBoard[iX][iY] = iColor

      iRdm[iLast] = iRdm[iXY] ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰ç©ºç‚¹?‚’?‰Š?™¤

      Goto lExitRandom

    EndIf

    iLast = iXY

  EndWhile    

lPassRandom:

  bPass = "True"    

lExitRandom:

EndSub

'

Sub RemoveRdmEntry  ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰ç©ºç‚¹ iXY ?‚’?‰Š?™¤ï¼ˆå‰?®?‰‹ iLast ?Œä¸æ˜?ª? ´?ˆï¼?

  iCPRRE = 0

  While iRdm[iCPRRE] > 0

    If iRdm[iCPRRE] = iXY Then

      iRdm[iCPRRE] = iRdm[iXY] ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰ç©ºç‚¹?‚’?‰Š?™¤

      Goto lRRE2Exit

    EndIf

    iCPRRE = iRdm[iCPRRE]

  EndWhile  

lRRE2Exit:

EndSub

'

Sub Montecarlo  ' ?ƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­æ³•ã«?‚ˆ?‚Š?‚³?ƒ³?ƒ”?ƒ¥?ƒ¼?‚¿?ƒ¼?Œæ¬¡ã®?‰‹?‚’?‰“?¤

  SaveBoard2()          ' ç¢ç›¤?‚’ä¿å­˜

  rSKomi = rKomi        ' ?‚³?ƒŸ?‚’ä¿å­˜

  iCP = 0

  While iRdm[iCP] > 0

    iXY = iRdm[iCP]

    iX = Math.Remainder(iXY - 1, iRo) + 1

    iY = Math.Floor((iXY - 1) / iRo) + 1

    CheckPossiblePut()  ' iColor ?‚’?‚?…§

    If bPossiblePut Then

      Goto lNextPut

    EndIf

    iCP = iXY

  EndWhile

  bPass = "True"

  Goto lPass

lNextPut:

  SaveRdmArray()    ' ä¹±ç©º?‚¹?ˆ—?‚’ä¿å­˜ï¼ˆiCnt ?† ç©ºç‚¹?®?•°ï¼?

  If iCnt = 0 Then

    bPass = "True"

    Goto lPass

  ElseIf iCnt > 35 Then

    iPlayOut = 6

  ElseIf iCnt > 30 Then

    iPlayOut = 5

  ElseIf iCnt > 20 Then

    iPlayOut = 4

  ElseIf iCnt > 10 Then

    iPlayOut = 3

  ElseIf iCnt > 5 Then

    iPlayOut = 2

  Else

    iPlayOut = 1

  EndIf

  SaveGameProperties()  ' ?‚³?‚¦?ã‚¢?‚²?ƒ?ƒ?ãƒ‘?‚¹?‚’ä¿å­˜

  iSMove = iMove    ' ?‰‹?•°?‚’ä¿å­˜

  DumpMove()

  TextWindow.Write(":")

  iSColor = iColor  ' ?Ÿ³?®?‰²?‚’ä¿å­˜

  If Math.Floor(rKomi) = 0.0 Then

    If iColor = BLACK Then

      rKomi = rKomi - 0.5

    ElseIf iColor = WHITE Then

      rKomi = rKomi + 0.5

    EndIf

  EndIf

  i = 0

  While iSRdm[i] > 0  ' ç©ºç‚¹?«å¯¾ã—

    rWin[i] = 0.0     ' ?‹?¡?•°?‚’?‚¯?ƒª?‚¢

    rLose[i] = 0.0    ' è² ã‘?•°?‚’?‚¯?ƒª?‚¢

    i = iSRdm[i]

  EndWhile

  bEyes = "True"  ' ???‰‹?¯?ƒ½?ª?‰‹?«?‡ª?ˆ†?®?œ¼?‚’?«?‚?ª?„

  bShow = "False" ' çµ‚å??ˆ¤å®šã§çµæœ?‚’è¡¨ç¤º?—?ª?„

  ' ?›¤?¢?®???ƒ³?ƒ—?ƒ?‚¤?ƒ³?ƒˆ - ?ƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­?®?‰‹?‚’æ±ºã‚?‚‹?›´?‰

  ' ?™?¹?¦?®ä¹±ç©º?‚¹?ˆ—?«å¯¾ã—??

  rWMax = 0.0   ' ??å¤§å‹?¡?•°

  While iSRdm[iCP] > 0

    iXY = iSRdm[iCP]

    iSXY = iXY

    iX = Math.Remainder(iXY - 1, iRo) + 1

    iY = Math.Floor((iXY - 1) / iRo) + 1

    CheckPossiblePut()

    If bPossiblePut = "False" Then

      DumpPoint() ' PlayOut ?®1?‰‹?›® (iX, iY) ?‚’è¡¨ç¤º

      TextWindow.Write("X ")

      Goto lNextPoint

    EndIf

    ' ???‰‹?¯?ƒ½?ª?‰‹?«?¤?„?¦??

    If bDumpWL Then

      DumpPoint() ' PlayOut ?®1?‰‹?›® (iX, iY) ?‚’è¡¨ç¤º

    EndIf

    For iG = 1 To iPlayOut

      ' ?Œ‡å®šã•?‚Œ?Ÿ?›?•°?ãƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?‚’è¡Œã†

      iMove = iSMove - 1  ' ?‰‹?•°?‚’1?¤?ˆ»?™

      RestoreBoard2()     ' ç¢ç›¤?‚’?…ƒ?«?ˆ»?™

      CreateRdmArray()    ' ç¢ç›¤?‚’?Ÿº?«ä¹±ç©º?‚¹?ˆ—?‚’ä½œã‚Š?›´?™

      RestoreGameProperties() ' ?‚³?‚¦?ã‚¢?‚²?ƒ?ƒ?ãƒ‘?‚¹?‚’?…ƒ?«?ˆ»?™

      PlayOut() ' çµ‚å??¾?§?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ

      ' ?›¤?¢?®???ƒ³?ƒ—?ƒ?‚¤?ƒ³?ƒˆ - ?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?®çµæœ?‚’è¦‹ãŸ?„?¨?

      If iScore > 0 And iSColor = BLACK Or iScore < 0 And iSColor = WHITE Then

        rWin[iCP] = rWin[iCP] + 1.0

        If bDumpWL Then

          TextWindow.Write("W")

        EndIf

      ElseIf iScore = 0 then

        rWin[iCP] = rWin[iCP] + 0.5

        rLose[iCP] = rLose[iCP] + 0.5

        If bDumpWL Then

          TextWindow.Write("D")

        EndIf

      Else

        rLose[iCP] = rLose[iCP] + 1.0

        If bDumpWL Then

          TextWindow.Write("L")

        EndIf

      EndIf  

      If bDumpWL Then

        TextWindow.Write(" ")

      EndIf

      If rWin[iCP] > rWMax Then

        rWMax = rWin[iCP] ' ??å¤§å‹?¡?•°?®?›´?–°

      EndIf

      ' ?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆå¾Œã?æ®‹?‚Š(iPlayOut - iG)?™?¹?¦?‹?£?¦?‚‚

      ' ??å¤§å‹?¡?•°(rWMax)?‚’è¶…ãˆ?‚‰?‚Œ?ª?„? ´?ˆ?¯??

      ' ?“?®?ˆ?‰‹?«?‚ˆ?‚‹?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?¯ä¸?æ­?

      If rWin[iCP] + iPlayOut - iG < rWMax + 1Then

        Goto lNextPoint

      EndIf

    EndFor

lNextPoint:

    ' ??å¤§å‹?¡?•°?Œ?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?›?•°ï¼ˆå…¨?‹ï¼‰ãª?‚‰??®?‰‹?«?‰“?¤

    If rWin[iCP] = iPlayOut Then

      Goto lThisPoint

    EndIf

    iCP = iSXY

    iColor = iSColor

    iMove = iSMove

    RestoreBoard2()

  EndWhile

lThisPoint:

  If bDumpWL Then

    DumpNewLine()

  EndIf

'

  rMax = 0.0

  i = 0

  While iSRdm[i] > 0

    rAve[i] = rWin[i] / (rWin[i] + rLose[i])

    If rAve[i] > rMax Then

      rMax = rAve[i]

    EndIf

    i = iSRdm[i]  

  EndWhile

  i = 0

  iS = 0

  While iSRdm[iS] > 0

    If rAve[iS] = rMax Then

      iRdm[i] = iSRdm[iS]

      i = iRdm[i]

    EndIf  

    iS = iSRdm[iS]

  EndWhile

  iRdm[i] = 0

  RestoreBoard2()         ' ç¢ç›¤?‚’?…ƒ?«?ˆ»?™

  rKomi = rSKomi          ' ?‚³?ƒŸ?‚’?…ƒ?«?ˆ»?™

  RestoreGameProperties() ' ?‚³?‚¦?ã‚¢?‚²?ƒ?ƒ?ãƒ‘?‚¹?‚’?…ƒ?«?ˆ»?™

  iMove = iSMove          ' ?‰‹?•°?‚’?…ƒ?«?ˆ»?™

  iColor = iSColor        ' ?Ÿ³?®?‰²?‚’?…ƒ?«?ˆ»?™

  Random()  ' ?Œ?˜?‹?‡?®?‰‹?‹?‚‰?ƒ©?ƒ³???ƒ ?«?¸?¶

  RestoreRdmArray()       ' ä¹±ç©º?‚¹?ˆ—?‚’?…ƒ?«?ˆ»?™

  RemoveRdmEntry()        ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰iXY?‚’?‰Š?™¤

lPass:

EndSub

'

Sub PlayOut ' çµ‚å??¾?§?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ

  iColor = BLACK

  If Math.Remainder(iSMove, 2) = 0 Then

    iColor = WHITE

    Goto lNextWhite

  EndIf

lNextBlack:

  ' é»’ç•ª

  iMove = iMove + 1

  iColor = BLACK  ' Random(), RemoveCaputuredStones()?§?‚?…§

  If iMove = iSMove Then

    iXY = iSRdm[iCP]

    iX = Math.Remainder(iXY - 1, iRo) + 1

    iY = Math.Floor((iXY - 1) / iRo) + 1

    iBoard[iX][iY] = iColor

    RemoveRdmEntry()  ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰iXY?‚’?‰Š?™¤

    bPass = "False"

  Else

    Random()

  EndIf

  If bPass Then

    iPass = iPass + 1

  Else

    iPass = 0

    iColor = BLACK

    RemoveCapturedStones() ' ?–?‚‰?‚Œ?Ÿ?Ÿ³?‚’?–?‚Š?™¤?

  EndIf

  ' ?ƒ‡?ƒ?ƒƒ?‚°?ƒ’?ƒ³?ƒˆï¼šã“?“?§?›¤?¢?‚’???ƒ³?ƒ—?™?‚‹?¨?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?‚’è¦³æˆ¦?§??‚‹

  Judge()

  If bInGame <> "True" Then

    Goto lEndGame

  EndIf

lNextWhite:

  ' ?™½?•ª

  iMove = iMove + 1

  iColor = WHITE  ' Random(), RemoveCaputuredStones()?§?‚?…§

  If iMove = iSMove Then

    iXY = iSRdm[iCP]

    iX = Math.Remainder(iXY - 1, iRo) + 1 ' ???ˆ?®?‰‹

    iY = Math.Floor((iXY - 1) / iRo) + 1  ' ???ˆ?®?‰‹

    iBoard[iX][iY] = iColor

    RemoveRdmEntry()  ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰iXY?‚’?‰Š?™¤

    bPass = "False"

  Else

    Random()

  EndIf

  If bPass Then

    iPass = iPass + 1

  Else

    iPass = 0

    RemoveCapturedStones() ' ?–?‚‰?‚Œ?Ÿ?Ÿ³?‚’?–?‚Š?™¤?

  EndIf

  ' ?ƒ‡?ƒ?ƒƒ?‚°?ƒ’?ƒ³?ƒˆï¼šã“?“?§?›¤?¢?‚’???ƒ³?ƒ—?™?‚‹?¨?ƒ—?ƒ¬?‚¤?‚¢?‚¦?ƒˆ?‚’è¦³æˆ¦?§??‚‹

  Judge()

  If bInGame Then

    Goto lNextBlack

  EndIf

'

lEndGame:

EndSub

'

Sub SaveRdmArray  ' ä¹±ç©º?‚¹?ˆ—?®ä¿å­˜

  i = 0

  iCnt = 0

  While iRdm[i] > 0

    iSRdm[i] = iRdm[i]

    i = iRdm[i]

    iCnt = iCnt + 1

  EndWhile

  iSRdm[i] = 0

EndSub

'

Sub RestoreRdmArray ' ä¹±ç©º?‚¹?ˆ—?®å¾©å…ƒ

  i = 0

  While iSRdm[i] > 0

    iRdm[i] = iSRdm[i]

    i = iSRdm[i]

  EndWhile

  iRdm[i] = 0

EndSub

'

Sub Human ' äººãŒæ¬¡ã®?‰‹?‚’?‰“?¤

  bPass = "False"

  bResign = "False"

  GraphicsWindow.MouseDown = OnMouseDown

  Controls.ButtonClicked = OnButtonClicked

  iColor = Math.Remainder((iMove - 1), 2) + 1

  While "True"

    bOutOfBoard = "True"

    While bOutOfBoard

      bNotClicked = "True"  

      While bNotClicked

        Program.Delay(200)

      EndWhile

      If bPass Or bResign Then

        Goto lPossiblePut

      EndIf  

      GetPosition()

    EndWhile

    CheckPossiblePut()

    If bPossiblePut Then

      Goto lPossiblePut

    EndIf

    If bSound Then

      Sound.PlayChimeAndWait()

    EndIf

  EndWhile  

lPossiblePut:

  GraphicsWindow.MouseDown = DoNothing

  Controls.ButtonClicked = DoNothing

  If bPass = "False" And bResign = "False" Then

    iBoard[iX][iY] = iColor

    iXY = (iY - 1) * iRo + iX

    RemoveRdmEntry()  ' ä¹±ç©º?‚¹?ˆ—?‹?‚‰ç©ºç‚¹?‚’?‰Š?™¤

  EndIf    

EndSub

'

Sub OnMouseDown ' ?ƒ?‚¦?‚¹?Œ?Š¼?•?‚Œ?Ÿ?¨??®?‡¦?†

  iMX = GraphicsWindow.MouseX

  iMY = GraphicsWindow.MouseY

  bNotClicked = "False"  

EndSub

'

Sub OnButtonClicked ' ?ƒœ?‚¿?ƒ³?Œ?Š¼?•?‚Œ?Ÿ?¨??®?‡¦?†

  If Controls.LastClickedButton = oResign Then

    bResign = "True"

    bNotClicked = "False"  

  ElseIf Controls.LastClickedButton = oPass Then

    bPass = "True"

    bNotClicked = "False"  

  EndIf  

EndSub

'

Sub GetPosition ' ?ƒ?‚¦?‚¹?‚’?‚¯?ƒª?ƒƒ?‚¯?—?Ÿåº§æ¨™?‹?‚‰ç¢ç›¤?®åº§æ¨™?‚’å¾—ã‚‹

  iX = Math.Floor((iMX - iLX0 + idLX / 2) / idLX) + 1

  iY = Math.Floor((iMY - iLY0 + idLY / 2) / idLY) + 1

  If iX < 1 Or iX > iRo Or iY < 1 Or iY > iRo Then

    bOutOfBoard = "True"

  Else

    bOutOfBoard = "False"

  EndIf

EndSub

'

Sub DoNothing ' ?ª?«?‚‚?—?ª?„ï¼ˆã‚¤?ƒ™?ƒ³?ƒˆ?‡¦?†?”¨ï¼?

EndSub

'

Sub Replay  ' æ¬¡ã®?‰‹?‚’?‰“?¤ - Replay (æ£‹è­œ?®?†?”Ÿ)

  If iMove > iNumRec Then

    bResign = "True"

  Else

    iColor = iRecord[iMove]["turn"]

    iX = iRecord[iMove]["x"]

    iY = iRecord[iMove]["y"]

    If iX = iRo + 1 Then

      bPass = "True"

    Else

      iBoard[iX][iY] = iColor

      bPass = "False"

    EndIf

  EndIf

  Program.Delay(200)

EndSub

'

' ?‚²?ƒ¼?ƒ ?–¢?£ï¼š

Sub InputGameInfo ' ?–°è¦ãƒ¢?ƒ¼?ƒ‰ - å¯¾æˆ¦?…åï¼ˆã¾?Ÿ?¯æ£‹è­œ?ï¼‰ã®?…¥?Š›

  bShowMove = "False"

  bInGame = "True"

  bReplay = "False"

  bResign = "False"

  GraphicsWindow.Title = "Igo " + sVersion

  Controls.ShowControl(oGame)

  Controls.ShowControl(oOpen)

  Controls.ShowControl(oSGF)

  Controls.HideControl(oPass)

  Controls.HideControl(oResign)

  Controls.ButtonClicked = OnButtonClicked1

  bNotClicked = "True"

  If bAuto Then

    bNotClicked = "False" ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

    bOpen = "False"       ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

  EndIf

  While bNotClicked

    Program.Delay(200)

  EndWhile

  Controls.HideControl(oGame)

  Controls.HideControl(oOpen)

  Controls.HideControl(oSGF)

  Controls.ShowControl(oPass)

  Controls.ShowControl(oResign)

EndSub

'

Sub OnTextTyped ' TextBox?‚¤?ƒ™?ƒ³?ƒˆ?‡¦?†

  If Controls.LastTypedTextBox = oBlack Then

    sPlayer[BLACK] = Controls.GetTextBoxText(oBlack)

  ElseIf Controls.LastTypedTextBox = oWhite Then

    sPlayer[WHITE] = Controls.GetTextBoxText(oWhite)

  ElseIf Controls.LastTypedTextBox = oSGF Then

    sSGF = Controls.GetTextBoxText(oSGF)

  EndIf

EndSub

'

Sub OnButtonClicked1  ' ?–°è¦ãƒ¢?ƒ¼?ƒ‰?®?ƒœ?‚¿?ƒ³?‚¤?ƒ™?ƒ³?ƒˆ?‡¦?†

  If Controls.LastClickedButton = oGame Then

    bNotClicked = "False"

    bOpen = "False"

  ElseIf Controls.LastClickedButton = oOpen Then

    bNotClicked = "False"

    bOpen = "True"  

  EndIf

EndSub

'

Sub InputGameEndInfo  ' çµ‚äº†?ƒ¢?ƒ¼?ƒ‰ - ?†?”Ÿ, ä¿å­˜?¾?Ÿ?¯?–°è¦ãƒœ?‚¿?ƒ³?®?…¥?Š›

  bShowMove = "True"

  bInGame = "True"

  bReplay = "False"

  bSave = "False"

  bResign = "False"

  Controls.HideControl(oPass)

  Controls.HideControl(oResign)

  Controls.ShowControl(oNew)

  Controls.ShowControl(oReplay)

  Controls.ShowControl(oSave)

  Controls.ShowControl(oSGF)

  Controls.ButtonClicked = OnButtonClicked2

  bNotClicked = "True"

  If bAuto Then

    bNotClicked = "False" ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

    bOpen = "False"       ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

    bSave = "False"       ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

    bReplay = "False"     ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

    bInGame = "False"     ' ?‡ª?‹•?‹è»¢ã®?Ÿ?‚

  EndIf

  While bNotClicked

    Program.Delay(200)

  EndWhile

  Controls.HideControl(oNew)

  Controls.HideControl(oReplay)

  Controls.HideControl(oSave)

  Controls.HideControl(oSGF)

EndSub

'

Sub OnButtonClicked2  '  çµ‚äº†?ƒ¢?ƒ¼?ƒ‰?®?ƒœ?‚¿?ƒ³?‚¤?ƒ™?ƒ³?ƒˆ?‡¦?†

  If Controls.LastClickedButton = oNew Then

    bNotClicked = "False"

    bSave = "False"

    bReplay = "False"

    bInGame = "False"

  ElseIf Controls.LastClickedButton = oSave Then

    bNotClicked = "False"

    bSave = "True"

    bReplay = "False"

    bInGame = "True"

  ElseIf Controls.LastClickedButton = oReplay Then

    If iNumRec > 0 Then

      bNotClicked = "False"

      bReplay = "True"

      bSave = "False"  

      bInGame = "True"

    Else

      If bSound Then

        Sound.PlayChimeAndWait()

      EndIf

    EndIf

  EndIf

EndSub

'

Sub RemoveUnit  ' ?£ã‚’?–?‚Š?™¤?

  For i = 1 To iUnit

    iX = iUX[i]

    iY = iUY[i]

    iBoard[iX][iY] = SPACE

    iRdmSeq = (iY - 1) * iRo + iX

    AddNumToRdmArray()  ' ä¹±ç©º?‚¹?ˆ—?«?£ã‚’è¿½åŠ ?™?‚‹

    If bShow Then

      EraseStone()

    EndIf

  EndFor

EndSub

'

Sub InitLiberty ' æ´»è·¯?‚’?•°?ˆ?‚‹æº–å‚™

  For iXL = 0 To iRo + 1

    For iYL = 0 To iRo + 1

      bNotChecked[iXL][iYL] = "True"

    EndFor

  EndFor

  iLiberty = 0  

  iUnit = 0

EndSub

'

Sub CountLiberty  ' ?£ã®æ´»è·¯?‚’?•°?ˆ?‚‹

  Stack.PushValue("liberty", iXSave)

  Stack.PushValue("liberty", iYSave)

  Stack.PushValue("liberty", i)

  iXSave = iX

  iYSave = iY

  If bNotChecked[iX][iY] Then

    bNotChecked[iX][iY] = "False"

    If iBoard[iX][iY] = SPACE Then

      iLiberty = iLiberty + 1

    ElseIf iBoard[iX][iY] = iColor Then

      iUnit = iUnit + 1

      iUX[iUnit] = iX

      iUY[iUnit] = iY

      For i = 1 To 4

        iX = iXSave + idX4[i]

        iY = iYSave + idY4[i]

        CountLiberty()

      EndFor

    EndIf

  EndIf

  i = Stack.PopValue("liberty")  

  iYSave = Stack.PopValue("liberty")

  iXSave = Stack.PopValue("liberty")

EndSub

'  

Sub CheckSpaceUnitInTerritory ' ?œ°?®ç©ºç‚¹?®?£ã‚’èª¿ã¹?‚‹

  Stack.PushValue("space", iXSave)

  Stack.PushValue("space", iYSave)

  Stack.PushValue("space", i)

  iXSave = iX

  iYSave = iY

  If bNotChecked[iX][iY] Then

    bNotChecked[iX][iY] = "False"

    If iTerritory[iX][iY] = SPACE Then

      iUnit = iUnit + 1

      iUX[iUnit] = iX

      iUY[iUnit] = iY

      For i = 1 To 4

        iX = iXSave + idX4[i]

        iY = iYSave + idY4[i]

        CheckSpaceUnitInTerritory()

      EndFor

    ElseIf iTerritory[iX][iY] = BLACK Then

      If iColor = SPACE Then

        iColor = BLACK

      ElseIf iColor = WHITE Then

        iColor = BANDW

      EndIf

    ElseIf iTerritory[iX][iY] = WHITE Then

      If iColor = SPACE Then

        iColor = WHITE

      ElseIf iColor = BLACK Then

        iColor = BANDW

      EndIf

    EndIf

  EndIf    

  i = Stack.PopValue("space")

  iYSave = Stack.PopValue("space")

  iXSave = Stack.PopValue("space")

EndSub

'  

Sub CheckSpaceUnit  ' ç©ºç‚¹?®?£ã‚’èª¿ã¹?‚‹

  Stack.PushValue("space", iXSave)

  Stack.PushValue("space", iYSave)

  Stack.PushValue("space", i)

  iXSave = iX

  iYSave = iY

  If bNotChecked[iX][iY] Then

    bNotChecked[iX][iY] = "False"

    If iBoard[iX][iY] = SPACE Then

      iUnit = iUnit + 1

      iUX[iUnit] = iX

      iUY[iUnit] = iY

      For i = 1 To 4

        iX = iXSave + idX4[i]

        iY = iYSave + idY4[i]

        CheckSpaceUnit()

      EndFor

    ElseIf iBoard[iX][iY] = BLACK Then

      If iColor = SPACE Then

        iColor = BLACK

      ElseIf iColor = WHITE Then

        iColor = BANDW

      EndIf

    ElseIf iBoard[iX][iY] = WHITE Then

      If iColor = SPACE Then

        iColor = WHITE

      ElseIf iColor = BLACK Then

        iColor = BANDW

      EndIf

    EndIf

  EndIf    

  i = Stack.PopValue("space")

  iYSave = Stack.PopValue("space")

  iXSave = Stack.PopValue("space")

EndSub

'

Sub CheckMyEye  ' ï¼ˆå˜?‹¬?®ï¼‰çœ¼?‹?©?†?‹èª¿ã¹?‚‹

  bMyEye = "False"

  If iBoard[iX][iY] = SPACE Then

    For i = 1 To 4

      iX1 = iX + idX4[i]

      iY1 = iY + idY4[i]

      iC1 = iBoard[iX1][iY1]

      If iC1 = 3 - iColor Or iC1 = SPACE Then ' ?›¸?‰‹?®?Ÿ³?‹ç©?

        Goto lNotMyEye

      EndIf

    EndFor

  EndIf

  bMyEye = "True"

lNotMyEye:

EndSub

'

Sub CheckEye  ' ï¼ˆå˜?‹¬?®ï¼‰çœ¼?‹?©?†?‹èª¿ã¹?‚‹

  If iBoard[iX][iY] = SPACE Then

    iColor = SPACE

    For i = 1 To 4

      iX1 = iX + idX4[i]

      iY1 = iY + idY4[i]

      iC1 = iBoard[iX1][iY1]

      If iC1 = SPACE Then

        iColor = SPACE

        Goto lCExit

      ElseIf iC1 <> OB Then

        If iColor = 3 - iC1 Then

          iColor = SPACE

          Goto lCExit

        EndIf

        iColor = iC1

      EndIf

    EndFor

  EndIf

lCExit:    

EndSub

'

Sub Judge ' çµ‚å??®?ˆ¤å®?

  bInGame = "True"

  If iPass >= 2 Then

    bInGame = "False"

    CountScore()        ' ?‹?•—?®?ˆ¤å®?

    If bEasy = "False" Then

      AdjustTerritory() ' ?œ°?®èª¿æ•´

    EndIf

    iScore = iScore + rKomi ' ?‚³?ƒŸ?®è¨ˆç®—

    If bShow Then

      DrawTerritory()   ' ?œ°?®??”»

      XDeadStones()     ' æ­»ã«?Ÿ³?«Ã—?‚’ä»˜ã‘?‚‹

      If iScore > 0 Then

        sScore = "B+" + iScore

        GraphicsWindow.Title = "Igo " + sVersion + " - é»’ã®" + iScore + "?›®?‹?¡"

      ElseIf iScore < 0 Then

        sScore = "W+" + (-iScore)

        GraphicsWindow.Title = "Igo " + sVersion + " - ?™½?®" + (-iScore) + "?›®?‹?¡"

      Else  ' iScore = 0

        sScore = "0"

        GraphicsWindow.Title = "Igo " + sVersion + " - å¼•ã?ˆ†?‘ï¼ˆæŒç¢ï¼‰"

      EndIf

    EndIf  

  EndIf

EndSub

'

Sub CountScore  ' ?‹?•—?®?ˆ¤å®?

  EvalBoard()     ' ?œ°?®èªè­˜

  iBlackScore = iBlackScore + iPrisoner[BLACK]  ' ?‚¢?‚²?ƒ?ƒ?‚’?Š ?ˆ?‚‹

  iWhiteScore = iWhiteScore + iPrisoner[WHITE]  ' ?‚¢?‚²?ƒ?ƒ?‚’?Š ?ˆ?‚‹

  iBlackScore = iBlackScore + iDead[WHITE]      ' æ­»ã«?Ÿ³?‚’?Š ?ˆ?‚‹

  iWhiteScore = iWhiteScore + iDead[BLACK]      ' æ­»ã«?Ÿ³?‚’?Š ?ˆ?‚‹

  iScore = iBlackScore - iWhiteScore

EndSub

'

Sub AdjustTerritory ' ?œ°?®èª¿æ•´

  ' ä¸??–¹?®?Ÿ³?«?›²?¾?‚Œ?¦?„?‚‹ç©ºç™½?¯?œ°iTerritory[][]?«?Š ?ˆ?‚‹

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iTerritory[iX][iY] = SPACE Then

        InitLiberty()

        iColor = SPACE

        iXSave = iX

        iYSave = iY

        CheckSpaceUnitInTerritory()

        iX = iXSave

        iY = iYSave

        If iColor = BLACK Then

          For i = 1 To iUnit

            iTerritory[iUX[i]][iUY[i]] = BLACK

          EndFor

          iBlackScore = iBlackScore + iUnit

        ElseIf iColor = WHITE Then

          For i = 1 To iUnit

            iTerritory[iUX[i]][iUY[i]] = WHITE

          EndFor

          iWhiteScore = iWhiteScore + iUnit

        EndIf    

      EndIf    

    EndFor  ' iX

  EndFor  ' iY

  iScore = iBlackScore - iWhiteScore

EndSub

'

Sub EvalBoard ' ?›¤?¢?®è©•ä¾¡

  iCSave = iColor

If bEasy Then

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] = SPACE Then

        ' ?˜?‹¬?®?œ¼?‚’?œ°?¨?—?¦?‚¹?•°?«?Š ?ˆ?‚‹

        CheckEye()

        If iColor = BLACK Then

          iBlackScore = iBlackScore + 1

        ElseIf iColor = WHITE Then

          iWhiteScore = iWhiteScore + 1

        EndIf

      EndIf

    EndFor  ' iX

  EndFor  ' iY

Else

  iDead[BLACK] = 0

  iDead[WHITE] = 0

  iDeadSum = 0

  For iY = 1 To iRo

    For iX = 1 To iRo

      iBlackEffect[iX][iY] = 0

      iWhiteEffect[iX][iY] = 0 

      iTerritory[iX][iY] = SPACE

    EndFor

  EndFor

  SaveBoard()

  ' æ´»è·¯ iLiberty =1 ?®?£ã‚’iBoard[][]?‹?‚‰æ¶ˆã—?æ?»ã«?Ÿ³?¨?—?¦è¨˜æ†¶?™?‚‹

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] <> SPACE Then

        iColor = iBoard[iX][iY]

        iXSave = iX

        iYSave = iY

        InitLiberty()

        CountLiberty()

        If iLiberty = 1 Then

          For i = 1 To iUnit

            iX = iUX[i]

            iY = iUY[i]

            iBoard[iX][iY] = SPACE

            iDeadSum = iDeadSum + 1

            iDX[iDeadSum] = iX

            iDY[iDeadSum] = iY

          EndFor

          iDead[iColor] = iDead[iColor] + iUnit 

        EndIf

        iX = iXSave

        iY = iYSave

      EndIf

    EndFor  ' iX

  EndFor  ' iY

  ' ?Ÿ³?®å½±éŸ¿ç¯„å›²?‚’è¨ˆç®—?™?‚‹

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] = BLACK Then

        SetBlackEffect()

      ElseIf iBoard[iX][iY] = WHITE Then

        SetWhiteEffect()

      EndIf

    EndFor

  EndFor

  iBlackScore = 0 ' é»’ã®?œ°?‚’?•°?ˆ?‚‹

  iWhiteScore = 0 ' ?™½?®?œ°?‚’?•°?ˆ?‚‹

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] = BLACK Then

        iTerritory[iX][iY] = BLACK

      ElseIf iBoard[iX][iY] = WHITE Then

        iTerritory[iX][iY] = WHITE

      Else

        If iBlackEffect[iX][iY] > iWhiteEffect[iX][iY] Then

          iTerritory[iX][iY] = BLACK

          iBlackScore = iBlackScore + 1

        ElseIf iBlackEffect[iX][iY] < iWhiteEffect[iX][iY] Then

          iTerritory[iX][iY] = WHITE

          iWhiteScore = iWhiteScore + 1

        EndIf

      EndIf

    EndFor

  EndFor

  RestoreBoard()

EndIf

  iColor = iCSave

EndSub

'

Sub SaveBoard ' ç¢ç›¤?®ä¿å­˜ï¼ˆç›¤?¢?®è©•ä¾¡?”¨ï¼?

  For iY = 1 To iRo

    For iX = 1 To iRo

      iSaved[iX][iY] = iBoard[iX][iY]

    EndFor

  EndFor

EndSub  

'

Sub RestoreBoard  ' ç¢ç›¤?®å¾©å…ƒï¼ˆç›¤?¢?®è©•ä¾¡?”¨ï¼?

  For iY = 1 To iRo

    For iX = 1 To iRo

      iBoard[iX][iY] = iSaved[iX][iY]

    EndFor

  EndFor

EndSub  

'

Sub SaveBoard2  ' ç¢ç›¤?®ä¿å­˜2ï¼ˆãƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­?”¨ï¼?

  For iY = 1 To iRo

    For iX = 1 To iRo

      iSaved2[iX][iY] = iBoard[iX][iY]

    EndFor

  EndFor

EndSub  

'

Sub RestoreBoard2 ' ç¢ç›¤?®å¾©å…ƒ2ï¼ˆãƒ¢?ƒ³?ƒ†?‚«?ƒ«?ƒ­?”¨ï¼?

  For iY = 1 To iRo

    For iX = 1 To iRo

      iBoard[iX][iY] = iSaved2[iX][iY]

    EndFor

  EndFor

EndSub  

'

Sub SaveGameProperties  ' ?‚²?ƒ¼?ƒ å±æ?§ã®ä¿å­˜

  iSKo = iKo

  iSKX = iKX

  iSKY = iKY

  iSPrisoner[BLACK] = iPrisoner[BLACK]

  iSPrisoner[WHITE] = iPrisoner[WHITE]

  iSPass = iPass

EndSub

'

Sub RestoreGameProperties ' ?‚²?ƒ¼?ƒ å±æ?§ã®å¾©å…ƒ

  iKo = iSKo

  iKX = iSKX

  iKY = iSKY

  iPrisoner[BLACK] = iSPrisoner[BLACK]

  iPrisoner[WHITE] = iSPrisoner[WHITE]

  iPass = iSPass

EndSub

'

Sub Init4 ' ?››?–¹?®åº§æ¨™å·??ˆ†?®?ˆ?œŸ?Œ–

  ' [1]=?³ [2]=ä¸? [3]=å·? [4]=ä¸?     

  idX4 = "1=1;2=0;3=-1;4=0;"

  idY4 = "1=0;2=-1;3=0;4=1;"

EndSub

'

Sub InitEffect  ' å½±éŸ¿ç¯„å›²ï¼ˆè·?›¢2ï¼‰ã®åº§æ¨™å·??ˆ†?®?ˆ?œŸ?Œ–

  ' [1]=ä¸??•ªä¸? [2]=å·¦ä¸Š [3]=ä¸? [4]=?³ä¸? [5]=ä¸??•ªå·? [6]=å·? [7]=ä¸?å¤? [8]=?³ [9]=ä¸??•ª?³ [10]=å·¦ä¸‹ [11]=ä¸? [12]=?³ä¸? [13]=ä¸??•ªä¸? 

  idXE = "1=0;2=-1;3=0;4=1;5=-2;6=-1;7=0;8=1;9=2;10=-1;11=0;12=1;13=0;"

  idYE = "1=-2;2=-1;3=-1;4=-1;5=0;6=0;7=0;8=0;9=0;10=1;11=1;12=1;13=2;"

EndSub

' 

Sub SetBlackEffect

  For i = 1 To 13

    iXE = iX + idXE[i]

    iYE = iY + idYE[i]

    If iXE > 0 And iXE <= iRo And iYE > 0 And iYE <= iRo Then

      iBlackEffect[iXE][iYE] = iBlackEffect[iXE][iYE] + 1

    EndIf

  EndFor

EndSub

'

Sub SetWhiteEffect

  For i = 1 To 13

    iXE = iX + idXE[i]

    iYE = iY + idYE[i]

    If iXE > 0 And iXE <= iRo And iYE > 0 And iYE <= iRo Then

      iWhiteEffect[iXE][iYE] = iWhiteEffect[iXE][iYE] + 1

    EndIf

  EndFor

EndSub

'

Sub InitBoard ' ?›¤?®?ˆ?œŸ?Œ–

  For i = 0 To iRo + 1

    iBoard[0][i] = OB

    iBoard[iRo + 1][i] = OB

    iBoard[i][0] = OB

    iBoard[i][iRo + 1] = OB

  EndFor

  idLX = rCX * 3      ' ç·šã®?–“?š”

  iSR = idLX / 2 - 2  ' ç¢çŸ³?®?Šå¾?

  idLY = rCY * 2      ' ç·šã®?–“?š”

  iLX0 = rCX * 6.5    ' å·?ç«??®ç·?

  iLY0 = rCY * 4.5    ' ä¸Šç«¯?®ç·?

  iLX1 = iLX0 + idLX * (iRo - 1) ' ?³ç«??®ç·?

  iLY1 = iLY0 + idLY * (iRo - 1) ' ä¸‹ç«¯?®ç·?

  If iRo > 9 Then

    iBX0 = iLX0 - idLX * 2    ' ?›¤?®å·?ç«?

  Else

    iBX0 = iLX0 - idLX * 1.5  ' ?›¤?®å·?ç«?

  EndIf

  iBY0 = iLY0 - idLY * 1.5    ' ?›¤?®ä¸Šç«¯

  iBX1 = iLX1 + idLX          ' ?›¤?®?³ç«?

  iBY1 = iLY1 + idLY          ' ?›¤?®ä¸‹ç«¯

EndSub

'

Sub ClearBoard  ' ?›¤?¢?®?‚¯?ƒª?‚¢

  For iX = 1 To iRo

    For iY = 1 To iRo

      iBoard[iX][iY] = SPACE

    EndFor

  EndFor

  iPrisoner[BLACK] = 0

  iPrisoner[WHITE] = 0

  Controls.SetTextBoxText(oPrisoner[BLACK], 0)

  Controls.SetTextBoxText(oPrisoner[WHITE], 0)

EndSub

'

' ?‚°?ƒ©?ƒ•?‚£?ƒƒ?‚¯?‚¹?–¢?£ï¼š

Sub ShowBoard ' ?›¤?®è¡¨ç¤º

  ' ?›¤?®?‰²?‚’å¡—ã‚‹

  GraphicsWindow.BrushColor = sBoardColor

  GraphicsWindow.FillRectangle(iBX0, iBY0, iBX1 - iBX0, iBY1 - iBY0)

  ' ? ?‚’??

  iPW = GraphicsWindow.PenWidth

  GraphicsWindow.PenWidth = 4

  GraphicsWindow.DrawRectangle(iLX0, iLY0, idLX * (iRo - 1), idLY * (iRo - 1))

  GraphicsWindow.PenWidth = iPW

  ' ç·šã‚’??

  GraphicsWindow.PenColor = "Black"

  For iX = iLX0 To iLX1 Step idLX

    GraphicsWindow.DrawLine(iX, iLY0, iX, iLY1)

  EndFor

  For iY = iLY0 To iLY1 Step idLY

    GraphicsWindow.DrawLine(iLX0, iY, iLX1, iY)

  EndFor

  ' ?•°å­—ã‚’?›¸?

  GraphicsWindow.BrushColor = "Black"

  For iX = 1 To iRo

    If iX < 10 Then

      GraphicsWindow.DrawText(iLX0 + (iX - 1.2) * idLX, iLY0 - idLY - 3, iX)

    Else

      GraphicsWindow.DrawText(iLX0 + (iX - 1.2) * idLX - rCX / 2, iLY0 - idLY - 3, iX)

    EndIf  

  EndFor  

  For iY = 1 To iRo

    If iY < 10 Then

      GraphicsWindow.DrawText(iLX0 - idLX, iLY0 + (iY - 1.25) * idLY - 3, iY)

    Else

      GraphicsWindow.DrawText(iLX0 - idLX - rCX, iLY0 + (iY - 1.25) * idLY - 3, iY)

    EndIf  

  EndFor  

EndSub

'

Sub DrawStone ' ç¢çŸ³?‚’??

  If iColor = WHITE Then

    iStoneColor = "White"

    iNumColor = "Black"

  ElseIf iColor = BLACK Then

    iStoneColor = "Black"

    iNumColor = "White"

  EndIf

  If iColor = BLACK Or iColor = WHITE Then  

    GraphicsWindow.BrushColor = iStoneColor

    GraphicsWindow.FillEllipse(iLX0 + (iX - 1) * idLX - iSR, iLY0 + (iY - 1) * idLY - iSR, iSR * 2, iSR * 2) 

    If bShowMove Then

      rNY = rCY * 0.8

      GraphicsWindow.FontSize = rNY

      If iMove > 99 Then

        iND = 3

      ElseIf iMove > 9 Then

        iND = 2

      Else

        iND = 1

      EndIf

      iNX = iLX0 + (iX - 1) * idLX - rNY * iND / 3

      iNY = iLY0 + (iY - 1) * idLY - rNY / 2 - 2

      GraphicsWindow.BrushColor = iNumColor

      GraphicsWindow.DrawText(iNX, iNY, iMove)

      GraphicsWindow.FontSize = rCY

    EndIf

  EndIf  

EndSub

'

Sub EraseStone  ' ç¢çŸ³?‚’æ¶ˆã™

  ' ç¢çŸ³?‚’ç¢ç›¤?®?‰²?§æ¶ˆã™

  GraphicsWindow.BrushColor = sBoardColor

  GraphicsWindow.FillRectangle(iLX0 + (iX - 1) * idLX - iSR, iLY0 + (iY - 1) * idLY - iSR, iSR * 2, iSR * 2) 

  GraphicsWindow.PenColor = "Black"

  ' æ¨ªç·š?®å¼•ã?›´?—

  If iX = 1 Then

    iEX0 = iLX0

  Else

    iEX0 = iLX0 + (iX - 1) * idLX - iSR

  EndIf

  If iX = iRo Then  

    iEX1 = iLX0 + (iX - 1) * idLX

  Else

    iEX1 = iLX0 + (iX - 1) * idLX + iSR

  EndIf

  iEY0 = iLY0 + (iY - 1) * idLY  

  iEY1 = iLY0 + (iY - 1) * idLY

  iPW = GraphicsWindow.PenWidth

  If iY = 1 Or iY = iRo Then

    GraphicsWindow.PenWidth = 4

    GraphicsWindow.DrawLine(iEX0 - 2, iEY0, iEX1 + 2, iEY1)    

  Else

    GraphicsWindow.DrawLine(iEX0, iEY0, iEX1, iEY1)    

  EndIf

  GraphicsWindow.PenWidth = iPW 

  ' ç¸?ç·šã®å¼•ã?›´?—

  iEX0 = iLX0 + (iX - 1) * idLX

  iEX1 = iLX0 + (iX - 1) * idLX

  If iY = 1 Then

    iEY0 = iLY0

  Else

    iEY0 = iLY0 + (iY - 1) * idLY - iSR  

  EndIf

  If iY = iRo Then  

    iEY1 = iLY0 + (iY - 1) * idLY 

  Else

    iEY1 = iLY0 + (iY - 1) * idLY + iSR 

  EndIf  

  If iX = 1 Or iX = iRo Then

    GraphicsWindow.PenWidth = 4

    GraphicsWindow.DrawLine(iEX0, iEY0 - 2, iEX1, iEY1 + 2)    

  Else

    GraphicsWindow.DrawLine(iEX0, iEY0, iEX1, iEY1)    

  EndIf

  GraphicsWindow.PenWidth = iPW 

EndSub

'

Sub XDeadStones ' ç¢çŸ³?«Ã—?‚’ä»˜ã‘?‚‹

  If iDeadSum > 0 Then

    sPC = GraphicsWindow.PenColor

    GraphicsWindow.PenColor = "Red"

    iPW = GraphicsWindow.PenWidth

    GraphicsWindow.PenWidth = 4

    For i = 1 To iDeadSum

      iX = iDX[i]

      iY = iDY[i] 

      GraphicsWindow.DrawLine(iLX0 + (iX - 1) * idLX - iSR / 2, iLY0 + (iY - 1) * idLY - iSR / 2, iLX0 + (iX - 1) * idLX + iSR / 2, iLY0 + (iY - 1) * idLY + iSR / 2) 

      GraphicsWindow.DrawLine(iLX0 + (iX - 1) * idLX + iSR / 2, iLY0 + (iY - 1) * idLY - iSR / 2, iLX0 + (iX - 1) * idLX - iSR / 2, iLY0 + (iY - 1) * idLY + iSR / 2) 

    EndFor  

    GraphicsWindow.PenColor = sPC

    GraphicsWindow.PenWidth = iPW

  EndIf

EndSub

'

Sub DrawTerritory ' ?œ°?«?››è§’ã‚’??

  For iY = 1 To iRo

    For iX = 1 To iRo

      If iBoard[iX][iY] = SPACE And iTerritory[iX][iY] = BLACK Then

        GraphicsWindow.BrushColor = "Black"

        GraphicsWindow.FillRectangle(iLX0 + (iX - 1) * idLX - iSR / 2, iLY0 + (iY - 1) * idLY - iSR / 2, iSR, iSR) 

      ElseIf iBoard[iX][iY] = SPACE And iTerritory[iX][iY] = WHITE Then

        GraphicsWindow.BrushColor = "White"

        GraphicsWindow.FillRectangle(iLX0 + (iX - 1) * idLX - iSR / 2, iLY0 + (iY - 1) * idLY - iSR / 2, iSR, iSR) 

      EndIf

    EndFor

  EndFor

EndSub

'

' æ£‹è­œ?ƒ•?‚¡?‚¤?ƒ«?–¢?£ï¼š

Sub InitRecord  ' æ£‹è­œ?®?ˆ?œŸ?Œ–

  iNumRec = 0

EndSub

'

Sub Record  ' æ£‹è­œ?®è¨˜éŒ²

  iNumRec = iNumRec + 1

  If bPass Then

    iX = iRo + 1

    iY = iRo + 1

  EndIf

  iRecord[iNumRec]["x"] = iX

  iRecord[iNumRec]["y"] = iY

  iRecord[iNumRec]["turn"] = iColor

EndSub  

'

Sub ReplayGame  ' æ£‹è­œ?«?‚ˆ?‚‹å¯¾å??®?†?”Ÿ

  bShowMove = "True"

  ClearBoard()    ' ?›¤?¢?®?‚¯?ƒª?‚¢

  ShowBoard()     ' ?›¤?®è¡¨ç¤º

  Shapes.SetText(oPrisoner[BLACK], 0) ' ?‚¢?‚²?ƒ?ƒ?®?‚¯?ƒª?‚¢

  Shapes.SetText(oPrisoner[WHITE], 0) ' ?‚¢?‚²?ƒ?ƒ?®?‚¯?ƒª?‚¢

  iMove = 0       ' ?‰‹?•°?®?‚¯?ƒª?‚¢

  bInGame = "True"

  bReplay = "True"

  While bInGame

    EachTurn()    ' é»’ç•ª

    If bInGame Then

      EachTurn()  ' ?™½?•ª

    EndIf    

  EndWhile

  bInGame = "True"

EndSub      

'

' ä»¥ä¸‹?®3?¤?®?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³?¯???ƒŸ?ƒ¼?§?™?‚æ£‹è­œã®?…¥?‡º?Š›?‚’è¡Œã†?¨??¯??

' å®Ÿéš›?®?ƒ—?ƒ­?‚°?ƒ©?ƒ ?¯?ƒ—?ƒ­?‚°?ƒ©?ƒ ID DWG627?¨?—?¦?™ºè¡Œã—?¾?—?Ÿ?®?§??

' ??¡?‚‰?‹?‚‰?‚¤?ƒ³?ƒ?ƒ¼?ƒˆ?—?¦çµ„ã¿è¾¼ã‚“?§?? ?•?„??

'

Sub WriteRecord ' æ£‹è­œ?ƒ•?‚¡?‚¤?ƒ«?®?›¸??‡º?—?¼ˆä¿å­˜ï¼?

EndSub      

'

Sub ReadRecord  ' æ£‹è­œ?ƒ•?‚¡?‚¤?ƒ«?®èª??¿è¾¼ã¿ï¼ˆé–‹?ï¼?

  bError = "False"

EndSub

'

Sub SaveGameDate  ' æ£‹è­œ?‡º?Š›?”¨?®?—¥ä»˜ã‚’ä¿å­˜

EndSub

'

' ?ƒ‡?ƒ?ƒƒ?‚°?–¢?£ï¼š

Sub DumpPoint

  TextWindow.Write("(" + iX + "," + iY + ")")

EndSub

'

Sub DumpNewLine

  TextWindow.WriteLine("")

EndSub

'

Sub DumpMove

  TextWindow.Write(iMove)

EndSub

'

Sub StartClock  ' ?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³ StartClock - ?™‚è¨ˆã‚’?–‹å§‹ã™?‚‹

  iBeginTime = Clock.ElapsedMilliseconds

  iEms = iBeginTime

  TextWindow.Write("Start: ")

  PrintClock()

  TextWindow.Write(" ")

EndSub

'

Sub StopClock ' ?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³ StopClock - ?™‚è¨ˆã‚’çµ‚äº†?™?‚‹

  iEndTime = Clock.ElapsedMilliseconds

  iEms = iEndTime

  TextWindow.Write("Stop: ")

  PrintClock()

  TextWindow.Write(" ")

EndSub

'

Sub PrintTime ' ?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³ PrintTime - ?™‚?–“?‚’?‡º?Š›?™?‚‹

  iEms = iEndtime - iBeginTime

  TextWindow.Write("Time: ")

  PrintClock()

  TextWindow.WriteLine("")

EndSub

'

Sub PrintClock  ' ?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³ PrintClock - ?™‚?ˆ»?‚’?‡º?Š›?™?‚‹

  ConvertEmsToTime()

  TextWindow.Write(iTime["Hour"] + ":" + iTime["Munite"] + ":" + iTime["Second"])

EndSub

'

Sub ConvertEmsToTime  ' ?‚µ?ƒ–?ƒ«?ƒ¼?ƒ?ƒ³ ConvertEmsToTime - Ems?‚’?™‚?ˆ†ç§’ã«å¤‰æ›?™?‚‹

  iHMSMs = Math.Remainder(iEms, 24 * 60 * 60 * 1000)

  iTime["Hour"] = Math.Floor(iHMSMs / (60 * 60 * 1000))

  iMSMs = Math.Remainder(iHMSMs, 60 * 60 * 1000)

  iTime["Munite"] = Math.Floor(iMSMs / (60 * 1000))

  iSMs = Math.Remainder(iMSMs, 60 * 1000)

  iTime["Second"] = Math.Floor(iSMs / 1000)

EndSub


