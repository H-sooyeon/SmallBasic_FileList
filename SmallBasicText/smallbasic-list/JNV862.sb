'Small 3D renderer for the Twenty Five Line Challenge

'by ThirdMagus



'WARNING! MAY CONTAIN LINEAR ALGEBRA!



GraphicsWindow.Title = "Small 3D renderer"

GraphicsWindow.Height = 600

GraphicsWindow.Width = 800



'The number of triangles in our model

'NUMBER_OF_TRIANGLES = 4 'for the Piramid

NUMBER_OF_TRIANGLES = 36 'for the Arwing





'Model:

'Each column represents a vector. The first row holds the x-coordinate, the 2nd y, the 3rd z and the 4th row contains only '1's.

'Each group of three columns represents a triangle.

'The following model is a somewhat elongated Triangular Piramid with corners at (0,-10,0), (-7,6,1), (1,7,-7) and (5,0,5).

'Model = "0=0\=0\;1\=-7\;2\=1\;3\=0\;4\=1\;5\=5\;6\=0\;7\=5\;8\=-7\;9\=5\;10\=1\;11\=-7\;;1=0\=-10\;1\=6\;2\=7\;3\=-10\;4\=7\;5\=0\;6\=-10\;7\=0\;8\=6\;9\=0\;10\=7\;11\=6\;;2=0\=0\;1\=1\;2\=-7\;3\=0\;4\=-7\;5\=5\;6\=0\;7\=5\;8\=1\;9\=5\;10\=-7\;11\=1\;;3=0\=1\;1\=1\;2\=1\;3\=1\;4\=1\;5\=1\;6\=1\;7\=1\;8\=1\;9\=1\;10\=1\;11\=1\;;"



'A (slightly glitchy) model of the Arwing from StarFox (StarWing in Europe)

Model = "0=0\=-6\;1\=-5\;2\=-6\;3\=-6\;4\=-5\;5\=-8\;6\=6\;7\=6\;8\=5\;9\=6\;10\=8\;11\=5\;12\=0\;13\=1\;14\=-1\;15\=0\;16\=-1\;17\=-4\;18\=0\;19\=-4\;20\=-5\;21\=0\;22\=-5\;23\=0\;24\=0\;25\=0\;26\=5\;27\=0\;28\=5\;29\=4\;30\=0\;31\=4\;32\=1\;33\=-1\;34\=1\;35\=1\;36\=1\;37\=-1\;38\=-1\;39\=-1\;40\=-1\;41\=-4\;42\=1\;43\=4\;44\=1\;45\=-1\;46\=1\;47\=0\;48\=-4\;49\=-1\;50\=0\;51\=4\;52\=0\;53\=1\;54\=-4\;55\=0\;56\=4\;57\=-5\;58\=5\;59\=0\;60\=-10\;61\=-4\;62\=-17\;63\=-10\;64\=-17\;65\=-9\;66\=-10\;67\=-9\;68\=-4\;69\=-4\;70\=-9\;71\=-17\;72\=10\;73\=17\;74\=4\;75\=10\;76\=9\;77\=17\;78\=10\;79\=4\;80\=9\;81\=4\;82\=17\;83\=9\;84\=6\;85\=5\;86\=8\;87\=5\;88\=8\;89\=8\;90\=6\;91\=8\;92\=8\;93\=8\;94\=6\;95\=6\;96\=-6\;97\=-8\;98\=-5\;99\=-5\;100\=-8\;101\=-8\;102\=-6\;103\=-6\;104\=-8\;105\=-8\;106\=-8\;107\=-6\;;1=0\=-5\;1\=0\;2\=3\;3\=3\;4\=0\;5\=8\;6\=-5\;7\=3\;8\=0\;9\=3\;10\=8\;11\=0\;12\=0\;13\=2\;14\=2\;15\=0\;16\=2\;17\=0\;18\=0\;19\=0\;20\=0\;21\=0\;22\=0\;23\=-2\;24\=0\;25\=-2\;26\=0\;27\=0\;28\=0\;29\=0\;30\=0\;31\=0\;32\=2\;33\=2\;34\=2\;35\=4\;36\=4\;37\=4\;38\=2\;39\=2\;40\=4\;41\=0\;42\=2\;43\=0\;44\=4\;45\=4\;46\=4\;47\=1\;48\=0\;49\=4\;50\=1\;51\=0\;52\=1\;53\=4\;54\=0\;55\=1\;56\=0\;57\=0\;58\=0\;59\=-2\;60\=0\;61\=0\;62\=0\;63\=0\;64\=0\;65\=-1\;66\=0\;67\=-1\;68\=0\;69\=0\;70\=-1\;71\=0\;72\=0\;73\=0\;74\=0\;75\=0\;76\=-1\;77\=0\;78\=0\;79\=0\;80\=-1\;81\=0\;82\=0\;83\=-1\;84\=-5\;85\=0\;86\=0\;87\=0\;88\=8\;89\=0\;90\=-5\;91\=0\;92\=8\;93\=8\;94\=3\;95\=-5\;96\=-5\;97\=0\;98\=0\;99\=0\;100\=0\;101\=8\;102\=-5\;103\=3\;104\=8\;105\=8\;106\=0\;107\=-5\;;2=0\=5\;1\=-4\;2\=-3\;3\=-3\;4\=-4\;5\=-11\;6\=5\;7\=-3\;8\=-4\;9\=-3\;10\=-11\;11\=-4\;12\=17\;13\=1\;14\=1\;15\=17\;16\=1\;17\=-2\;18\=17\;19\=-2\;20\=-2\;21\=17\;22\=-2\;23\=0\;24\=17\;25\=0\;26\=-2\;27\=17\;28\=-2\;29\=-2\;30\=17\;31\=-2\;32\=1\;33\=1\;34\=1\;35\=-3\;36\=-3\;37\=-3\;38\=1\;39\=1\;40\=-3\;41\=-2\;42\=1\;43\=-2\;44\=-3\;45\=-3\;46\=-3\;47\=-4\;48\=-2\;49\=-3\;50\=-4\;51\=-2\;52\=-4\;53\=-3\;54\=-2\;55\=-4\;56\=-2\;57\=-2\;58\=-2\;59\=0\;60\=-2\;61\=-2\;62\=-12\;63\=-2\;64\=-12\;65\=-4\;66\=-2\;67\=-4\;68\=-2\;69\=-2\;70\=-4\;71\=-12\;72\=-2\;73\=-12\;74\=-2\;75\=-2\;76\=-4\;77\=-12\;78\=-2\;79\=-2\;80\=-4\;81\=-2\;82\=-12\;83\=-4\;84\=5\;85\=-4\;86\=-4\;87\=-4\;88\=-11\;89\=-4\;90\=5\;91\=-4\;92\=-11\;93\=-11\;94\=-3\;95\=5\;96\=5\;97\=-4\;98\=-4\;99\=-4\;100\=-4\;101\=-11\;102\=5\;103\=-3\;104\=-11\;105\=-11\;106\=-4\;107\=5\;;3=0\=1\;1\=1\;2\=1\;3\=1\;4\=1\;5\=1\;6\=1\;7\=1\;8\=1\;9\=1\;10\=1\;11\=1\;12\=1\;13\=1\;14\=1\;15\=1\;16\=1\;17\=1\;18\=1\;19\=1\;20\=1\;21\=1\;22\=1\;23\=1\;24\=1\;25\=1\;26\=1\;27\=1\;28\=1\;29\=1\;30\=1\;31\=1\;32\=1\;33\=1\;34\=1\;35\=1\;36\=1\;37\=1\;38\=1\;39\=1\;40\=1\;41\=1\;42\=1\;43\=1\;44\=1\;45\=1\;46\=1\;47\=1\;48\=1\;49\=1\;50\=1\;51\=1\;52\=1\;53\=1\;54\=1\;55\=1\;56\=1\;57\=1\;58\=1\;59\=1\;60\=1\;61\=1\;62\=1\;63\=1\;64\=1\;65\=1\;66\=1\;67\=1\;68\=1\;69\=1\;70\=1\;71\=1\;72\=1\;73\=1\;74\=1\;75\=1\;76\=1\;77\=1\;78\=1\;79\=1\;80\=1\;81\=1\;82\=1\;83\=1\;84\=1\;85\=1\;86\=1\;87\=1\;88\=1\;89\=1\;90\=1\;91\=1\;92\=1\;93\=1\;94\=1\;95\=1\;96\=1\;97\=1\;98\=1\;99\=1\;100\=1\;101\=1\;102\=1\;103\=1\;104\=1\;105\=1\;106\=1\;107\=1\;;"



'Color:

'Each column represents the color of a triangle.The first row holds the Red value, the 2nd Green and the 3rd Blue; all from 0 to 255.

'The order of the colors corresponds to the order of the triangles in the model specified above.

'The triangles of the Piramid model are colored (in order): Red, Green, Blue and Yellow.

'Color = "0=0\=255\;1\=0\;2\=0\;3\=255\;;1=0\=0\;1\=255\;2\=0\;3\=255\;;2=0\=0\;1\=0\;2\=255\;3\=0\;;"



'The colors of the Arwing model

Color = "0=0\=0\;1\=0\;2\=0\;3\=0\;4\=168\;5\=168\;6\=168\;7\=168\;8\=168\;9\=168\;10\=168\;11\=85\;12\=85\;13\=168\;14\=168\;15\=168\;16\=168\;17\=168\;18\=255\;19\=168\;20\=168\;21\=168\;22\=168\;23\=168\;24\=168\;25\=168\;26\=168\;27\=168\;28\=0\;29\=0\;30\=0\;31\=0\;32\=0\;33\=0\;34\=0\;35\=0\;;1=0\=0\;1\=0\;2\=0\;3\=0\;4\=168\;5\=168\;6\=168\;7\=168\;8\=168\;9\=168\;10\=168\;11\=102\;12\=102\;13\=168\;14\=168\;15\=168\;16\=168\;17\=168\;18\=128\;19\=168\;20\=168\;21\=168\;22\=168\;23\=168\;24\=168\;25\=168\;26\=168\;27\=168\;28\=0\;29\=0\;30\=0\;31\=0\;32\=0\;33\=0\;34\=0\;35\=0\;;2=0\=168\;1\=168\;2\=168\;3\=168\;4\=168\;5\=168\;6\=168\;7\=168\;8\=168\;9\=168\;10\=168\;11\=255\;12\=255\;13\=168\;14\=168\;15\=168\;16\=168\;17\=168\;18\=0\;19\=168\;20\=168\;21\=168\;22\=168\;23\=168\;24\=168\;25\=168\;26\=168\;27\=168\;28\=168\;29\=168\;30\=168\;31\=168\;32\=168\;33\=168\;34\=168\;35\=168\;;"



'Phi: the y-axis rotation of the model (in radians)

Phi = 0



'Label for the infinite loop

repeat:



'Rotation matrix:

'[cos(phi)   0  sin(phi)   0]

'[      0          1       0          0]

'[-sin(phi)  0  cos(phi)  0]

'[      0         0       0           1]

'where phi is the y-axis rotation of the model (in radians)



'Translation matrix:

'[1    0    0    0  ]

'[0    1    0    0  ]

'[0    0    1  - z  ]

'[0    0    0   1   ]

'where z is the z offset of the model (how far it is behind the screen)

'z is fixed at 30 for this demo.



'Projection matrix:

'[1    0       0      0]

'[0    1       0      0]

'[0    0       1      0]

'[0    0    1/d    0]

'where d is the distance from the viewer to the screen

'd is fixed at 500 for this demo



'Combine into single transform matrix

'Projection * Translation * Rotation =

'[    cos(phi)     0        sin(phi)       0   ]

'[          0            1              0             0   ]

'[    -sin(phi)    0       cos(phi)       z   ]

'[-sin(phi)/d   0     cos(phi)/d   z/d ]

Transform = "0=0\="+(Math.Cos(Phi))+"\;1\=0\;2\="+(Math.Sin(Phi))+"\;3\=0\;;1=0\=0\;1\=1\;2\=0\;3\=0\;;2=0\="+(-1*Math.Sin(Phi))+"\;1\=0\;2\="+(Math.Cos(Phi))+"\;3\="+-30+"\;;3=0\="+(-1*Math.Sin(Phi)/500)+"\;1\=0\;2\="+(Math.Cos(Phi)/500)+"\;3\="+-0.06+"\;;"



'Matrix multiplication: Transform * Model

For j=0 To (3 * NUMBER_OF_TRIANGLES - 1)

  For i=0 To 3

    C[i][j] = Transform[i][0] * Model[0][j] + Transform[i][1] * Model[1][j] + Transform[i][2] * Model[2][j] + Transform[i][3] * Model[3][j]

  EndFor

EndFor



'We clear the GraphicsWindow to erase the previous frame.

GraphicsWindow.Clear()



For t=0 To (NUMBER_OF_TRIANGLES - 1)

  

'Backface culling: Display only if the z-component of the normal of the triangle is negative (facing towards us.) This means triangles have to be specified in CCW order.

  If ((C[0][1+3*t]/C[3][1+3*t] - C[0][0+3*t]/C[3][0+3*t]) * (C[1][1+3*t]/C[3][1+3*t] - C[1][2+3*t]/C[3][2+3*t]) < (C[1][1+3*t]/C[3][1+3*t] - C[1][0+3*t]/C[3][0+3*t]) * (C[0][1+3*t]/C[3][1+3*t] - C[0][2+3*t]/C[3][2+3*t])) Then

'Set the fill color according to the Color matrix;

    GraphicsWindow.BrushColor = GraphicsWindow.GetColorFromRGB(Color[0][t],Color[1][t],Color[2][t])

'Draw the triangle. We divide each coordinate by the value in the 4th row return from homogenous coordinates to regular ones. We also add 200 in order to center the image somewhat.

    GraphicsWindow.FillTriangle(C[0][0+3*t]/C[3][0+3*t]+400,1*(C[1][0+3*t]/C[3][0+3*t])+300,C[0][1+3*t]/C[3][1+3*t]+400,1*(C[1][1+3*t]/C[3][1+3*t])+300,C[0][2+3*t]/C[3][2+3*t]+400,1*(C[1][2+3*t]/C[3][2+3*t])+300)

  EndIf

EndFor

'Delay between each frame. Decrease this value to increase performance.

Program.Delay(10)

'Add 0.1 radians to the angle. Add more to make it rotate faster.

Phi = Phi + 0.1

'Render the next frame

Goto repeat






