Initialise()

'Main Loop

StartTime = LDDateTime.Now()

While ("True")

Â Â start = Clock.ElapsedMilliseconds

Â Â UpdateGamePlay()

Â Â UpdateFrame()

Â Â delay = 20 - (Clock.ElapsedMilliseconds - start)

Â Â If (delay > 0) Then

Â Â Â Â Program.Delay(delay)

    PastTime = Math.Ceiling(LDDateTime.Subtract(LDDateTime.Now(), StartTime)*100000)

    texttitle = "QUIX: "+ PastTime

    GraphicsWindow.Title = texttitle 

Â Â EndIf

EndWhile



'------------------------------------------------

'SUBROUTINES

'------------------------------------------------



Sub Initialise

  f = "False"

  t = "True"

Â Â 'GraphicsWindow

Â ? GraphicsWindow.Title = "QUIX: 0"

  gw = 780

Â Â gh = 600

  GraphicsWindow.Top = 10

  GraphicsWindow.Left = 10

Â Â GraphicsWindow.Width = gw

Â Â GraphicsWindow.Height = gh

Â Â 'Register events

Â Â GraphicsWindow.KeyDown = OnKeyDown

Â Â GraphicsWindow.KeyUp = OnKeyUp

Â Â 'Event flags

Â Â keyLeft = f

Â Â keyRight = f

Â Â keyUp = f

Â Â keyDown = f

  GraphicsWindow.BackgroundColor = "White"

  GraphicsWindow.PenWidth = 3

Â Â 'Sprites

Â Â size = 40

  sizehalf = 20

  s = 20

Â Â exp = size 

  eyp = size 

  GraphicsWindow.PenColor = "Red"

  enemyPosX = 250 + Math.GetRandomNumber(gw-200)

Â Â enemyPosY = 250 + Math.GetRandomNumber(gh-200)

Â Â enemyVelX = Math.GetRandomNumber(5) - 3

Â Â enemyVelY = Math.GetRandomNumber(5) - 3

  For i = 1 To s Step 2

    px = Math.GetRandomNumber(size*2)

    py = Math.GetRandomNumber(size*2)

    ex[i] = exp+px

    ey[i] = eyp+py

    ex[i+1] = exp-px

    ey[i+1] = eyp-py

    enemy[i] = Shapes.AddLine(exp, eyp, ex[i], ey[i])

    Shapes.Move(enemy[i], enemyPosX-sizehalf, enemyPosY-sizehalf) 

    enemy[i+1] = Shapes.AddLine(exp, eyp, ex[i+1], ey[i+1])

    Shapes.Move(enemy[i+1], enemyPosX-sizehalf, enemyPosY-sizehalf) 

  EndFor 

Â Â GraphicsWindow.BrushColor = "Black"

  GraphicsWindow.PenColor = "White"

  GraphicsWindow.FillRectangle(20, 20, GraphicsWindow.Width - 40, GraphicsWindow.Height - 40)

Â Â GraphicsWindow.BrushColor = "#AACCCCCC"

  player = Shapes.AddEllipse(size, size)

Â Â playerSpeed = 4

Â Â playerPosX = 20

Â Â playerPosY = 20

  OldplayerPosX = playerPosX '+sizehalf

  OldplayerPosY = playerPosY '+sizehalf

  GraphicsWindow.PenWidth = 7

EndSub



Sub UpdateGamePlay

Â Â If (keyLeft) Then

    If (playerPosX > sizehalf) Then

      playerPosX = playerPosX-playerSpeed

    EndIf

Â Â EndIf

Â Â If (keyRight) Then

    If (playerPosX < gw-sizehalf) Then

      playerPosX = playerPosX+playerSpeed

    EndIf

Â Â EndIf

Â Â If (keyUp) Then

    If (playerPosY > sizehalf) Then

      playerPosY = playerPosY-playerSpeed

    EndIf

Â Â EndIf

Â Â If (keyDown) Then

    If (playerPosY < gh-sizehalf) Then

      playerPosY = playerPosY+playerSpeed

    EndIf

Â Â EndIf

Â Â 'Enemy movement

Â Â enemyPosX = enemyPosX + enemyVelX

  enemyPosY = enemyPosY + enemyVelY

  ec = GraphicsWindow.GetPixel(enemyPosX, enemyPosY)

  If ec = "#00FFFF" Then 

    npr = Math.GetRandomNumber(3)

    If npr = 1 Then

      enemyVelX = enemyVelX*-1

      enemyVelY = enemyVelY*-1

    ElseIf npr = 2 Then

      enemyVelX = enemyVelX*-1

    ElseIf npr = 3 Then

      enemyVelY = enemyVelY*-1

    EndIf 

  Else 

    If (enemyPosX < sizehalf) Then

      enemyVelX = -enemyVelX

      enemyPosX = sizehalf

    ElseIf (enemyPosX > gw-size/2) Then

      enemyVelX = -enemyVelX

      enemyPosX = gw-sizehalf

    EndIf

    If (enemyPosY < sizehalf) Then

      enemyVelY = -enemyVelY

      enemyPosY = sizehalf

    ElseIf (enemyPosY > gh-sizehalf) Then

      enemyVelY = -enemyVelY

      enemyPosY = gh-sizehalf

    EndIf

  EndIf 

Â Â 'Check for collisions

Â Â Collision()

EndSub



Sub UpdateFrame

  For i = 1 to s 

    Shapes.Move(enemy[i], enemyPosX-sizehalf, enemyPosY-sizehalf)  

    Shapes.Rotate(enemy[i], Math.GetRandomNumber(30))

    r = Math.GetRandomNumber(200)-Math.GetRandomNumber(100)

    rz = Math.GetRandomNumber(r)/100

    Shapes.Zoom(enemy[i],rz, rz)

  EndFor 

Â Â Shapes.Move(player, playerPosX-sizehalf, playerPosY-sizehalf)

  GraphicsWindow.PenColor = "#00FFFF"

  GraphicsWindow.DrawLine(OldplayerPosX, OldplayerPosY, playerPosX, playerPosY)

  GraphicsWindow.BrushColor = "White"

  OldplayerPosX = playerPosX 

  OldplayerPosY = playerPosY 

  random = Math.GetRandomNumber(100) 

  If random < 3 Then 

    enemyVelX = Math.GetRandomNumber(5) - 3

    enemyVelY = Math.GetRandomNumber(5) - 3

  EndIf 

EndSub



Sub Collision

  For i = 1 To s

    if LDShapes.Overlap(player, enemy[i]) = t Then 

      Program.Delay(2000)

      GraphicsWindow.Clear()

      Initialise()

      StartTime = LDDateTime.Now()

Â Â    EndIf  

  EndFor 

EndSub



'------------------------------------------------

'EVENT SUBROUTINES

'------------------------------------------------



Sub OnKeyDown

Â Â lastKey = GraphicsWindow.LastKey

Â Â If (lastKey = "Left") Then

Â Â Â Â keyLeft = "True"

Â Â ElseIf (lastKey = "Right") Then

Â Â Â Â keyRight = "True"

Â Â ElseIf (lastKey = "Up") Then

Â Â Â Â keyUp = "True"

Â Â ElseIf (lastKey = "Down") Then

Â Â Â Â keyDown = "True"

Â Â EndIf 

EndSub



Sub OnKeyUp

Â Â lastKey = GraphicsWindow.LastKey

Â Â If (lastKey = "Left") Then

Â Â Â Â keyLeft = "False"

Â Â ElseIf (lastKey = "Right") Then

Â Â Â Â keyRight = "False"

Â Â ElseIf (lastKey = "Up") Then

Â Â Â Â keyUp = "False"

Â Â ElseIf (lastKey = "Down") Then

Â Â Â Â keyDown = "False"

Â Â EndIf 

EndSub




