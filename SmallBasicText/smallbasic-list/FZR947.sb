GraphicsWindow.Show()
GraphicsWindow.Title = "Improved paint by Błażej Bortel"
mayarray = 0
numcolin = 0
toolnum = 9
arrayid = 0
istrere = "True"
bitmap = "False"
bmpid = 0
nid = 0
mid = 0
ksi = 8
GraphicsWindow.Top = 0
GraphicsWindow.Left = 0
heightw = 750
width = 1000
toolswidth = 175
bottomsize = 80
size = 16
poiid = 0
chbgc = "False"
bgcol = "white"
isrub = "False"
colspi[0] = "czerwone"
colspi[1] = "różowe"
colspi[2] = "pomarańczowe"
colspi[3] = "żółte"
colspi[4] = "zielone"
colspi[5] = "fioletowe"
colspi[6] = "niebieskie"
colspi[7] = "brązowe"
colspi[8] = "białe"
colspi[9] = "szare"
colin[0] = 9
colin[1] = 6
colin[2] = 6
colin[3] = 8
colin[4] = 26
colin[5] = 18
colin[6] = 25
colin[7] = 17
colin[8] = 17
colin[9] = 10
col[0][0] = "indianred"
col[0][1] = "lightcoral"
col[0][2] = "salmon"
col[0][3] = "darksalmon"
col[0][4] = "lightsalmon"
col[0][5] = "crimson"
col[0][6] = "red"
col[0][7] = "firebrick"
col[0][8] = "darkred"
col[1][0] = "pink"
col[1][1] = "lightpink"
col[1][2] = "hotpink"
col[1][3] = "deeppink"
col[1][4] = "mediumvioletred"
col[1][5] = "palevioletred"
col[2][0] = "lightsalmon"
col[2][1] = "coral"
col[2][2] = "tomato"
col[2][3] = "orangered"
col[2][4] = "darkorange"
col[2][5] = "orange"
col[3][0] = "gold"
col[3][1] = "yellow"
col[3][2] = "lightyellow"
col[3][3] = "lemonchiffon"
col[3][4] = "LightGoldenrodYellow"
col[3][5] = "papayawhip"
col[3][6] = "moccasin"
col[3][7] = "peachpuff"
col[4][0] = "greenyellow"
col[4][1] = "chartreuse"
col[4][2] = "lawngreen"
col[4][3] = "lime"
col[4][4] = "limegreen"
col[4][5] = "palegreen"
col[4][6] = "lightgreen"
col[4][7] = "palegoldenrod"
col[4][8] = "khaki"
col[4][9] = "darkkhaki"
col[4][10] = "mediumspringgreen"
col[4][11] = "springgreen"
col[4][12] = "mediumseagreen"
col[4][13] = "seagreen"
col[4][14] = "forestgreen"
col[4][15] = "green"
col[4][16] = "darkgreen"
col[4][17] = "yellowgreen"
col[4][18] = "olivedrab"
col[4][19] = "olive"
col[4][20] = "darkolivegreen"
col[4][21] = "mediumaquamarine"
col[4][22] = "darkseagreen"
col[4][23] = "lightseagreen"
col[4][24] = "darkcyan"
col[4][25] = "teal"
col[5][0] = "lavender"
col[5][1] = "thistle"
col[5][2] = "plum"
col[5][3] = "violet"
col[5][4] = "orchid"
col[5][5] = "fuchsia"
col[5][6] = "magenta"
col[5][7] = "mediumorchid"
col[5][8] = "mediumpurple"
col[5][9] = "blueviolet"
col[5][10] = "darkviolet"
col[5][11] = "darkorchid"
col[5][12] = "darkmagenta"
col[5][13] = "purple"
col[5][14] = "indigo"
col[5][15] = "slateblue"
col[5][16] = "darkslateblue"
col[5][17] = "mediumslateblue"
col[6][0] = "aqua"
col[6][1] = "cyan"
col[6][2] = "lightcyan"
col[6][3] = "paleturquoise"
col[6][4] = "aquamarine"
col[6][5] = "turquoise"
col[6][6] = "mediumturquoise"
col[6][7] = "darkturquoise"
col[6][8] = "cadetblue"
col[6][9] = "steelblue"
col[6][10] = "lightsteelblue"
col[6][11] = "powderblue"
col[6][12] = "lightblue"
col[6][13] = "skyblue"
col[6][14] = "lightskyblue"
col[6][15] = "deepskyblue"
col[6][16] = "dodgerblue"
col[6][17] = "cornflowerblue"
col[6][18] = "mediumslateblue"
col[6][19] = "royalblue"
col[6][20] = "blue"
col[6][21] = "mediumblue"
col[6][22] = "darkblue"
col[6][23] = "navy"
col[6][24] = "midnightblue"
col[7][0] = "cornsilk"
col[7][1] = "blanchedalmond"
col[7][2] = "bisque"
col[7][3] = "navajowhite"
col[7][4] = "wheat"
col[7][5] = "burlywood"
col[7][6] = "tan"
col[7][7] = "rosybrown"
col[7][8] = "sandybrown"
col[7][9] = "goldenrod"
col[7][10] = "darkgoldenrod"
col[7][11] = "peru"
col[7][12] = "chocolate"
col[7][13] = "saddlebrown"
col[7][14] = "sienna"
col[7][15] = "brown"
col[7][16] = "maroon"
col[8][0] = "white"
col[8][1] = "snow"
col[8][2] = "honeydew"
col[8][3] = "mintcream"
col[8][4] = "azure"
col[8][5] = "aliceblue"
col[8][6] = "ghostwhite"
col[8][7] = "whitesmoke"
col[8][8] = "seashell"
col[8][9] = "beige"
col[8][10] = "oldlace"
col[8][11] = "floralwhite"
col[8][12] = "ivory"
col[8][13] = "antiquewhite"
col[8][14] = "linen
col[8][15] = "lavenderblush"
col[8][16] = "MistyRose"
col[9][0] = "gainsboro"
col[9][1] = "lightgray"
col[9][2] = "silver"
col[9][3] = "darkgray"
col[9][4] = "gray"
col[9][5] = "dimgray"
col[9][6] = "lightslategray"
col[9][7] = "slategray"
col[9][8] = "darkslategray"
col[9][9] = "black"
upp[0] = "Wyczyść"
upp[1] = "Zmień tło"
upp[2] = "Gumka"
upp[3] = "Zmień"
upp[4] = "Powiększ"
upp[5] = "Pomniejsz"
upp[6] = "Korekta"
upp[7] = "Zapisz"
upp[8] = "Wklej"
low[0] = "ekran"
low[1] = "ekranu"
low[2] = ""
low[3] = "pisak"
low[4] = "pisak"
low[5] = "pisak"
low[6] = ""
low[7] = "bitmapę"
low[8] = "bitmapę"
begin:
colmake()
toolsmake()
bottommake()
picidinfo()
GraphicsWindow.PenWidth = 2
GraphicsWindow.PenColor = "black"
GraphicsWindow.DrawLine(200 + bottomsize + bottomsize/2,height,bottomsize + 200 + bottomsize/2,heightw)
GraphicsWindow.PenWidth = 3
GraphicsWindow.BrushColor = "red"
iscur = 0
colb = 0
cola = 6
pisinfop()
pisinfoc()
pisinfos()
pisinfow()
start:
If Mouse.IsRightButtonDown = "False" then
colour()
draw()
join()
toolsactivate()
palettech()
endif
cww()
cwh()
cursor()
precur()
If cwhei = "True" then
  cwhei = "False"
  GraphicsWindow.Clear()
  poipoi[arrayid] = poiid
  arrayid = arrayid + 1
  Goto begin
endif
If cwwid = "True" then
  cwwid = "False"
  GraphicsWindow.Clear()
  poipoi[arrayid] = poiid
  arrayid = arrayid + 1
  Goto begin
endif
If cs = "True" then
  cs = "False"
  GraphicsWindow.Clear()
  bgcol = "white"
  Goto begin
endif
If chbgc = "True" then
  GraphicsWindow.Clear()
  Goto begin
endif
If palettech = "True" then
  palettech = "False"
  colq = GraphicsWindow.BrushColor
  bottompim()
endif
Goto start

Sub cwh
  If (heightw = GraphicsWindow.Height) Then
    cwhei = "False"
  Else
    heightw = GraphicsWindow.Height
    cwhei = "True"
  EndIf
Endsub

Sub colour
  If Mouse.IsLeftButtonDown="True" then
    If Mouse.MouseX<100 Then
    ar = 0
    xr = 99
    vr = Mouse.MouseX-12
    wr = Mouse.MouseY-27
    For sd = 0 to colnumend
    br = sd*odstep+1
    yr = sd*odstep+1+rechei
    range()
    If rresult = "True" Then
      GraphicsWindow.BrushColor = col[numcolin][sd]
      cola = sd
      colb = numcolin
      endif
    endfor
    pisinfop()
    pisinfoc()
  EndIf
endif
EndSub

Sub draw
  If Mouse.IsLeftButtonDown="True" then
    wr = Mouse.MouseY-26
    vr = Mouse.MouseX-8
    ar = 102 + size/2
    xr = width - 0 - toolswidth - size/2
    br = size/2
    yr = height - 0 - size/2
    range()
    If rresult = "True" then
      drawing = "True"
      poiid = poiid+1
      drawinm()
      colbru = GraphicsWindow.BrushColor
      poix[arrayid][poiid] = Mouse.MouseX - 8
      poiy[arrayid][poiid] = Mouse.MouseY - 26
      pois[arrayid][poiid] = size
      If isrub = "True" then
      poic[arrayid][poiid] = "d"
    else
      poic[arrayid][poiid] = colbru
      EndIf
      poim[arrayid][poiid] = ispisch
      If (isfirst = "True") then
        poifirst = poiid
        isfirst = "False"
      endif
    Else
      isfirst = "True"  
      drawing = "False"
    endif
  Else
  isfirst = "True"  
EndIf
EndSub
  
Sub range  
rresult = ""
If ar<vr Then
  rresult = Text.Append(rresult,"1")
Else
  rresult = Text.Append(rresult,"0")
EndIf
If xr>vr Then
  rresult = Text.Append(rresult,"1")
Else
  rresult = Text.Append(rresult,"0")
EndIf
If br<wr Then
  rresult = Text.Append(rresult,"1")
Else
  rresult = Text.Append(rresult,"0")
EndIf
If wr<yr Then
  rresult = Text.Append(rresult,"1")
Else
  rresult = Text.Append(rresult,"0")
EndIf
If rresult = "1111" Then
  rresult = "True"
Else
  rresult = "False"
EndIf
EndSub

Sub cww
  If (width = GraphicsWindow.Width) Then
    cwwid = "False"
  Else
    width = GraphicsWindow.width
    cwwid = "True"
  EndIf
EndSub

Sub join
  If drawing = "True" Then
    linestart[arrayid][nid] = poifirst
    linend[arrayid][nid] = poiid
    For iy = poifirst To poiid-1
      GraphicsWindow.PenWidth = pois[arrayid][iy]
      GraphicsWindow.PenColor = poic[arrayid][iy]
      isrubornot()
      GraphicsWindow.DrawLine(poix[arrayid][iy],poiy[arrayid][iy],poix[arrayid][iy+1],poiy[arrayid][iy+1])
    EndFor
    GraphicsWindow.PenWidth = 3
    nid = nid + 1
  EndIf
EndSub

Sub toolsmake
  todstep = height/toolnum
  GraphicsWindow.BrushColor = "lightSkyBlue"
  GraphicsWindow.FillRectangle(width-toolswidth+1,0,toolswidth,height)
  GraphicsWindow.BrushColor = "Black"
  For gt = 0 To toolnum-1
    GraphicsWindow.DrawLine(width-toolswidth,gt*todstep+todstep,width,gt*todstep+todstep)
  EndFor
  GraphicsWindow.BrushColor = "black"
  For rer = 0 To toolnum-1
    tag = upp[rer]
    tagleng = Text.GetLength(tag)
    GraphicsWindow.FontSize  = todstep/4
    font = todstep/4
    wc =  Shapes.AddText(tag)
    toolswinbeg = width - toolswidth
    centring = (toolswidth - font * tagleng *3/5)/2
    Shapes.Move(wc,toolswinbeg + centring,todstep/10+rer*todstep)
    tag = low[rer]
    tagleng = Text.GetLength(tag)
    GraphicsWindow.FontSize  = todstep/4
    font = todstep/4
    wc =  Shapes.AddText(tag)
    toolswinbeg = width - toolswidth
    centring = (toolswidth - font * tagleng *3/5)/2
    Shapes.Move(wc,toolswinbeg + centring,todstep/2+rer*todstep)
  EndFor
EndSub

sub toolsactivate
  If Mouse.IsLeftButtonDown = "True" Then
    vr = Mouse.MouseX-12
    wr = Mouse.MouseY-27
    ar = width - toolswidth + 2
    xr = width
    For fer = 0 To toolnum-1
      br = fer * todstep + 1
      yr = fer * todstep + todstep  + 1
      range()
      If rresult = "True" Then
        toolacti = fer + 1
      Else
        toolacti = 0
      EndIf
      If toolacti = 1 Then
        markon()
        Program.Delay(100)
        cs()
        markof()
      EndIf
      If toolacti = 2 Then
        markon()
        Program.Delay(100)
        bgch()
        markof()
      EndIf
      If toolacti = 3 Then
        rubber()
      EndIf
      If toolacti = 4 Then
        markon()
        pisch()
        markof()
      EndIf
      If toolacti = 5 Then
        pisincr()
        markof()
      EndIf
      If toolacti = 6 Then
        pisdecr()
        markof()
      EndIf
      If toolacti = 7 Then
        markon()
        Program.Delay(100)
        correct()
        markof()
      EndIf
      If toolacti = 8 Then
        markon()
        bmpsave()
        preview()
        markof()
      EndIf
      If toolacti = 9 Then
        markon()
        bmppaste()
        markof()
      EndIf
    EndFor
  EndIf
EndSub

Sub cs
  GraphicsWindow.BrushColor = "white"
  cs = "True"
  poipoi[arrayid] = poiid
  poinid[arrayid] = nid
  arrayid = arrayid + 1
  nid = 0
  mid = 0
EndSub

Sub rubber
  If isrub = "True" then
    markof()
    GraphicsWindow.BrushColor = colrecovery
    isrub = "False"
    Program.Delay(250)
  Else
    markon()
    colrecovery = GraphicsWindow.BrushColor
    GraphicsWindow.BrushColor = GraphicsWindow.BackgroundColor
    isrub = "True"
    Program.Delay(250)
  EndIf
  pisinfop()
EndSub

Sub bgch
  bgcol = GraphicsWindow.BrushColor
  chbgc = "True"
  mid = 0
EndSub

Sub pisch
  If ispisch = "True" then
    ispisch = "False"
    Program.Delay(250)
  Else
    ispisch = "True"
    Program.Delay(250)
  EndIf
  pisinfop()
  pisinfos()
EndSub

Sub drawinm
  If ispisch = "True" Then
    GraphicsWindow.FillEllipse(vr - size/2,wr - size/2,size,size)
  Else
    GraphicsWindow.FillRectangle(vr - size/2,wr - size/2,size,size)
  EndIf
EndSub

Sub restoreinm
  If resm = "True" Then
    GraphicsWindow.FillEllipse(rex - ress/2,rey - ress/2,ress,ress)
  Else
    GraphicsWindow.FillRectangle(rex - ress/2,rey - ress/2,ress,ress)
  EndIf
EndSub

Sub isrubornot
  If poic[arrayid][iy] = "d" Then
    GraphicsWindow.PenColor = GraphicsWindow.BackgroundColor
  EndIf
EndSub

Sub restoreline
  For yuy = 0 to nid
    resstart = linestart[arrayid][yuy]
    resend = linend[arrayid][yuy]
    resdraw()
  Endfor
EndSub

Sub restore
  For tyt = 0 To poiid
    rex = poix[arrayid][tyt]
    rey = poiy[arrayid][tyt]
    ress = pois[arrayid][tyt]
    resc = poic[arrayid][tyt]
    resm = poim[arrayid][tyt]
    If resc = "d" Then
      resc = GraphicsWindow.BackgroundColor
    EndIf
    GraphicsWindow.BrushColor = resc
    restoreinm()
  EndFor
  restoreline()
  GraphicsWindow.BrushColor = "black"
EndSub

Sub resdraw
  For opo = resstart To resend-1
    GraphicsWindow.PenWidth = pois[arrayid][opo]
    GraphicsWindow.PenColor = poic[arrayid][opo]
    isrubornotd()
    reslinx = poix[arrayid][opo]
    reslinxd = poix[arrayid][opo+1]
    resliny = poiy[arrayid][opo]
    reslinyd = poiy[arrayid][opo+1]
    GraphicsWindow.DrawLine(reslinx,resliny,reslinxd,reslinyd)
  EndFor
  GraphicsWindow.PenColor = "Black"
  GraphicsWindow.PenWidth = 3
EndSub

Sub isrubornotd
  If poic[arrayid][opo] = "d" Then
    GraphicsWindow.PenColor = GraphicsWindow.BackgroundColor
  EndIf
EndSub

Sub pisincr
  If size<60 Then
    size = size + 2
    markon()
    Program.Delay(150)
    pisinfop()
    pisinfow()
  EndIf
EndSub

Sub pisdecr
  If size>2 Then
    size = size - 2
    markon()
    Program.Delay(150)
    pisinfop()
    pisinfow()
  EndIf
EndSub

Sub cursor
  If iscur = 0 Then
    colorec = GraphicsWindow.PenColor
    GraphicsWindow.PenColor = "black"
    curs = Shapes.AddEllipse(8,8)
    GraphicsWindow.PenColor = colorec
    iscur = 1
  EndIf
  xcu = Mouse.MouseX - 8 - 8/2
  ycu = Mouse.MouseY - 26 - 8/2
  Shapes.Move(curs,xcu,ycu)
EndSub

Sub correct
  bgcol = GraphicsWindow.BackgroundColor
  chbgc = "True"
  mid = 0
EndSub

Sub colmake
  colnum = colin[numcolin]
  GraphicsWindow.PenColor = "black"
  GraphicsWindow.BackgroundColor = bgcol
  If chbgc = "True" then
    restore()
    chbgc = "False"
  endif
  height = heightw - bottomsize
  GraphicsWindow.Width = width
  GraphicsWindow.Height = heightw
  GraphicsWindow.PenWidth = 3
  GraphicsWindow.DrawLine(101,0,101,height)
  GraphicsWindow.DrawLine(width-toolswidth,0,width-toolswidth,height)
  GraphicsWindow.DrawLine(0,0,100,0)
  GraphicsWindow.DrawLine(0,height,width,height)
  odstep = height/colnum
  colnumend = colin[numcolin] - 1
  For yy= 0 to colnumend
    GraphicsWindow.DrawLine(0,odstep*yy+odstep,100,odstep*yy+odstep)
  endfor
  rechei =  (height-2*colnum)/colnum
  For rr = 0 to colnumend
    GraphicsWindow.BrushColor = col[numcolin][rr]
    GraphicsWindow.FillRectangle(0,rr*odstep+1,100,rechei)
  EndFor
  GraphicsWindow.BrushColor = "blue"
  GraphicsWindow.FillRectangle(0,height+1,width,heightw-height-1)
EndSub

Sub bottommake
  lesscol = numcolin - 1
  If lesscol<0 then
    lesscol = 9
  endif
  morecol = numcolin + 1
  If morecol>9 then
    morecol = 0
  endif
  GraphicsWindow.DrawLine(200,height,200,heightw)
  GraphicsWindow.BrushColor = "yellow"
  nete = colspi[lesscol]
  prete = colspi[morecol]
  GraphicsWindow.FontSize = 20
  lengne = Text.GetLength(nete + 2)
  lengtne = lengne * 12
  nex = Shapes.AddText("- " + nete)
  Shapes.Move(nex,(200 - lengtne)/2,height + 5)
  lengpre = Text.GetLength(prete + 2)
  lengtpre = lengpre * 12
  prev = Shapes.AddText(prete + " -")
  Shapes.Move(prev,(200 - lengtpre)/2,heightw - 30)
  GraphicsWindow.DrawLine(0,height + 40,200, height+40)
  GraphicsWindow.BrushColor = colq
  GraphicsWindow.PenWidth = 2
  GraphicsWindow.DrawLine(745,height,745,heightw - 30)
  GraphicsWindow.DrawLine(880,height + 50,880,heightw)
  GraphicsWindow.PenWidth = 3
  GraphicsWindow.DrawLine(745,height+50,745,heightw)
  GraphicsWindow.DrawLine(745,height + 50,880,height + 50)
  GraphicsWindow.DrawLine(880,height,880,heightw-30)
  GraphicsWindow.DrawLine(585,height,585,heightw)
  If bitmap = "True" then
    infopre()
    preview()
  endif
endsub

Sub palettech
  If Mouse.IsLeftButtonDown = "true" Then
    vr = Mouse.MouseX - 8
    wr = Mouse.MouseY - 26
    ar = 0
    xr = 200
    For ter = 0 To 1
      br = height + ter * 40
      yr = height + ter * 40 + 40
      range()
      If rresult = "True" Then
        chpalet()
      EndIf
    EndFor
  EndIf
EndSub

Sub chpalet
  If ter = 0 Then
    palletmark()
    numcolin = numcolin - 1
    If numcolin<0 Then
      numcolin = 9
    EndIf
    palettech = "True"
    Program.Delay(100)
    palletmarkof()
  EndIf
  If ter = 1 Then
    palletmark()
    numcolin = numcolin + 1
    If numcolin>9 Then
      numcolin = 0
    EndIf
    palettech = "True"
    Program.Delay(100)
    palletmarkof()
  EndIf
  Program.Delay(250)
EndSub

Sub pisinfop
  Shapes.Remove(pisinfx)
  GraphicsWindow.PenColor = GraphicsWindow.BrushColor
  If ispisch = "True" Then
    pisinfx = Shapes.AddEllipse(size,size)
  Else
    pisinfx = Shapes.AddRectangle(size,size)
  EndIf
  Shapes.Move(pisinfx,200 + 3/4*bottomsize-size/2,height + bottomsize/2 - size/2)
EndSub

Sub bottompim
  colnum = colin[numcolin]
  GraphicsWindow.PenColor = "black"
  GraphicsWindow.BackgroundColor = bgcol
  height = heightw - bottomsize
  GraphicsWindow.Width = width
  GraphicsWindow.Height = heightw
  GraphicsWindow.PenWidth = 3
  GraphicsWindow.DrawLine(101,0,101,height)
  GraphicsWindow.DrawLine(width-toolswidth,0,width-toolswidth,height)
  GraphicsWindow.DrawLine(0,0,100,0)
  GraphicsWindow.DrawLine(0,height,width,height)
  odstep = height/colnum
  colnumend = colin[numcolin] - 1
  For yy= 0 to colnumend
    GraphicsWindow.DrawLine(0,odstep*yy+odstep,100,odstep*yy+odstep)
  endfor
  rechei =  (height-2*colnum)/colnum
  For rr = 0 to colnumend
    GraphicsWindow.BrushColor = col[numcolin][rr]
    GraphicsWindow.FillRectangle(0,rr*odstep+1,100,rechei)
  EndFor
  Shapes.Remove(nex)
  Shapes.Remove(prev)
  bottommake()
EndSub

Sub pisinfos
  GraphicsWindow.FontSize = 16
  rst = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "yellow"
  Shapes.Remove(infoas)
  If ispisch = "True" Then
    infoa = "Pisak: okrągły"
  Else
    infoa = "Pisak: kwadratowy"
  EndIf
  infoas = Shapes.AddText(infoa)
  Shapes.Move(infoas,330,height + 5)
  GraphicsWindow.BrushColor = rst
EndSub

Sub pisinfoc
  GraphicsWindow.FontSize = 16
  rst = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "yellow"
  Shapes.Remove(infobs)
  dere = col[colb][cola]
  infob = Text.Append("Kolor: ",dere)
  infobs = Shapes.AddText(infob)
  Shapes.Move(infobs,330,height + 30)
  GraphicsWindow.BrushColor = rst
EndSub

Sub pisinfow
  rst = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "yellow"
  GraphicsWindow.FontSize = 16
  Shapes.Remove(infocs)
  infoc = Text.Append("Grubość: ",size)
  infocs = Shapes.AddText(infoc)
  Shapes.Move(infocs,330,height + 55)
  GraphicsWindow.BrushColor = rst
EndSub

Sub precur
  wr = Mouse.MouseY-26
  vr = Mouse.MouseX-8
  ar = 102 + size/2
  xr = width - toolswidth - size/2
  br = size/2
  yr = height - size/2
  range()
  If rresult = "True" Then
    If istrere = "True" then
      gyt = GraphicsWindow.PenColor
      gat = GraphicsWindow.BrushColor
      GraphicsWindow.PenColor = "black"
      GraphicsWindow.BrushColor = "white"
      If ispisch = "True" Then
        trere = Shapes.AddEllipse(size,size)
      Else
        trere = Shapes.AddRectangle(size,size)
      EndIf
      Shapes.SetOpacity(trere,35)
      GraphicsWindow.PenColor = gyt
      GraphicsWindow.BrushColor = gat
      istrere = "False"
    EndIf
    xga = Mouse.MouseX - 8 - size/2
    yga = Mouse.MouseY - 26 - size/2
    Shapes.Move(trere,xga,yga)
  Else
    Shapes.Remove(trere)
    istrere = "True"
  EndIf
EndSub

Sub markon
  markon = toolacti - 1
  rew = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "white"
  GraphicsWindow.FillRectangle(width - toolswidth + 1,markon*todstep + 1,toolswidth,todstep-3)
  GraphicsWindow.BrushColor = rew
EndSub

Sub markof
  rew = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "lightskyblue"
  GraphicsWindow.FillRectangle(width-toolswidth + 1,markon*todstep + 1,toolswidth,todstep-3)
  GraphicsWindow.BrushColor = rew
EndSub

Sub palletmark
  wqa = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "white"
  GraphicsWindow.FillRectangle(0,height+2+ter*40,198,37)
  GraphicsWindow.BrushColor = wqa
EndSub

sub palletmarkof
  wqa = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "blue"
  GraphicsWindow.FillRectangle(0,height+2+ter*40,198,37)
  GraphicsWindow.BrushColor = wqa
EndSub

Sub bmpsave
  Program.Delay(400)
  frt = "False"
  setrange()
  borhe = height - 1
  borwi = width - toolswidth - 3
  grehe = height - 1
  grewi = width - toolswidth - 3
  markonr()
  gf = tv
  gh = tw
  gu = wp
  gw = vp
  If tw<wp then
    tw = wp
    wp = gh
  endif
  If tv<vp then
    tv = vp
    vp = gf
  endif
  If gtyu = "False" then
    bitmap = "True"
    For tyu = 0 To tw - wp
      For regr = 0 To tv - vp
        trgw = GraphicsWindow.GetPixel(regr + vp,tyu + wp)
        If trgw = "#000000" Then
          trgw = GraphicsWindow.BackgroundColor
        EndIf
        bmp[tyu][regr] = trgw
      EndFor
    EndFor
  endif
EndSub

Sub bmppaste
  Program.Delay(400)
  gtq = "False"
  feq = GraphicsWindow.BrushColor
  uyt = GraphicsWindow.PenColor
  GraphicsWindow.PenColor = "black"
  GraphicsWindow.BrushColor = "white"
  erw = Shapes.AddRectangle(tv - vp,tw - wp)
  Shapes.SetOpacity(erw,35)
  GraphicsWindow.PenColor = uyt
  GraphicsWindow.BrushColor = feq
  While gtq = "False"
    wr = Mouse.MouseY-26
    vr = Mouse.MouseX-8
    hw = wr
    hv = vr
    ar = 102 + size/2
    xr = width - 0 - toolswidth - size/2
    br = size/2
    yr = height - 0 - size/2
    range()
    gtx = rresult
    vr = Mouse.MouseX-8
    wr = Mouse.MouseY-26
    ar = width - toolswidth + 2
    xr = width
    fer = 8
    br = fer * todstep + 1
    yr = fer * todstep + todstep  + 1
    range()
    gtyu = rresult
    gru = Mouse.IsLeftButtonDown
    gte = Text.Append(gru,gtyu)
    hyu = Text.Append(gru,gtx)
    If gte = "TrueTrue" Then
      gtq = "True"
    EndIf
    If hyu = "TrueTrue" then
      gtq = "True"
    EndIf
    cursor()
    movepre()
  EndWhile
  pm = (hw + tw - wp) - height
  pn = (hv + tv - vp) - (width - toolswidth)
  If gtyu = "False" then
    markonr()
    If pn<0 Then
      pn = 0
    EndIf
    If pm<0 Then
      pm = 0
    EndIf
    For swf = 0 To tw - wp - pm - 3
      For ert = 0 To tv - vp - 3 - pn
        dcol = bmp[swf][ert]
        GraphicsWindow.SetPixel(hv + ert,hw + swf,dcol)
      EndFor
    EndFor
  Else
    Program.Delay(200)
  endif
  borhe = grehe
  borwi = grewi
  GraphicsWindow.BrushColor = feq
  Shapes.Remove(erw)
EndSub

Sub movepre
  dw = Mouse.MouseX - 8
  dv = Mouse.MouseY - 26
  Shapes.Move(erw,dw,dv)
EndSub

Sub setrange
  frt = "False"
  While frt = "False"
    wr = Mouse.MouseY-26
    vr = Mouse.MouseX-8
    vp = vr
    wp = wr
    ar = 102 + size/2
    xr = width - 0 - toolswidth - size/2
    br = size/2
    yr = height - 0 - size/2
    range()
    gtx = rresult
    vr = Mouse.MouseX-8
    wr = Mouse.MouseY-26
    ar = width - toolswidth + 2
    xr = width
    fer = 7
    br = fer * todstep + 1
    yr = fer * todstep + todstep  + 1
    range()
    gtyu = rresult
    gru = Mouse.IsLeftButtonDown
    gte = Text.Append(gru,gtyu)
    hyu = Text.Append(gru,gtx)
    If gte = "TrueTrue" Then
      frt = "True"
    EndIf
    If hyu = "TrueTrue" then
      frt = "True"
    EndIf
    cursor()
  EndWhile
  awsd = GraphicsWindow.BrushColor
  awsa = GraphicsWindow.PenColor
  GraphicsWindow.BrushColor = "blue"
  GraphicsWindow.PenColor = "blue"
  wdx = Shapes.AddEllipse(8,8)
  Shapes.Move(wdx,vp-4,wr-4)
  GraphicsWindow.BrushColor = awsd
  GraphicsWindow.PenColor = awsa
  Program.Delay(400)
  req = "False"
  If gtyu = "False" then
    While req = "False"
      wr = Mouse.MouseY-26
      vr = Mouse.MouseX-8
      ar = 102 + size/2
      xr = width - 0 - toolswidth - size/2
      br = size/2
      yr = height - 0 - size/2
      tw = wr
      tv = vr
      range()
      gtx = rresult
      vr = Mouse.MouseX-12
      wr = Mouse.MouseY-27
      ar = width - toolswidth + 2
      xr = width
      fer = 8
      br = fer * todstep + 1
      yr = fer * todstep + todstep  + 1
      range()
      gtyu = rresult
      gru = Mouse.IsLeftButtonDown
      gte = Text.Append(gru,gtyu)
      hyu = Text.Append(gru,gtx)
      If gte = "TrueTrue" Then
        req = "True"
      EndIf
      If hyu = "TrueTrue" then
        req = "True"
      EndIf
      cursor()
      prerange()
    EndWhile
    Shapes.Remove(prer)
  EndIf
  Shapes.Remove(wdx)
EndSub

Sub prerange
  If Mouse.IsRightButtonDown = "True" then
    tgy = GraphicsWindow.BrushColor
    dty = GraphicsWindow.PenColor
    GraphicsWindow.BrushColor = "white"
    GraphicsWindow.PenColor = "black"
    Shapes.Remove(prer)
    va = Mouse.MouseX-8
    wa = Mouse.MouseY-26
    ta = vp
    tb = wp
    widpre = va - vp
    heipre = wa - wp
    If widpre<0 Then
      widpre = Math.Abs(widpre)
      ta = ta - widpre
    EndIf
    If heipre<0 Then
      heipre = Math.Abs(heipre)
      tb = tb - heipre
    EndIf
    prer = Shapes.AddRectangle(widpre,heipre)
    Shapes.SetOpacity(prer,0)
    Shapes.Move(prer,ta,tb)
    Shapes.SetOpacity(prer,35)
    GraphicsWindow.BrushColor = tgy
    GraphicsWindow.PenColor = dty
  EndIf
EndSub

Sub markonr
  markon = toolacti - 1
  rew = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "red"
  GraphicsWindow.FillRectangle(width - toolswidth + 1,markon*todstep + 1,toolswidth,todstep-3)
  GraphicsWindow.BrushColor = rew
EndSub

Sub preview
  widpic = tv - vp
  heipic = tw - wp
  divisor = heipic/70
  divisor = Math.Round(divisor)
  If divisor = 0  Then
    divisor = 1
  EndIf
  If widpic/divisor>150 Then
    divisor = widpic/150
    divisor = Math.Round(divisor)
  EndIf
  If heipic/divisor<70 Then
    as = (70 - heipic/divisor)/2
  Else
    as = 0
  EndIf
  If widpic/divisor<150 Then
    ax = (150 - widpic/divisor)/2
  Else
    ax = 0
  EndIf
  If divisor = 0  Then
    divisor = 1
  EndIf
  If heipic/divisor<70 Then
    hty = "True"
  EndIf
  If widpic/divisor<150 Then
    frw = "True"
  EndIf
  hgt = Text.Append(hty,frw)
  ftr = "False"
  If hgt = "TrueTrue" Then
    pog = GraphicsWindow.BrushColor
    GraphicsWindow.BrushColor = "blue"
    GraphicsWindow.FillRectangle(590,height + 5,150,76)
    GraphicsWindow.BrushColor = pog
  For loi = 0 To heipic Step divisor
    For  seb = 0 To widpic Step divisor
      wqs = bmp[loi][seb]
      xq = 590 + seb/divisor + ax
      If xq>745 Then
        xq = 700
        ftr = "True"
      EndIf
      GraphicsWindow.SetPixel(xq,height + 5 + loi/divisor + as,wqs)
    EndFor
  EndFor
  infopre()
  If ftr = "True" then
    gtr = GraphicsWindow.BrushColor
    GraphicsWindow.BrushColor = "blue"
    GraphicsWindow.FillRectangle(590,height + 5,150,70)
    GraphicsWindow.BrushColor = gtr
  EndIf
  EndIf
EndSub

sub infopre
  swe = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "yellow"
  GraphicsWindow.FontSize = 16
  Shapes.Remove(xxx)
  xxx = Shapes.AddText("Szerokość: " + widpic)
  Shapes.Move(xxx,750,height + 5)
  Shapes.Remove(yyy)
  yyy = Shapes.AddText("Wysokość: " + heipic)
  Shapes.Move(yyy,750,height + 25)
  GraphicsWindow.BrushColor = swe
EndSub

Sub picidinfo
  tbn = GraphicsWindow.BrushColor
  GraphicsWindow.BrushColor = "yellow"
  Shapes.Remove(picinfoid)
  GraphicsWindow.FontSize = 16
  picinfoid = Shapes.AddText("Zapis nr. " + arrayid)
  Shapes.Move(picinfoid,760,heightw - 25)
  GraphicsWindow.BrushColor = tbn
EndSub

Sub makearray
  bnj = GraphicsWindow.BrushColor
  GraphicsWindow.FontSize = 20
  GraphicsWindow.BrushColor = "yellow"
  Shapes.Remove(ijk)
  ijk = Shapes.AddText("-  " + mayarray + "  -")
  Shapes.Move(ijk,885 + 30,height + 5)
  GraphicsWindow.BrushColor = "white"
  GraphicsWindow.PenColor = "black"
  Shapes.Remove(hyt)
  hyt = Shapes.AddRectangle(20,20)
  Shapes.SetOpacity(hyt,35)
  Shapes.Move(hyt,909,height + 8)
  Shapes.Remove(jho)
  jho = Shapes.AddRectangle(20,20)
  Shapes.SetOpacity(jho,35)
  If mayarray>9 then
  adde = 12
  else
  adde = 0
  endif
  Shapes.Move(jho,954 + adde,height + 8)
  GraphicsWindow.BrushColor = bnj
  GraphicsWindow.FontSize = 10
  Controls.AddButton("Dodaj",922,height + 30)
  Controls.AddButton("Synchronizuj",905,height + 55)
EndSub

Sub setarray
  If Mouse.IsLeftButtonDown = "True" Then
    ar = 909
    br = height + 8
    xr = 929
    yr = height + 28
    vr = Mouse.MouseX - 8
    wr = Mouse.MouseY - 26
    range()
    If rresult = "True" Then
      mayarray = mayarray-1
      If mayarray<0 Then
        mayarray = 0
      EndIf
      makearray()
      Program.Delay(400)
    EndIf
    If mayarray>9 Then
      adds = 12
    Else
      adds = 0
    EndIf
    ar = 954 + adds
    br = height + 8
    xr = 974 + adds
    yr = height + 28
    vr = Mouse.MouseX - 8
    wr = Mouse.MouseY - 26
    range()
    If rresult = "True" Then
      mayarray = mayarray+1
      If mayarray>arrayid then
        mayarray = arrayid
      EndIf
      makearray()
      Program.Delay(400)
    EndIf
  EndIf
EndSub
  
